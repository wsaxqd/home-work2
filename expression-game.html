<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¡¨æƒ…æ¨¡ä»¿ç§€ - AIæ¸¸æˆå®éªŒå®¤ - å¯è’™ä¹‹å…‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #fff9c4 0%, #ffccbc 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0;
            position: relative;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #ffc107 0%, #ff5722 100%);
            color: white;
            border-radius: 0 0 20px 20px;
        }
        
        .back-button {
            font-size: 24px;
            cursor: pointer;
        }
        
        .page-title {
            font-size: 20px;
            text-align: center;
            flex: 1;
        }
        
        .game-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .score {
            background: rgba(255,255,255,0.2);
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 14px;
        }
        
        .main-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }
        
        .section-title {
            font-size: 18px;
            margin: 20px 0 15px;
            color: #ff5722;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "";
            display: inline-block;
            width: 5px;
            height: 20px;
            background: #ff5722;
            margin-right: 10px;
            border-radius: 3px;
        }
        
        /* æ¸¸æˆåŒºåŸŸæ ·å¼ */
        .game-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid #fff9c4;
        }
        
        .game-progress {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .level-indicator {
            font-size: 14px;
            color: #ff5722;
            font-weight: bold;
        }
        
        .progress-bar {
            flex: 1;
            height: 8px;
            background: #e0e0e0;
            border-radius: 4px;
            margin: 0 15px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: #ffc107;
            border-radius: 4px;
            width: 40%;
            transition: width 0.5s;
        }
        
        .progress-text {
            font-size: 14px;
            color: #666;
        }
        
        /* è¡¨æƒ…è¯†åˆ«åŒºåŸŸ */
        .expression-area {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }
        
        .camera-container {
            position: relative;
            width: 100%;
            height: 250px;
            background: #e0e0e0;
            border-radius: 10px;
            margin-bottom: 15px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        .camera-view {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
        }
        
        .camera-placeholder {
            font-size: 50px;
            color: #999;
        }
        
        .face-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        
        .face-box {
            position: absolute;
            border: 3px solid #4caf50;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.5);
        }
        
        .expression-controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .control-btn {
            width: 60px;
            height: 60px;
            background: #ffc107;
            color: white;
            border: none;
            border-radius: 50%;
            font-size: 24px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: transform 0.2s;
        }
        
        .control-btn:hover {
            transform: scale(1.1);
        }
        
        .control-btn.secondary {
            background: #ff5722;
        }
        
        .expression-result {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin-top: 15px;
            min-height: 80px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .result-text {
            font-size: 16px;
            margin-bottom: 10px;
            text-align: center;
        }
        
        .expression-match {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .target-expression {
            font-size: 30px;
        }
        
        .match-indicator {
            font-size: 20px;
        }
        
        .user-expression {
            font-size: 30px;
        }
        
        .accuracy-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin-bottom: 10px;
        }
        
        .accuracy-fill {
            height: 100%;
            background: #4caf50;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s;
        }
        
        .accuracy-text {
            font-size: 14px;
            color: #666;
        }
        
        /* è¡¨æƒ…æŒ‘æˆ˜æ ·å¼ */
        .challenge-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .challenge-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .challenge-icon {
            font-size: 24px;
            margin-right: 10px;
            color: #ff5722;
        }
        
        .challenge-title {
            font-size: 16px;
            color: #ff5722;
        }
        
        .target-expression-card {
            background: #fff9c4;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .target-emoji {
            font-size: 60px;
            margin-bottom: 10px;
        }
        
        .target-name {
            font-size: 18px;
            font-weight: bold;
            color: #ff5722;
            margin-bottom: 5px;
        }
        
        .target-description {
            font-size: 14px;
            color: #666;
        }
        
        .challenge-timer {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .timer-icon {
            font-size: 20px;
            color: #ff5722;
        }
        
        .timer-text {
            font-size: 16px;
            font-weight: bold;
            color: #ff5722;
        }
        
        /* è¡¨æƒ…å­¦ä¹ æ ·å¼ */
        .learning-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            background: linear-gradient(135deg, #fff9c4 0%, #ffccbc 100%);
            border: 2px dashed #ff5722;
        }
        
        .learning-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .learning-icon {
            font-size: 24px;
            margin-right: 10px;
            color: #ff5722;
        }
        
        .learning-title {
            font-size: 16px;
            color: #ff5722;
        }
        
        .expressions-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .expression-item {
            background: white;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .expression-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .expression-emoji {
            font-size: 40px;
            margin-bottom: 10px;
        }
        
        .expression-label {
            font-size: 14px;
            color: #333;
        }
        
        /* AIåŸç†è¯´æ˜æ ·å¼ */
        .explanation-area {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
        }
        
        .explanation-title {
            font-size: 16px;
            margin-bottom: 15px;
            color: #ff5722;
            display: flex;
            align-items: center;
        }
        
        .explanation-title::before {
            content: "ğŸ¤–";
            margin-right: 10px;
        }
        
        .explanation-content {
            font-size: 14px;
            line-height: 1.6;
            color: #666;
            margin-bottom: 15px;
        }
        
        .emotion-detection-demo {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
        }
        
        .face-diagram {
            width: 150px;
            height: 150px;
            background: #f5f5f5;
            border-radius: 50%;
            position: relative;
            margin-bottom: 15px;
        }
        
        .face-feature {
            position: absolute;
            background: #ffc107;
            border-radius: 50%;
        }
        
        .eyes {
            width: 20px;
            height: 20px;
            top: 40px;
        }
        
        .left-eye {
            left: 40px;
        }
        
        .right-eye {
            right: 40px;
        }
        
        .mouth {
            width: 60px;
            height: 20px;
            bottom: 40px;
            left: 45px;
            border-radius: 0 0 30px 30px;
        }
        
        .feature-labels {
            display: flex;
            justify-content: space-around;
            width: 100%;
            margin-top: 10px;
        }
        
        .feature-label {
            font-size: 12px;
            color: #666;
            text-align: center;
        }
        
        /* æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .control-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
        }
        
        .btn:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #ff5722;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #e64a19;
            transform: scale(1.03);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
            transform: scale(1.03);
        }
        
        /* åº•éƒ¨å¯¼èˆªæ ·å¼ */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 480px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #999;
        }
        
        .nav-item.active .nav-icon {
            color: #ff5722;
        }
        
        .nav-text {
            font-size: 12px;
            color: #999;
        }
        
        .nav-item.active .nav-text {
            color: #ff5722;
            font-weight: bold;
        }
        
        /* åŠ¨ç”» */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1s infinite;
        }
        
        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
        }
        
        .bounce {
            animation: bounce 1s infinite;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .container {
                padding-bottom: 70px;
            }
            
            .expressions-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .control-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="back-button" onclick="goBack()">â†</div>
            <div class="page-title">è¡¨æƒ…æ¨¡ä»¿ç§€</div>
            <div class="game-info">
                <div class="score">å¾—åˆ†: <span id="score">0</span></div>
            </div>
        </div>
        
        <div class="main-content">
            <div class="game-area">
                <div class="game-progress">
                    <div class="level-indicator">ç¬¬ <span id="current-level">1</span> å…³</div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progress-fill"></div>
                    </div>
                    <div class="progress-text"><span id="current-progress">4</span>/8</div>
                </div>
                
                <div class="section-title">è¡¨æƒ…è¯†åˆ«æŒ‘æˆ˜</div>
                <div class="expression-area">
                    <div class="camera-container" id="camera-container">
                        <div class="camera-placeholder">ğŸ“·</div>
                        <div class="face-overlay" id="face-overlay"></div>
                        <!-- åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºæ‘„åƒå¤´é¢„è§ˆ -->
                    </div>
                    
                    <div class="expression-controls">
                        <button class="control-btn" onclick="startCamera()">ğŸ“¹</button>
                        <button class="control-btn secondary" onclick="captureExpression()">ğŸ“¸</button>
                        <button class="control-btn" onclick="analyzeExpression()">ğŸ”</button>
                    </div>
                    
                    <div class="expression-result" id="expression-result">
                        <div class="result-text">å¼€å¯æ‘„åƒå¤´ï¼Œæ¨¡ä»¿ç›®æ ‡è¡¨æƒ…ï¼ŒAIä¼šè¯†åˆ«ä½ çš„è¡¨æƒ…ï¼</div>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="resetGame()">é‡æ–°å¼€å§‹</button>
                    <button class="btn btn-primary" id="next-btn" onclick="nextChallenge()" disabled>ä¸‹ä¸€ä¸ªè¡¨æƒ…</button>
                </div>
            </div>
            
            <div class="section-title">å½“å‰æŒ‘æˆ˜</div>
            <div class="challenge-area">
                <div class="challenge-header">
                    <div class="challenge-icon">ğŸ¯</div>
                    <div class="challenge-title">æ¨¡ä»¿è¿™ä¸ªè¡¨æƒ…</div>
                </div>
                
                <div class="target-expression-card">
                    <div class="target-emoji" id="target-emoji">ğŸ˜Š</div>
                    <div class="target-name" id="target-name">å¼€å¿ƒ</div>
                    <div class="target-description" id="target-description">å˜´è§’ä¸Šæ‰¬ï¼Œçœ¼ç›å¾®å¼¯ï¼Œéœ²å‡ºç‰™é½¿çš„ç¬‘å®¹</div>
                </div>
                
                <div class="challenge-timer">
                    <div class="timer-icon">â±ï¸</div>
                    <div class="timer-text">å‰©ä½™æ—¶é—´: <span id="timer">30</span>ç§’</div>
                </div>
            </div>
            
            <div class="section-title">è¡¨æƒ…å­¦ä¹ </div>
            <div class="learning-area">
                <div class="learning-header">
                    <div class="learning-icon">ğŸ“</div>
                    <div class="learning-title">å¸¸è§è¡¨æƒ…å­¦ä¹ </div>
                </div>
                
                <div class="expressions-grid">
                    <div class="expression-item" onclick="selectExpression('happy')">
                        <div class="expression-emoji">ğŸ˜Š</div>
                        <div class="expression-label">å¼€å¿ƒ</div>
                    </div>
                    <div class="expression-item" onclick="selectExpression('sad')">
                        <div class="expression-emoji">ğŸ˜¢</div>
                        <div class="expression-label">æ‚²ä¼¤</div>
                    </div>
                    <div class="expression-item" onclick="selectExpression('angry')">
                        <div class="expression-emoji">ğŸ˜ </div>
                        <div class="expression-label">ç”Ÿæ°”</div>
                    </div>
                    <div class="expression-item" onclick="selectExpression('surprised')">
                        <div class="expression-emoji">ğŸ˜²</div>
                        <div class="expression-label">æƒŠè®¶</div>
                    </div>
                    <div class="expression-item" onclick="selectExpression('fearful')">
                        <div class="expression-emoji">ğŸ˜¨</div>
                        <div class="expression-label">å®³æ€•</div>
                    </div>
                    <div class="expression-item" onclick="selectExpression('disgusted')">
                        <div class="expression-emoji">ğŸ¤¢</div>
                        <div class="expression-label">åŒæ¶</div>
                    </div>
                </div>
            </div>
            
            <div class="section-title">AIåŸç†å°çŸ¥è¯†</div>
            <div class="explanation-area">
                <div class="explanation-title">AIæ˜¯æ€ä¹ˆè¯†åˆ«è¡¨æƒ…çš„ï¼Ÿ</div>
                <div class="explanation-content">
                    AIé€šè¿‡åˆ†æäººè„¸çš„å…³é”®ç‰¹å¾æ¥è¯†åˆ«è¡¨æƒ…ï¼Œæ¯”å¦‚çœ¼ç›ã€çœ‰æ¯›å’Œå˜´å·´çš„å½¢çŠ¶å˜åŒ–ã€‚å®ƒä¼šæ¯”è¾ƒè¿™äº›ç‰¹å¾ä¸å·²çŸ¥è¡¨æƒ…æ¨¡å¼ï¼Œåˆ¤æ–­ä½ ç°åœ¨çš„æƒ…ç»ªçŠ¶æ€ã€‚
                </div>
                
                <div class="emotion-detection-demo">
                    <div class="face-diagram">
                        <div class="face-feature eyes left-eye"></div>
                        <div class="face-feature eyes right-eye"></div>
                        <div class="face-feature mouth"></div>
                    </div>
                    
                    <div class="feature-labels">
                        <div class="feature-label">çœ¼ç›å½¢çŠ¶</div>
                        <div class="feature-label">çœ‰æ¯›è§’åº¦</div>
                        <div class="feature-label">å˜´å·´å½¢çŠ¶</div>
                    </div>
                </div>
                
                <div class="explanation-content">
                    AIé€šè¿‡åˆ†ææˆåƒä¸Šä¸‡å¼ å¸¦æ ‡ç­¾çš„äººè„¸å›¾ç‰‡æ¥å­¦ä¹ ï¼Œæ‰¾å‡ºä¸åŒè¡¨æƒ…çš„ç‰¹å¾æ¨¡å¼ã€‚å½“ä½ åšå‡ºè¡¨æƒ…æ—¶ï¼ŒAIä¼šæå–ä½ çš„é¢éƒ¨ç‰¹å¾å¹¶ä¸å­¦åˆ°çš„æ¨¡å¼è¿›è¡Œæ¯”è¾ƒã€‚
                </div>
            </div>
        </div>
        
        <div class="bottom-nav">
            <div class="nav-item" onclick="navigateTo('index.html')">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-text">é¦–é¡µ</div>
            </div>
            <div class="nav-item active" onclick="navigateTo('explore.html')">
                <div class="nav-icon">ğŸ”</div>
                <div class="nav-text">æ¢ç´¢</div>
            </div>
            <div class="nav-item" onclick="navigateTo('create.html')">
                <div class="nav-icon">ğŸ¨</div>
                <div class="nav-text">åˆ›ä½œ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('mind-garden.html')">
                <div class="nav-icon">ğŸ’</div>
                <div class="nav-text">å¿ƒçµ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('profile.html')">
                <div class="nav-icon">ğŸ‘¤</div>
                <div class="nav-text">æˆ‘çš„</div>
            </div>
        </div>
    </div>

    <script src="navigation-template.js"></script>
    <script>
        // æ¸¸æˆçŠ¶æ€å’Œæ•°æ®
        let gameState = {
            score: 0,
            level: 1,
            progress: 4,
            totalChallenges: 8,
            currentExpression: 'happy',
            timer: 30,
            timerInterval: null,
            cameraActive: false
        };
        
        // ä¿å­˜æ¸¸æˆçŠ¶æ€
        function saveGameState() {
            try {
                if (typeof localStorage !== 'undefined') {
                    const saveState = {
                        score: gameState.score,
                        level: gameState.level,
                        progress: gameState.progress,
                        currentExpression: gameState.currentExpression,
                        timer: gameState.timer,
                        gameInProgress: true,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem('qmzg_expressionGame_state', JSON.stringify(saveState));
                    console.log('æ¸¸æˆçŠ¶æ€å·²ä¿å­˜');
                }
            } catch (error) {
                console.error('ä¿å­˜æ¸¸æˆçŠ¶æ€å¤±è´¥:', error);
            }
        }
        
        // åŠ è½½æ¸¸æˆçŠ¶æ€
        function loadGameState() {
            try {
                if (typeof localStorage !== 'undefined') {
                    const savedState = localStorage.getItem('qmzg_expressionGame_state');
                    if (savedState) {
                        const parsedState = JSON.parse(savedState);
                        // æ£€æŸ¥çŠ¶æ€æ˜¯å¦æ˜¯ä»Šå¤©çš„ï¼Œå¦‚æœè¶…è¿‡1å°æ—¶åˆ™ä¸æ¢å¤
                        const lastUpdated = new Date(parsedState.lastUpdated);
                        const now = new Date();
                        const minutesPassed = (now - lastUpdated) / (1000 * 60);
                        
                        if (minutesPassed < 60) {
                            gameState.score = parsedState.score || 0;
                            gameState.level = parsedState.level || 1;
                            gameState.progress = parsedState.progress || 1;
                            gameState.currentExpression = parsedState.currentExpression || 'happy';
                            gameState.timer = parsedState.timer || 30;
                            
                            // æ›´æ–°UIæ˜¾ç¤º
                            document.getElementById('score').textContent = gameState.score;
                            document.getElementById('current-level').textContent = gameState.level;
                            document.getElementById('current-progress').textContent = gameState.progress;
                            document.getElementById('timer').textContent = gameState.timer;
                            document.getElementById('progress-fill').style.width = (gameState.progress / gameState.totalChallenges * 100) + '%';
                            
                            console.log('æ¸¸æˆçŠ¶æ€å·²æ¢å¤');
                            return true;
                        }
                    }
                }
            } catch (error) {
                console.error('åŠ è½½æ¸¸æˆçŠ¶æ€å¤±è´¥:', error);
            }
            return false;
        }
        
        // ä¿å­˜æ¸¸æˆç»“æœ
        function saveGameResult(finalScore) {
            try {
                const timestamp = new Date().getTime();
                const gameResult = {
                    id: timestamp,
                    gameType: 'expression-game',
                    score: finalScore,
                    level: gameState.level,
                    challengesCompleted: gameState.progress,
                    timestamp: new Date().toISOString()
                };
                
                if (typeof localStorage !== 'undefined') {
                    let gameHistory = JSON.parse(localStorage.getItem('qmzg_gameResults') || '[]');
                    gameHistory.unshift(gameResult);
                    
                    // ä¿ç•™æœ€è¿‘çš„10æ¡è®°å½•
                    if (gameHistory.length > 10) {
                        gameHistory = gameHistory.slice(0, 10);
                    }
                    
                    localStorage.setItem('qmzg_gameResults', JSON.stringify(gameHistory));
                }
                
                console.log('æ¸¸æˆç»“æœå·²ä¿å­˜:', gameResult);
            } catch (error) {
                console.error('ä¿å­˜æ¸¸æˆç»“æœå¤±è´¥:', error);
            }
        }
        
        // è¡¨æƒ…æ•°æ®
        const expressions = {
            'happy': {
                emoji: 'ğŸ˜Š',
                name: 'å¼€å¿ƒ',
                description: 'å˜´è§’ä¸Šæ‰¬ï¼Œçœ¼ç›å¾®å¼¯ï¼Œéœ²å‡ºç‰™é½¿çš„ç¬‘å®¹',
                features: 'çœ¼ç›å¾®å¼¯ï¼Œå˜´è§’ä¸Šæ‰¬'
            },
            'sad': {
                emoji: 'ğŸ˜¢',
                name: 'æ‚²ä¼¤',
                description: 'å˜´è§’ä¸‹å‚ï¼Œçœ‰æ¯›å‘ˆå…«å­—å½¢ï¼Œå¯èƒ½æµæ³ª',
                features: 'çœ‰æ¯›ä¸‹å‚ï¼Œå˜´è§’ä¸‹å¼¯'
            },
            'angry': {
                emoji: 'ğŸ˜ ',
                name: 'ç”Ÿæ°”',
                description: 'çœ‰æ¯›ç´§çš±ï¼Œçœ¼ç›çªå¤§ï¼Œå˜´è§’å‘ä¸‹',
                features: 'çœ‰æ¯›ç´§çš±ï¼Œå˜´å”‡ç´§é—­'
            },
            'surprised': {
                emoji: 'ğŸ˜²',
                name: 'æƒŠè®¶',
                description: 'çœ¼ç›çå¤§ï¼Œçœ‰æ¯›æŠ¬é«˜ï¼Œå˜´å·´å¼ å¼€å‘ˆOå½¢',
                features: 'çœ¼ç›çå¤§ï¼Œå˜´å·´å¼ å¼€'
            },
            'fearful': {
                emoji: 'ğŸ˜¨',
                name: 'å®³æ€•',
                description: 'çœ¼ç›çå¤§ï¼Œçœ‰æ¯›ä¸Šæ‰¬å¹¶èšæ‹¢ï¼Œå˜´å·´å¼ å¼€',
                features: 'çœ‰æ¯›ä¸Šæ‰¬ï¼Œå˜´å·´ç´§å¼ '
            },
            'disgusted': {
                emoji: 'ğŸ¤¢',
                name: 'åŒæ¶',
                description: 'é¼»å­çš±èµ·ï¼Œä¸Šå”‡æŠ¬èµ·ï¼Œå¯èƒ½ä¼´éšçœ¯çœ¼',
                features: 'é¼»å­çš±èµ·ï¼Œä¸Šå”‡æŠ¬èµ·'
            }
        };
        
        // å¯¼èˆªåŠŸèƒ½
        function goBack() {
            window.history.back();
        }
        
        // é€‰æ‹©è¡¨æƒ…å­¦ä¹ 
        function selectExpression(expression) {
            // æ›´æ–°ç›®æ ‡è¡¨æƒ…
            setTargetExpression(expression);
            
            // æ˜¾ç¤ºæç¤º
            const resultElement = document.getElementById('expression-result');
            resultElement.innerHTML = `
                <div class="result-text">å­¦ä¹ ${expressions[expression].name}è¡¨æƒ…ï¼å°è¯•æ¨¡ä»¿è¿™ä¸ªè¡¨æƒ…ã€‚</div>
            `;
        }
        
        // è®¾ç½®ç›®æ ‡è¡¨æƒ…
        function setTargetExpression(expression) {
            gameState.currentExpression = expression;
            const exprData = expressions[expression];
            
            document.getElementById('target-emoji').textContent = exprData.emoji;
            document.getElementById('target-name').textContent = exprData.name;
            document.getElementById('target-description').textContent = exprData.description;
        }
        
        // å¼€å¯æ‘„åƒå¤´
        function startCamera() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨è®¾å¤‡æ‘„åƒå¤´
            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿæ‘„åƒå¤´å¼€å¯
            const cameraContainer = document.getElementById('camera-container');
            cameraContainer.innerHTML = `
                <div class="camera-placeholder pulse">ğŸ“¹ æ‘„åƒå¤´å¼€å¯ä¸­...</div>
                <div class="face-overlay" id="face-overlay"></div>
            `;
            
            setTimeout(() => {
                // æ¨¡æ‹Ÿæ‘„åƒå¤´å¼€å¯æˆåŠŸ
                cameraContainer.innerHTML = `
                    <div class="camera-placeholder">ğŸ˜€</div>
                    <div class="face-overlay" id="face-overlay"></div>
                `;
                
                // æ˜¾ç¤ºé¢éƒ¨æ£€æµ‹æ¡†
                drawFaceDetection();
                
                // æ˜¾ç¤ºæç¤º
                const resultElement = document.getElementById('expression-result');
                resultElement.innerHTML = `
                    <div class="result-text">æ‘„åƒå¤´å·²å¼€å¯ï¼ç°åœ¨å°è¯•æ¨¡ä»¿ç›®æ ‡è¡¨æƒ…ã€‚</div>
                `;
                
                gameState.cameraActive = true;
                
                // å¼€å§‹è®¡æ—¶
                startTimer();
            }, 2000);
        }
        
        // ç»˜åˆ¶é¢éƒ¨æ£€æµ‹
        function drawFaceDetection() {
            const overlay = document.getElementById('face-overlay');
            overlay.innerHTML = '';
            
            // åˆ›å»ºé¢éƒ¨æ£€æµ‹æ¡†
            const faceBox = document.createElement('div');
            faceBox.className = 'face-box';
            faceBox.style.width = '150px';
            faceBox.style.height = '180px';
            faceBox.style.top = '35px';
            faceBox.style.left = 'calc(50% - 75px)';
            
            overlay.appendChild(faceBox);
        }
        
        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            gameState.timer = 30;
            document.getElementById('timer').textContent = gameState.timer;
            
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            gameState.timerInterval = setInterval(() => {
                gameState.timer--;
                document.getElementById('timer').textContent = gameState.timer;
                
                // å®šæœŸä¿å­˜æ¸¸æˆçŠ¶æ€
                if (gameState.timer % 5 === 0) { // æ¯5ç§’ä¿å­˜ä¸€æ¬¡
                    saveGameState();
                }
                
                if (gameState.timer <= 0) {
                    clearInterval(gameState.timerInterval);
                    
                    // ä¿å­˜æ¸¸æˆç»“æœ
                    saveGameResult(gameState.score);
                    
                    timeUp();
                }
            }, 1000);
        }
        
        // æ—¶é—´åˆ°
        function timeUp() {
            const resultElement = document.getElementById('expression-result');
            resultElement.innerHTML = `
                <div class="result-text">æ—¶é—´åˆ°ï¼ç‚¹å‡»åˆ†ææŒ‰é’®æŸ¥çœ‹ä½ çš„è¡¨æƒ…è¯†åˆ«ç»“æœã€‚</div>
            `;
        }
        
        // æ•æ‰è¡¨æƒ…
        function captureExpression() {
            if (!gameState.cameraActive) {
                alert('è¯·å…ˆå¼€å¯æ‘„åƒå¤´ï¼');
                return;
            }
            
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ•æ‰å½“å‰å¸§
            // è¿™é‡Œæˆ‘ä»¬æ¨¡æ‹Ÿæ•æ‰è¿‡ç¨‹
            const cameraContainer = document.getElementById('camera-container');
            cameraContainer.innerHTML = `
                <div class="camera-placeholder pulse">ğŸ“¸ æ•æ‰è¡¨æƒ…ä¸­...</div>
                <div class="face-overlay" id="face-overlay"></div>
            `;
            
            setTimeout(() => {
                // æ¨¡æ‹Ÿæ•æ‰å®Œæˆ
                const userEmoji = getRandomUserExpression();
                cameraContainer.innerHTML = `
                    <div class="camera-placeholder">${userEmoji}</div>
                    <div class="face-overlay" id="face-overlay"></div>
                `;
                
                // é‡æ–°ç»˜åˆ¶é¢éƒ¨æ£€æµ‹
                drawFaceDetection();
                
                // æ˜¾ç¤ºæç¤º
                const resultElement = document.getElementById('expression-result');
                resultElement.innerHTML = `
                    <div class="result-text">è¡¨æƒ…å·²æ•æ‰ï¼ç‚¹å‡»åˆ†ææŒ‰é’®æŸ¥çœ‹è¯†åˆ«ç»“æœã€‚</div>
                `;
            }, 1500);
        }
        
        // è·å–éšæœºç”¨æˆ·è¡¨æƒ…ï¼ˆæ¨¡æ‹Ÿï¼‰
        function getRandomUserExpression() {
            const emojis = ['ğŸ˜Š', 'ğŸ˜', 'ğŸ˜•', 'ğŸ˜²', 'ğŸ˜ ', 'ğŸ˜¢'];
            return emojis[Math.floor(Math.random() * emojis.length)];
        }
        
        // åˆ†æè¡¨æƒ…
        function analyzeExpression() {
            if (!gameState.cameraActive) {
                alert('è¯·å…ˆå¼€å¯æ‘„åƒå¤´å¹¶æ•æ‰è¡¨æƒ…ï¼');
                return;
            }
            
            // æ˜¾ç¤ºåˆ†æä¸­
            const resultElement = document.getElementById('expression-result');
            resultElement.innerHTML = `
                <div class="result-text">AIæ­£åœ¨åˆ†æä½ çš„è¡¨æƒ…...</div>
                <div class="accuracy-bar">
                    <div class="accuracy-fill" id="accuracy-fill" style="width: 0%"></div>
                </div>
                <div class="accuracy-text">åˆ†æè¿›åº¦: <span id="accuracy-text">0%</span></div>
            `;
            
            // æ¨¡æ‹ŸAIåˆ†æè¿‡ç¨‹
            let progress = 0;
            const interval = setInterval(() => {
                progress += 5;
                document.getElementById('accuracy-fill').style.width = progress + '%';
                document.getElementById('accuracy-text').textContent = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    showExpressionResult();
                }
            }, 100);
        }
        
        // æ˜¾ç¤ºè¡¨æƒ…è¯†åˆ«ç»“æœ
        function showExpressionResult() {
            const resultElement = document.getElementById('expression-result');
            
            // æ¨¡æ‹Ÿè¯†åˆ«ç»“æœ
            const targetExpression = gameState.currentExpression;
            const detectedExpression = simulateExpressionDetection(targetExpression);
            const accuracy = Math.floor(Math.random() * 30) + 70; // 70-100% å‡†ç¡®ç‡
            
            // è·å–è¡¨æƒ…emoji
            const targetEmoji = expressions[targetExpression].emoji;
            const detectedEmoji = expressions[detectedExpression]?.emoji || 'ğŸ˜';
            
            // åˆ¤æ–­åŒ¹é…ç¨‹åº¦
            const isMatch = detectedExpression === targetExpression;
            const matchSymbol = isMatch ? 'âœ…' : 'âŒ';
            
            resultElement.innerHTML = `
                <div class="expression-match">
                    <div class="target-expression">${targetEmoji}</div>
                    <div class="match-indicator">${matchSymbol}</div>
                    <div class="user-expression">${detectedEmoji}</div>
                </div>
                <div class="result-text">${getResultMessage(isMatch, accuracy, expressions[targetExpression].name, expressions[detectedExpression]?.name || 'æœªçŸ¥')}</div>
                <div class="accuracy-bar">
                    <div class="accuracy-fill" style="width: ${accuracy}%"></div>
                </div>
                <div class="accuracy-text">åŒ¹é…åº¦: ${accuracy}%</div>
            `;
            
            // æ›´æ–°åˆ†æ•°
            updateScore(accuracy, isMatch);
            
            // åœæ­¢è®¡æ—¶
            if (gameState.timerInterval) {
                clearInterval(gameState.timerInterval);
            }
            
            // å¯ç”¨ä¸‹ä¸€ä¸ªæŒ‰é’®
            document.getElementById('next-btn').disabled = false;
        }
        
        // æ¨¡æ‹Ÿè¡¨æƒ…æ£€æµ‹
        function simulateExpressionDetection(targetExpression) {
            // 80% æ¦‚ç‡æ­£ç¡®è¯†åˆ«ï¼Œ20% æ¦‚ç‡é”™è¯¯è¯†åˆ«
            if (Math.random() < 0.8) {
                return targetExpression;
            } else {
                // éšæœºè¿”å›ä¸€ä¸ªä¸åŒçš„è¡¨æƒ…
                const expressionsList = Object.keys(expressions);
                const otherExpressions = expressionsList.filter(expr => expr !== targetExpression);
                return otherExpressions[Math.floor(Math.random() * otherExpressions.length)];
            }
        }
        
        // è·å–ç»“æœæ¶ˆæ¯
        function getResultMessage(isMatch, accuracy, targetName, detectedName) {
            if (isMatch) {
                if (accuracy >= 90) {
                    return `å¤ªæ£’äº†ï¼ä½ çš„${targetName}è¡¨æƒ…éå¸¸åƒï¼`;
                } else if (accuracy >= 80) {
                    return `ä¸é”™ï¼ä½ çš„${targetName}è¡¨æƒ…å¾ˆåƒï¼`;
                } else {
                    return `è¿˜å¯ä»¥ï¼ä½ çš„${targetName}è¡¨æƒ…æœ‰ç‚¹åƒï¼`;
                }
            } else {
                return `ä½ æ¨¡ä»¿çš„æ˜¯${targetName}ï¼Œä½†AIè¯†åˆ«ä¸º${detectedName}ã€‚å†è¯•ä¸€æ¬¡ï¼`;
            }
        }
        
        // æ›´æ–°åˆ†æ•°
        function updateScore(accuracy, isMatch) {
            let points = Math.floor(accuracy / 10);
            
            if (isMatch) {
                points += 10; // åŒ¹é…æˆåŠŸé¢å¤–åŠ åˆ†
            }
            
            // æ ¹æ®å‰©ä½™æ—¶é—´åŠ åˆ†
            if (gameState.timer > 10) {
                points += 5;
            }
            
            gameState.score += points;
            document.getElementById('score').textContent = gameState.score;
        }
        
        // ä¸‹ä¸€ä¸ªæŒ‘æˆ˜
        function nextChallenge() {
            gameState.progress++;
            
            if (gameState.progress > gameState.totalChallenges) {
                gameState.level++;
                gameState.progress = 1;
            }
            
            // æ›´æ–°è¿›åº¦æ˜¾ç¤º
            document.getElementById('current-level').textContent = gameState.level;
            document.getElementById('current-progress').textContent = gameState.progress;
            document.getElementById('progress-fill').style.width = (gameState.progress / gameState.totalChallenges * 100) + '%';
            
            // éšæœºé€‰æ‹©æ–°è¡¨æƒ…
            const expressionsList = Object.keys(expressions);
            const randomExpression = expressionsList[Math.floor(Math.random() * expressionsList.length)];
            setTargetExpression(randomExpression);
            
            // é‡ç½®æ‘„åƒå¤´åŒºåŸŸ
            document.getElementById('camera-container').innerHTML = `
                <div class="camera-placeholder">ğŸ“·</div>
                <div class="face-overlay" id="face-overlay"></div>
            `;
            
            // é‡ç½®ç»“æœåŒºåŸŸ
            document.getElementById('expression-result').innerHTML = `
                <div class="result-text">å¼€å¯æ‘„åƒå¤´ï¼Œæ¨¡ä»¿ç›®æ ‡è¡¨æƒ…ï¼ŒAIä¼šè¯†åˆ«ä½ çš„è¡¨æƒ…ï¼</div>
            `;
            
            // é‡ç½®æ‘„åƒå¤´çŠ¶æ€
            gameState.cameraActive = false;
            
            // ç¦ç”¨ä¸‹ä¸€ä¸ªæŒ‰é’®
            document.getElementById('next-btn').disabled = true;
            
            // é‡ç½®å¹¶å¼€å§‹è®¡æ—¶
            startTimer();
            
            // æ˜¾ç¤ºé¼“åŠ±ä¿¡æ¯
            if (gameState.progress === 1 && gameState.level > 1) {
                alert(`æ­å–œï¼ä½ å·²å‡çº§åˆ°ç¬¬${gameState.level}å…³ï¼ç»§ç»­åŠ æ²¹ï¼`);
            }
        }
        
        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            if (confirm('ç¡®å®šè¦é‡æ–°å¼€å§‹æ¸¸æˆå—ï¼Ÿå½“å‰è¿›åº¦å°†ä¸¢å¤±ã€‚')) {
                gameState = {
                    score: 0,
                    level: 1,
                    progress: 1,
                    totalChallenges: 8,
                    currentExpression: 'happy',
                    timer: 30,
                    timerInterval: null,
                    cameraActive: false
                };
                
                // é‡ç½®UI
                document.getElementById('score').textContent = '0';
                document.getElementById('current-level').textContent = '1';
                document.getElementById('current-progress').textContent = '1';
                document.getElementById('progress-fill').style.width = '12.5%';
                document.getElementById('camera-container').innerHTML = `
                    <div class="camera-placeholder">ğŸ“·</div>
                    <div class="face-overlay" id="face-overlay"></div>
                `;
                document.getElementById('expression-result').innerHTML = `
                    <div class="result-text">å¼€å¯æ‘„åƒå¤´ï¼Œæ¨¡ä»¿ç›®æ ‡è¡¨æƒ…ï¼ŒAIä¼šè¯†åˆ«ä½ çš„è¡¨æƒ…ï¼</div>
                `;
                document.getElementById('next-btn').disabled = true;
                
                // è®¾ç½®åˆå§‹è¡¨æƒ…
                setTargetExpression('happy');
                
                // é‡ç½®è®¡æ—¶å™¨
                if (gameState.timerInterval) {
                    clearInterval(gameState.timerInterval);
                }
                document.getElementById('timer').textContent = '30';
                
                // æ¸…é™¤ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
                try {
                    if (typeof localStorage !== 'undefined') {
                        localStorage.removeItem('qmzg_expressionGame_state');
                    }
                } catch (error) {
                    console.error('æ¸…é™¤æ¸¸æˆçŠ¶æ€å¤±è´¥:', error);
                }
                
                // å¼€å§‹è®¡æ—¶
                startTimer();
            }
        }
        
        // ä¸ºåº•éƒ¨å¯¼èˆªæ·»åŠ ç‚¹å‡»äº‹ä»¶
        // åˆå§‹åŒ–å¯¼èˆªå’Œé¡µé¢
        document.addEventListener('DOMContentLoaded', function() {
            initAppNavigation();
            
            // å°è¯•åŠ è½½ä¿å­˜çš„æ¸¸æˆçŠ¶æ€
            const hasLoadedState = loadGameState();
            
            // åˆå§‹åŒ–è¿›åº¦æ˜¾ç¤º
            document.getElementById('progress-fill').style.width = (gameState.progress / gameState.totalChallenges * 100) + '%';
            
            // å¦‚æœæ²¡æœ‰åŠ è½½åˆ°çŠ¶æ€ï¼Œåˆ™è®¾ç½®åˆå§‹è¡¨æƒ…
            if (!hasLoadedState) {
                setTargetExpression('happy');
            }
            
            // å¼€å§‹è®¡æ—¶
            startTimer();
        });
    </script>
</body>
</html>