# Dify AI 配置完整指南

> 生成时间: 2026-01-29
> 适用于: 启蒙之光项目

---

## 📋 配置概述

我们需要在Dify AI中创建3个应用:
1. **AI对话助手** - 用于启启AI对话
2. **故事生成器** - 用于创作故事
3. **情感分析** - 用于心情日记分析

---

## 🚀 快速配置流程(15分钟)

### 第1步: 注册Dify AI账号 (3分钟)

1. 访问Dify AI官网:
   ```
   https://cloud.dify.ai
   ```

2. 点击右上角 **"Sign Up"** 或 **"注册"**

3. 选择注册方式:
   - 邮箱注册(推荐)
   - GitHub账号登录
   - Google账号登录

4. 完成邮箱验证

5. 登录成功后,进入控制台

---

### 第2步: 创建AI对话助手应用 (4分钟)

**应用名称:** 启蒙之光-AI助手

#### 2.1 创建应用

1. 在Dify控制台首页,点击 **"Create New App"** 或 **"创建应用"**

2. 选择应用类型: **"Chat App"** (聊天应用)

3. 填写应用信息:
   ```
   应用名称: 启蒙之光-AI助手
   应用描述: 儿童AI学习助手,帮助6-12岁儿童学习和成长
   图标: (可选)选择一个可爱的图标
   ```

4. 点击 **"Create"** 创建应用

#### 2.2 配置AI模型

1. 进入应用设置页面

2. 在 **"Model"** 设置中:
   ```
   模型选择: GPT-3.5-turbo 或 GPT-4 (根据预算选择)
   Temperature: 0.7 (创意程度)
   Max Tokens: 2000
   ```

3. 在 **"Prompt"** 设置中输入:
   ```
   你是"启启",一个专为6-12岁儿童设计的AI学习助手。

   你的特点:
   - 用简单易懂的语言与孩子交流
   - 富有耐心和鼓励性
   - 善于用生动的例子解释概念
   - 关注孩子的情感需求
   - 引导孩子独立思考

   你的任务:
   - 回答孩子的各种问题
   - 帮助解释学习中的困惑
   - 提供学习建议和方法
   - 给予鼓励和表扬
   - 培养良好的学习习惯

   注意:
   - 语言要适合儿童理解
   - 避免使用复杂术语
   - 保持积极正面的态度
   - 适当使用emoji让对话更生动
   ```

4. 点击 **"Save"** 保存配置

#### 2.3 获取API Key

1. 点击右上角 **"Publish"** 发布应用

2. 进入 **"API Access"** 或 **"API访问"** 页面

3. 复制 **API Key** (格式: `app-xxxxxxxxxxxxx`)

4. 保存这个API Key,稍后需要配置到环境变量

---

### 第3步: 创建故事生成应用 (4分钟)

**应用名称:** 启蒙之光-故事生成器

#### 3.1 创建应用

1. 回到控制台首页,点击 **"Create New App"**

2. 选择应用类型: **"Text Generator"** (文本生成)

3. 填写应用信息:
   ```
   应用名称: 启蒙之光-故事生成器
   应用描述: 为儿童生成有趣的故事和童话
   ```

#### 3.2 配置Prompt

在Prompt设置中输入:
```
你是一个专业的儿童故事创作者。

任务:根据用户提供的主题、角色或关键词,创作一个适合6-12岁儿童的故事。

创作要求:
1. 故事长度: 300-500字
2. 语言风格: 简单易懂,生动有趣
3. 情节: 有明确的开头、发展、高潮、结尾
4. 主题: 积极向上,包含正面价值观
5. 角色: 鲜明可爱,容易引起共鸣
6. 情感: 温暖、有趣、富有想象力

创作结构:
【标题】创意的故事标题
【开头】引人入胜的开篇
【发展】故事主线展开
【高潮】精彩的冲突或转折
【结尾】圆满的收尾和寓意

输入格式:
用户会提供: 主题、角色、场景、关键词等

输出格式:
完整的故事,包含标题和正文。
```

#### 3.3 获取API Key

1. 发布应用
2. 复制API Key
3. 保存备用

---

### 第4步: 创建情感分析应用 (4分钟)

**应用名称:** 启蒙之光-情感分析

#### 4.1 创建应用

1. 创建新应用,选择 **"Text Generator"**

2. 填写信息:
   ```
   应用名称: 启蒙之光-情感分析
   应用描述: 分析儿童的情感状态并给予关怀
   ```

#### 4.2 配置Prompt

```
你是一个儿童心理关怀专家,擅长理解和关心孩子的情感。

任务:分析孩子的心情文字或日记,给予温暖的回应和建议。

分析要点:
1. 情感识别: 判断孩子的情绪(开心/难过/生气/焦虑/困惑等)
2. 情感程度: 评估情绪的强烈程度
3. 原因分析: 理解情绪背后的原因
4. 回应方式: 给予温暖、理解和支持

回应原则:
- 首先表达理解和共情
- 肯定孩子的感受是正常的
- 提供积极的视角
- 给出建设性的建议
- 使用温暖鼓励的语言
- 适当使用emoji增加亲和力

输出格式:
{
  "emotion": "情绪类型",
  "level": "情绪强度(1-5)",
  "analysis": "情感分析",
  "response": "温暖的回应",
  "suggestion": "建议"
}
```

#### 4.3 获取API Key

1. 发布应用
2. 复制API Key
3. 保存备用

---

## 🎯 配置到项目中

### 更新环境变量

现在你有了3个API Key,需要配置到项目中。

打开 `.env.production.ready` 文件,找到AI配置部分:

```env
# === Dify AI ===
DIFY_API_URL=https://api.dify.ai/v1
DIFY_CHAT_APP_KEY=app-你的聊天应用key
DIFY_STORY_APP_KEY=app-你的故事生成key
DIFY_EMOTION_APP_KEY=app-你的情感分析key
```

替换为你刚才获取的API Key:

```env
# === Dify AI ===
DIFY_API_URL=https://api.dify.ai/v1
DIFY_CHAT_APP_KEY=app-xxxxxxxxxxxxxxxxxxxx
DIFY_STORY_APP_KEY=app-yyyyyyyyyyyyyyyyyyyy
DIFY_EMOTION_APP_KEY=app-zzzzzzzzzzzzzzzzzzzz
```

**注意:** 每个Key都是 `app-` 开头的长字符串

---

## 🧪 测试AI功能

### 测试方法1: 使用Dify控制台测试

在每个应用的页面中,都有一个"Playground"测试区:

**测试AI对话:**
```
输入: 你好启启,你能帮我学习吗?
期望输出: 温暖的回应和自我介绍
```

**测试故事生成:**
```
输入: 主题:勇敢,角色:小兔子
期望输出: 完整的故事
```

**测试情感分析:**
```
输入: 今天考试没考好,我很难过
期望输出: JSON格式的分析和回应
```

### 测试方法2: 使用项目API测试

配置完成后,启动项目测试:

```bash
# 启动后端服务
cd server
npm run dev

# 测试AI对话API
curl -X POST http://localhost:3000/api/ai/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"你好"}'
```

---

## 📊 应用配置总结

| 应用名称 | 类型 | 用途 | API Key位置 |
|---------|------|------|------------|
| 启蒙之光-AI助手 | Chat App | AI对话 | DIFY_CHAT_APP_KEY |
| 启蒙之光-故事生成器 | Text Generator | 故事创作 | DIFY_STORY_APP_KEY |
| 启蒙之光-情感分析 | Text Generator | 心情分析 | DIFY_EMOTION_APP_KEY |

---

## 💰 费用说明

### Dify AI定价

**免费版:**
- ✅ 每月200次调用
- ✅ 适合测试和小规模使用
- ✅ 所有基础功能

**专业版:** ($19/月)
- ✅ 10,000次调用/月
- ✅ 更快的响应速度
- ✅ 优先支持

**建议:**
- 开发测试阶段: 使用免费版
- 正式上线后: 根据用户量升级

---

## ⚠️ 重要提醒

### API Key安全

1. **不要泄露API Key**
   - 不要提交到GitHub
   - 不要分享给他人
   - 不要写在前端代码中

2. **API Key管理**
   - 定期更换API Key
   - 为不同环境使用不同的Key
   - 监控API使用量

3. **费用控制**
   - 设置调用次数限制
   - 监控每日使用量
   - 避免被恶意调用

---

## 🎁 额外应用建议(可选)

如果预算允许,还可以创建:

4. **作业辅导应用** - 用于作业帮助
5. **知识问答应用** - 用于AI小百科
6. **创意激发应用** - 用于诗歌创作

---

## 🔍 常见问题

### Q1: 创建应用时显示"超出限制"?

**解答:** 免费版可能有应用数量限制
**解决:**
- 升级到付费版
- 或者使用一个应用处理多个功能

### Q2: API调用失败?

**检查:**
1. API Key是否正确
2. API URL是否正确: `https://api.dify.ai/v1`
3. 应用是否已发布
4. 网络连接是否正常

### Q3: 响应速度慢?

**优化:**
1. 选择更快的模型
2. 减少Max Tokens
3. 升级到付费版

---

## 📞 获取帮助

**Dify官方文档:**
https://docs.dify.ai

**社区支持:**
https://discord.gg/dify

**技术支持:**
support@dify.ai

---

## 🎯 配置完成检查清单

完成以下所有步骤后,AI功能就可以正常使用了:

- [ ] 已注册Dify AI账号
- [ ] 已创建AI对话助手应用
- [ ] 已创建故事生成器应用
- [ ] 已创建情感分析应用
- [ ] 已获取3个API Key
- [ ] 已配置到.env文件
- [ ] 已测试AI功能正常

---

**准备好配置了吗?**

请告诉我:
1. 你已经注册好Dify账号了
2. 你需要我一步步指导创建应用
3. 你已经有API Key了,直接配置

我会根据你的进度继续帮助你! 🚀
