# å¯è’™ä¹‹å…‰ - åŸŸåä¸Šçº¿éƒ¨ç½²æ¸…å•

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

**åŸŸåï¼š** qmzgai.com
**æœåŠ¡å™¨ï¼š** å¾…é…ç½®
**çŠ¶æ€ï¼š** å‡†å¤‡éƒ¨ç½²

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. DNS é…ç½® âœ“
- [x] DNS è®°å½•å·²é…ç½®
- [x] ä¸»åŸŸåè§£æï¼ˆqmzgai.comï¼‰
- [x] www å­åŸŸåè§£æ
- [x] API å­åŸŸåè§£æï¼ˆå¯é€‰ï¼‰

### 2. SSL è¯ä¹¦é…ç½® âœ“
- [x] è‡ªåŠ¨åŒ–ç”³è¯·è„šæœ¬ï¼ˆ`ssl-setup.sh`ï¼‰
- [x] Nginx é…ç½®æ¨¡æ¿ï¼ˆ`nginx/qmzgai.conf`ï¼‰
- [x] SSL é…ç½®å®Œå…¨æŒ‡å—
- [x] è‡ªåŠ¨ç»­æœŸè®¾ç½®

### 3. æ–‡æ¡£å‡†å¤‡ âœ“
- [x] DNS é…ç½®æŒ‡å—ï¼ˆè…¾è®¯äº‘ï¼‰
- [x] SSL é…ç½®å®Œå…¨æŒ‡å—
- [x] Nginx ç”Ÿäº§ç¯å¢ƒé…ç½®
- [x] Docker éƒ¨ç½²æ–‡æ¡£ï¼ˆä¹‹å‰å·²å®Œæˆï¼‰

---

## ğŸš€ å¿«é€Ÿéƒ¨ç½²æµç¨‹ï¼ˆ3æ­¥ä¸Šçº¿ï¼‰

### ç¬¬ä¸€æ­¥ï¼šå‡†å¤‡æœåŠ¡å™¨ï¼ˆ30åˆ†é’Ÿï¼‰

#### 1.1 è´­ä¹°/å‡†å¤‡æœåŠ¡å™¨

**æ¨èé…ç½®ï¼š**
```
CPUï¼š2æ ¸
å†…å­˜ï¼š4GB
ç¡¬ç›˜ï¼š50GB SSD
å¸¦å®½ï¼š5Mbps
ç³»ç»Ÿï¼šUbuntu 22.04 LTS
```

**äº‘æœåŠ¡å•†æ¨èï¼š**
- è…¾è®¯äº‘è½»é‡åº”ç”¨æœåŠ¡å™¨
- é˜¿é‡Œäº‘ECS
- åä¸ºäº‘ECS

#### 1.2 æœåŠ¡å™¨åˆå§‹åŒ–

```bash
# 1. SSH ç™»å½•æœåŠ¡å™¨
ssh root@ä½ çš„æœåŠ¡å™¨IP

# 2. æ›´æ–°ç³»ç»Ÿ
sudo apt-get update && sudo apt-get upgrade -y

# 3. å®‰è£…å¿…è¦è½¯ä»¶
sudo apt-get install -y \
    git \
    curl \
    wget \
    vim \
    ufw \
    build-essential

# 4. é…ç½®é˜²ç«å¢™
sudo ufw allow 22/tcp   # SSH
sudo ufw allow 80/tcp   # HTTP
sudo ufw allow 443/tcp  # HTTPS
sudo ufw enable

# 5. å®‰è£… Docker
curl -fsSL https://get.docker.com | bash
sudo systemctl enable docker
sudo systemctl start docker

# 6. å®‰è£… Docker Compose
sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
sudo chmod +x /usr/local/bin/docker-compose

# 7. å®‰è£… Nginx
sudo apt-get install -y nginx
sudo systemctl enable nginx
sudo systemctl start nginx

# 8. éªŒè¯å®‰è£…
docker --version
docker-compose --version
nginx -v
```

---

### ç¬¬äºŒæ­¥ï¼šé…ç½® SSL è¯ä¹¦ï¼ˆ15åˆ†é’Ÿï¼‰

#### 2.1 ä¸Šä¼ è„šæœ¬åˆ°æœåŠ¡å™¨

**æ–¹æ³• 1ï¼šä½¿ç”¨ SCP**
```bash
# åœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œ
scp ssl-setup.sh root@ä½ çš„æœåŠ¡å™¨IP:/root/
scp -r nginx root@ä½ çš„æœåŠ¡å™¨IP:/root/
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ Git**
```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /root
git clone https://github.com/ä½ çš„ç”¨æˆ·å/qmzg.git
cd qmzg
```

#### 2.2 è¿è¡Œ SSL é…ç½®è„šæœ¬

```bash
# åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œ
cd /root
chmod +x ssl-setup.sh
sudo bash ssl-setup.sh
```

**è„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆï¼š**
- âœ… å®‰è£… Certbot
- âœ… ç”³è¯· SSL è¯ä¹¦
- âœ… é…ç½® Nginx
- âœ… è®¾ç½®è‡ªåŠ¨ç»­æœŸ

#### 2.3 éªŒè¯ SSL é…ç½®

```bash
# æ£€æŸ¥è¯ä¹¦
sudo certbot certificates

# æµ‹è¯• HTTPS
curl -I https://qmzgai.com

# è®¿é—®æµè§ˆå™¨
# https://qmzgai.com
```

---

### ç¬¬ä¸‰æ­¥ï¼šéƒ¨ç½²åº”ç”¨ï¼ˆ30åˆ†é’Ÿï¼‰

#### 3.1 å‡†å¤‡é¡¹ç›®æ–‡ä»¶

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
sudo mkdir -p /var/www/qmzgai
cd /var/www/qmzgai

# å…‹éš†é¡¹ç›®ï¼ˆæˆ–ä¸Šä¼ ï¼‰
git clone https://github.com/ä½ çš„ç”¨æˆ·å/qmzg.git .

# æˆ–ä½¿ç”¨ SCP ä¸Šä¼ 
# scp -r /path/to/qmzg root@æœåŠ¡å™¨IP:/var/www/qmzgai/
```

#### 3.2 é…ç½®ç¯å¢ƒå˜é‡

```bash
# åˆ›å»ºç”Ÿäº§ç¯å¢ƒé…ç½®
cd /var/www/qmzgai/server
cp .env.production.ready .env.production

# ç¼–è¾‘é…ç½®
vim .env.production
```

**å…³é”®é…ç½®é¡¹ï¼š**
```env
NODE_ENV=production

# æ•°æ®åº“
DB_HOST=localhost
DB_PORT=5432
DB_NAME=qmzg_production
DB_USER=qmzg
DB_PASSWORD=ä½ çš„æ•°æ®åº“å¯†ç 

# JWT
JWT_SECRET=ä½ çš„32ä½éšæœºå¯†é’¥

# åŸŸå
FRONTEND_URL=https://qmzgai.com
BACKEND_URL=https://qmzgai.com/api

# è·¨åŸŸ
CORS_ORIGIN=https://qmzgai.com,https://www.qmzgai.com
```

#### 3.3 æ„å»ºå’Œå¯åŠ¨

**æ–¹æ³• 1ï¼šä½¿ç”¨ Dockerï¼ˆæ¨èï¼‰**

```bash
cd /var/www/qmzgai

# æ„å»ºé•œåƒ
docker-compose -f docker-compose.prod.yml build

# å¯åŠ¨æœåŠ¡
docker-compose -f docker-compose.prod.yml up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose -f docker-compose.prod.yml logs -f
```

**æ–¹æ³• 2ï¼šç›´æ¥è¿è¡Œ**

```bash
# åç«¯
cd /var/www/qmzgai/server
npm install --production
npm run build
npm run start:prod

# å‰ç«¯
cd /var/www/qmzgai/app
npm install
npm run build

# å¤åˆ¶æ„å»ºæ–‡ä»¶åˆ° Nginx ç›®å½•
sudo cp -r dist/* /var/www/qmzgai/app/dist/
```

#### 3.4 é…ç½® Nginx

```bash
# å¤åˆ¶ Nginx é…ç½®
sudo cp /root/nginx/qmzgai.conf /etc/nginx/conf.d/

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½ Nginx
sudo systemctl reload nginx
```

#### 3.5 éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥åç«¯
curl http://localhost:3000/health

# æ£€æŸ¥ Docker å®¹å™¨
docker ps

# è®¿é—®ç½‘ç«™
# https://qmzgai.com
```

---

## ğŸ“Š éƒ¨ç½²åæ£€æŸ¥æ¸…å•

### ç½‘ç«™è®¿é—®æ£€æŸ¥

- [ ] âœ… https://qmzgai.com å¯ä»¥è®¿é—®
- [ ] âœ… https://www.qmzgai.com å¯ä»¥è®¿é—®
- [ ] âœ… HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS
- [ ] âœ… SSL è¯ä¹¦æœ‰æ•ˆï¼ˆæµè§ˆå™¨æ˜¾ç¤ºğŸ”’ï¼‰
- [ ] âœ… å‰ç«¯é¡µé¢æ­£å¸¸æ˜¾ç¤º
- [ ] âœ… API æ¥å£æ­£å¸¸å“åº”

### åŠŸèƒ½æµ‹è¯•

- [ ] âœ… ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½
- [ ] âœ… ç”¨æˆ·ç™»å½•åŠŸèƒ½
- [ ] âœ… å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½
- [ ] âœ… æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] âœ… ç¼“å­˜åŠŸèƒ½æ­£å¸¸

### æ€§èƒ½æ£€æŸ¥

- [ ] âœ… é¦–é¡µåŠ è½½æ—¶é—´ < 3ç§’
- [ ] âœ… API å“åº”æ—¶é—´ < 500ms
- [ ] âœ… å›¾ç‰‡åŠ è½½æ­£å¸¸
- [ ] âœ… Gzip å‹ç¼©å·²å¯ç”¨

### å®‰å…¨æ£€æŸ¥

- [ ] âœ… SSL Labs è¯„çº§ A æˆ– A+
- [ ] âœ… é˜²ç«å¢™å·²é…ç½®
- [ ] âœ… SSH ç«¯å£å·²ä¿®æ”¹ï¼ˆå¯é€‰ï¼‰
- [ ] âœ… æ•°æ®åº“ä¸å…è®¸å¤–ç½‘è®¿é—®
- [ ] âœ… æ•æ„Ÿæ–‡ä»¶æƒé™æ­£ç¡®

---

## ğŸ› ï¸ å¸¸ç”¨è¿ç»´å‘½ä»¤

### Docker ç›¸å…³

```bash
# æŸ¥çœ‹è¿è¡Œçš„å®¹å™¨
docker ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# é‡å¯æœåŠ¡
docker-compose restart

# åœæ­¢æœåŠ¡
docker-compose down

# æ›´æ–°å¹¶é‡å¯
docker-compose pull
docker-compose up -d

# æ¸…ç†æœªä½¿ç”¨çš„é•œåƒ
docker system prune -a
```

### Nginx ç›¸å…³

```bash
# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡è½½é…ç½®
sudo systemctl reload nginx

# é‡å¯ Nginx
sudo systemctl restart nginx

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/nginx/qmzgai.access.log
sudo tail -f /var/log/nginx/qmzgai.error.log
```

### SSL è¯ä¹¦ç›¸å…³

```bash
# æŸ¥çœ‹è¯ä¹¦ä¿¡æ¯
sudo certbot certificates

# æ‰‹åŠ¨ç»­æœŸ
sudo certbot renew

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run
```

### ç³»ç»Ÿç›‘æ§

```bash
# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
df -h

# æŸ¥çœ‹å†…å­˜ä½¿ç”¨
free -h

# æŸ¥çœ‹ç½‘ç»œè¿æ¥
netstat -tulpn
```

---

## ğŸ“ˆ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. å¯ç”¨ CDN åŠ é€Ÿ

**æ¨èæœåŠ¡å•†ï¼š**
- è…¾è®¯äº‘ CDN
- é˜¿é‡Œäº‘ CDN
- Cloudflareï¼ˆå…è´¹ï¼‰

**é…ç½®æ­¥éª¤ï¼š**
1. åœ¨ CDN æ§åˆ¶å°æ·»åŠ åŸŸå
2. é…ç½®æºç«™ä¸ºæœåŠ¡å™¨ IP
3. åœ¨ DNS ä¸­å°†åŸŸå CNAME åˆ° CDN åœ°å€

### 2. å¯ç”¨ Redis ç¼“å­˜

```bash
# å®‰è£… Redis
docker run -d --name redis \
  -p 6379:6379 \
  --restart always \
  redis:alpine

# åœ¨åç«¯é…ç½® Redis
# .env.production
REDIS_HOST=localhost
REDIS_PORT=6379
```

### 3. é…ç½®æ•°æ®åº“è¿æ¥æ± 

åœ¨åç«¯é…ç½®ä¸­ä¼˜åŒ–æ•°æ®åº“è¿æ¥ï¼š
```javascript
// server/src/config/database.ts
export const pool = new Pool({
  max: 20,  // æœ€å¤§è¿æ¥æ•°
  min: 5,   // æœ€å°è¿æ¥æ•°
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 2000,
});
```

### 4. å¯ç”¨ Gzip å‹ç¼©

åœ¨ Nginx é…ç½®ä¸­ï¼ˆå·²åŒ…å«åœ¨æ¨¡æ¿ä¸­ï¼‰ï¼š
```nginx
gzip on;
gzip_vary on;
gzip_comp_level 6;
gzip_types text/plain text/css application/json application/javascript;
```

---

## ğŸ” å®‰å…¨åŠ å›ºå»ºè®®

### 1. ä¿®æ”¹ SSH ç«¯å£

```bash
# ç¼–è¾‘ SSH é…ç½®
sudo vim /etc/ssh/sshd_config

# ä¿®æ”¹ç«¯å£ï¼ˆä¾‹å¦‚æ”¹ä¸º 2222ï¼‰
Port 2222

# é‡å¯ SSH
sudo systemctl restart sshd

# æ›´æ–°é˜²ç«å¢™
sudo ufw allow 2222/tcp
```

### 2. ç¦ç”¨ root ç™»å½•

```bash
# åˆ›å»ºæ™®é€šç”¨æˆ·
sudo adduser qmzgai
sudo usermod -aG sudo qmzgai

# ç¦ç”¨ root SSH ç™»å½•
sudo vim /etc/ssh/sshd_config
# PermitRootLogin no
```

### 3. é…ç½® Fail2ban

```bash
# å®‰è£… Fail2ban
sudo apt-get install fail2ban

# é…ç½® Nginx é˜²æŠ¤
sudo vim /etc/fail2ban/jail.local
```

```ini
[nginx-http-auth]
enabled = true
port = http,https
logpath = /var/log/nginx/error.log

[nginx-noscript]
enabled = true
port = http,https
logpath = /var/log/nginx/access.log
```

---

## ğŸ“ é‡åˆ°é—®é¢˜ï¼Ÿ

### å¸¸è§é—®é¢˜å¿«é€Ÿæ’æŸ¥

**é—®é¢˜ 1ï¼šç½‘ç«™æ— æ³•è®¿é—®**
```bash
# æ£€æŸ¥ Nginx çŠ¶æ€
sudo systemctl status nginx

# æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# æ£€æŸ¥ DNS
dig qmzgai.com +short
```

**é—®é¢˜ 2ï¼šSSL è¯ä¹¦é”™è¯¯**
```bash
# æ£€æŸ¥è¯ä¹¦æœ‰æ•ˆæœŸ
sudo certbot certificates

# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run
```

**é—®é¢˜ 3ï¼šAPI æ— æ³•è¿æ¥**
```bash
# æ£€æŸ¥åç«¯æœåŠ¡
curl http://localhost:3000/health

# æŸ¥çœ‹åç«¯æ—¥å¿—
docker-compose logs server
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [DNS é…ç½®æŒ‡å—](./DNSå¿«é€Ÿé…ç½®æŒ‡å—-è…¾è®¯äº‘.md)
- [SSL é…ç½®å®Œå…¨æŒ‡å—](./SSLé…ç½®å®Œå…¨æŒ‡å—.md)
- [Docker éƒ¨ç½²æ–‡æ¡£](./DEPLOYMENT_GUIDE.md)
- [Nginx é…ç½®](./nginx/qmzgai.conf)

---

## ğŸ‰ éƒ¨ç½²å®Œæˆå

**æ­å–œï¼ä½ çš„ç½‘ç«™å·²æˆåŠŸä¸Šçº¿ï¼**

**è®¿é—®åœ°å€ï¼š**
- ä¸»ç«™ï¼šhttps://qmzgai.com
- APIï¼šhttps://qmzgai.com/api

**åç»­å·¥ä½œï¼š**
1. âœ… é…ç½® CDN åŠ é€Ÿ
2. âœ… è®¾ç½®æœåŠ¡ç›‘æ§
3. âœ… é…ç½®è‡ªåŠ¨å¤‡ä»½
4. âœ… ä¼˜åŒ– SEO
5. âœ… åŸŸåå¤‡æ¡ˆï¼ˆå¦‚æœåŠ¡å™¨åœ¨ä¸­å›½å¤§é™†ï¼‰

---

**éƒ¨ç½²æ—¶é—´ï¼š** é¢„è®¡ 1-2 å°æ—¶
**ç»´æŠ¤æˆæœ¬ï¼š** ä½ï¼ˆè‡ªåŠ¨åŒ–éƒ¨ç½² + è‡ªåŠ¨ç»­æœŸï¼‰
**æ–‡æ¡£ç‰ˆæœ¬ï¼š** v1.0
**æ›´æ–°æ—¥æœŸï¼š** 2026-01-28
