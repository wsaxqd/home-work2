# å·¥ä¸šçº§ Docker é•œåƒéƒ¨ç½²æ–¹æ¡ˆ

## ðŸ“‹ éƒ¨ç½²æž¶æž„

```
å¼€å‘æœº/CIæœåŠ¡å™¨          é•œåƒä»“åº“              ç”Ÿäº§æœåŠ¡å™¨
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æºä»£ç       â”‚         â”‚          â”‚         â”‚          â”‚
â”‚   â†“         â”‚  push   â”‚  Docker  â”‚  pull   â”‚  å®¹å™¨    â”‚
â”‚ æž„å»ºé•œåƒ    â”‚ â”€â”€â”€â”€â”€â†’  â”‚  Harbor  â”‚ â”€â”€â”€â”€â”€â†’  â”‚  è¿è¡Œ    â”‚
â”‚ æŽ¨é€é•œåƒ    â”‚         â”‚  /é˜¿é‡Œäº‘ â”‚         â”‚          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**æ ¸å¿ƒåŽŸåˆ™ï¼š**
- âœ… æºç åªåœ¨å¼€å‘æœº/CIæœåŠ¡å™¨
- âœ… ç”Ÿäº§æœåŠ¡å™¨åªæ‹‰å–é•œåƒ
- âœ… ä½¿ç”¨ç§æœ‰é•œåƒä»“åº“
- âœ… é•œåƒå¸¦ç‰ˆæœ¬æ ‡ç­¾
- âœ… æ”¯æŒå¿«é€Ÿå›žæ»š

---

## ðŸŽ¯ æ–¹æ¡ˆå¯¹æ¯”

### âŒ æ—§æ–¹æ¡ˆï¼ˆä¸æŽ¨èï¼‰
```bash
# 1. ä¸Šä¼ æºç åˆ°æœåŠ¡å™¨
scp -r ./project root@server:/app/

# 2. åœ¨æœåŠ¡å™¨ä¸Šæž„å»º
ssh root@server "cd /app && docker-compose build"

# 3. å¯åŠ¨æœåŠ¡
ssh root@server "cd /app && docker-compose up -d"
```

**ç¼ºç‚¹ï¼š**
- æºç æš´éœ²åœ¨ç”Ÿäº§æœåŠ¡å™¨
- æž„å»ºå ç”¨æœåŠ¡å™¨èµ„æº
- æž„å»ºæ—¶é—´é•¿ï¼ˆ10-20åˆ†é’Ÿï¼‰
- æž„å»ºå¤±è´¥å½±å“ç”Ÿäº§çŽ¯å¢ƒ

---

### âœ… æ–°æ–¹æ¡ˆï¼ˆæŽ¨èï¼‰
```bash
# 1. æœ¬åœ°æž„å»ºé•œåƒ
docker build -t registry.example.com/qmzg-server:v1.0.0 ./server

# 2. æŽ¨é€åˆ°é•œåƒä»“åº“
docker push registry.example.com/qmzg-server:v1.0.0

# 3. æœåŠ¡å™¨æ‹‰å–é•œåƒ
ssh root@server "docker pull registry.example.com/qmzg-server:v1.0.0"

# 4. å¯åŠ¨æœåŠ¡
ssh root@server "cd /app && docker-compose up -d"
```

**ä¼˜ç‚¹ï¼š**
- âœ… æºç ä¸ä¸Šä¼ æœåŠ¡å™¨
- âœ… æž„å»ºåœ¨å¼€å‘æœº/CI
- âœ… éƒ¨ç½²é€Ÿåº¦å¿«ï¼ˆ1-2åˆ†é’Ÿï¼‰
- âœ… æ”¯æŒç‰ˆæœ¬ç®¡ç†å’Œå›žæ»š
- âœ… å¯åŒæ—¶éƒ¨ç½²å¤šå°æœåŠ¡å™¨

---

## ðŸ—ï¸ ç¬¬ä¸€æ­¥ï¼šé€‰æ‹©é•œåƒä»“åº“

### æ–¹æ¡ˆ 1ï¼šé˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆæŽ¨èï¼‰

**ä¼˜ç‚¹ï¼š**
- å…è´¹ä¸ªäººç‰ˆï¼ˆ3ä¸ªå‘½åç©ºé—´ï¼‰
- å›½å†…è®¿é—®é€Ÿåº¦å¿«
- ä¸Žé˜¿é‡Œäº‘ ECS é›†æˆå¥½
- æ”¯æŒé•œåƒå®‰å…¨æ‰«æ

**ä»·æ ¼ï¼š**
- ä¸ªäººç‰ˆï¼šå…è´¹
- ä¼ä¸šç‰ˆï¼š280å…ƒ/æœˆèµ·

**é…ç½®æ­¥éª¤ï¼š**

1. ç™»å½•é˜¿é‡Œäº‘å®¹å™¨é•œåƒæœåŠ¡ï¼šhttps://cr.console.aliyun.com/

2. åˆ›å»ºå‘½åç©ºé—´ï¼š`qmzg`

3. åˆ›å»ºé•œåƒä»“åº“ï¼š
   - `qmzg/server`ï¼ˆåŽç«¯ï¼‰
   - `qmzg/frontend`ï¼ˆå‰ç«¯ï¼‰
   - `qmzg/nginx`ï¼ˆNginxï¼‰

4. èŽ·å–ç™»å½•å‡­è¯ï¼š
   ```bash
   # ç™»å½•é•œåƒä»“åº“
   docker login --username=ä½ çš„é˜¿é‡Œäº‘è´¦å· registry.cn-hangzhou.aliyuncs.com
   ```

---

### æ–¹æ¡ˆ 2ï¼šè…¾è®¯äº‘å®¹å™¨é•œåƒæœåŠ¡

**ä¼˜ç‚¹ï¼š**
- ä¸Žè…¾è®¯äº‘ CVM é›†æˆ
- å›½å†…è®¿é—®é€Ÿåº¦å¿«
- ä¼ä¸šç‰ˆåŠŸèƒ½ä¸°å¯Œ

**ä»·æ ¼ï¼š**
- ä¸ªäººç‰ˆï¼šå…è´¹
- ä¼ä¸šç‰ˆï¼š680å…ƒ/æœˆèµ·

**é…ç½®æ­¥éª¤ï¼š**

1. ç™»å½•è…¾è®¯äº‘å®¹å™¨é•œåƒæœåŠ¡ï¼šhttps://console.cloud.tencent.com/tcr/

2. åˆ›å»ºä¸ªäººç‰ˆå®žä¾‹ï¼ˆå…è´¹ï¼‰

3. åˆ›å»ºå‘½åç©ºé—´ï¼š`qmzg`

4. ç™»å½•é•œåƒä»“åº“ï¼š
   ```bash
   docker login --username=ä½ çš„è…¾è®¯äº‘è´¦å· ccr.ccs.tencentyun.com
   ```

---

### æ–¹æ¡ˆ 3ï¼šDocker Hubï¼ˆå…¬å…±ä»“åº“ï¼‰

**ä¼˜ç‚¹ï¼š**
- å…¨çƒé€šç”¨
- å…è´¹ï¼ˆç§æœ‰ä»“åº“æœ‰é™åˆ¶ï¼‰

**ç¼ºç‚¹ï¼š**
- å›½å†…è®¿é—®è¾ƒæ…¢
- å…è´¹ç‰ˆåªèƒ½ 1 ä¸ªç§æœ‰ä»“åº“

**é…ç½®æ­¥éª¤ï¼š**

1. æ³¨å†Œ Docker Hubï¼šhttps://hub.docker.com/

2. åˆ›å»ºä»“åº“ï¼š
   - `your-username/qmzg-server`
   - `your-username/qmzg-frontend`

3. ç™»å½•ï¼š
   ```bash
   docker login
   ```

---

### æ–¹æ¡ˆ 4ï¼šè‡ªå»º Harborï¼ˆä¼ä¸šçº§ï¼‰

**é€‚ç”¨åœºæ™¯ï¼š**
- å¤§åž‹ä¼ä¸š
- æœ‰ä¸“ä¸šè¿ç»´å›¢é˜Ÿ
- å¯¹å®‰å…¨è¦æ±‚æžé«˜

**æˆæœ¬ï¼š**
- æœåŠ¡å™¨ï¼š2æ ¸4G èµ·
- è¿ç»´äººåŠ›æˆæœ¬

---

## ðŸŽ¨ æŽ¨èé…ç½®

åŸºäºŽä½ çš„æƒ…å†µï¼ˆè…¾è®¯äº‘åŸŸåï¼‰ï¼ŒæŽ¨èä½¿ç”¨ï¼š

**è…¾è®¯äº‘å®¹å™¨é•œåƒæœåŠ¡ï¼ˆä¸ªäººç‰ˆï¼‰**

**é•œåƒå‘½åè§„èŒƒï¼š**
```
ccr.ccs.tencentyun.com/qmzg/server:v1.0.0
ccr.ccs.tencentyun.com/qmzg/frontend:v1.0.0
ccr.ccs.tencentyun.com/qmzg/nginx:v1.0.0
```

**ç‰ˆæœ¬å·è§„èŒƒï¼š**
- `v1.0.0` - ç¨³å®šç‰ˆæœ¬
- `v1.0.0-rc.1` - é¢„å‘å¸ƒç‰ˆæœ¬
- `latest` - æœ€æ–°ç‰ˆæœ¬ï¼ˆä¸æŽ¨èç”Ÿäº§ä½¿ç”¨ï¼‰
- `dev` - å¼€å‘ç‰ˆæœ¬

---

## ðŸ“ é…ç½®æ¸…å•

### 1. åˆ›å»ºé•œåƒä»“åº“å‡­è¯æ–‡ä»¶

```bash
# åœ¨æœåŠ¡å™¨ä¸Šåˆ›å»º Docker é…ç½®ç›®å½•
mkdir -p /root/.docker

# åˆ›å»ºå‡­è¯æ–‡ä»¶
cat > /root/.docker/config.json << 'EOF'
{
  "auths": {
    "ccr.ccs.tencentyun.com": {
      "username": "ä½ çš„è…¾è®¯äº‘è´¦å·",
      "password": "ä½ çš„é•œåƒä»“åº“å¯†ç ",
      "email": "ä½ çš„é‚®ç®±"
    }
  }
}
EOF
```

### 2. æµ‹è¯•é•œåƒä»“åº“è¿žæŽ¥

```bash
# ç™»å½•é•œåƒä»“åº“
docker login ccr.ccs.tencentyun.com

# æµ‹è¯•æŽ¨é€
docker pull hello-world
docker tag hello-world ccr.ccs.tencentyun.com/qmzg/test:latest
docker push ccr.ccs.tencentyun.com/qmzg/test:latest

# æµ‹è¯•æ‹‰å–
docker rmi ccr.ccs.tencentyun.com/qmzg/test:latest
docker pull ccr.ccs.tencentyun.com/qmzg/test:latest
```

---

## ðŸŽ¯ ä¸‹ä¸€æ­¥

æˆ‘å°†ä¸ºä½ åˆ›å»ºï¼š

1. **ä¼˜åŒ–åŽçš„ Dockerfile**ï¼ˆå¤šé˜¶æ®µæž„å»ºï¼‰
2. **ç”Ÿäº§çŽ¯å¢ƒ docker-compose.yml**ï¼ˆåªæ‹‰å–é•œåƒï¼‰
3. **æœ¬åœ°æž„å»ºè„šæœ¬**ï¼ˆbuild.shï¼‰
4. **é•œåƒæŽ¨é€è„šæœ¬**ï¼ˆpush.shï¼‰
5. **æœåŠ¡å™¨éƒ¨ç½²è„šæœ¬**ï¼ˆdeploy.shï¼‰
6. **CI/CD é…ç½®**ï¼ˆGitHub Actionsï¼‰

---

**å‡†å¤‡æ—¶é—´ï¼š** 2026-01-28
**é•œåƒä»“åº“ï¼š** è…¾è®¯äº‘å®¹å™¨é•œåƒæœåŠ¡
**éƒ¨ç½²æ–¹å¼ï¼š** çº¯é•œåƒéƒ¨ç½²ï¼ˆæ— æºç ï¼‰
