# ğŸš€ ä¸ªæ€§åŒ–å­¦ä¹ å¼•æ“ - å¿«é€Ÿä¸Šæ‰‹æŒ‡å—

> **ç›®æ ‡ç”¨æˆ·**: å‰ç«¯å¼€å‘è€…
> **é˜…è¯»æ—¶é—´**: 5åˆ†é’Ÿ
> **å‰ç½®æ¡ä»¶**: äº†è§£Reactã€TypeScriptã€HTTPè¯·æ±‚

---

## ğŸ“‹ åŠŸèƒ½æ¦‚è§ˆ

ä¸ªæ€§åŒ–å­¦ä¹ å¼•æ“æä¾›ä»¥ä¸‹æ ¸å¿ƒåŠŸèƒ½ï¼š

1. **æ™ºèƒ½è¯Šæ–­** - è‡ªåŠ¨è¯†åˆ«è–„å¼±çŸ¥è¯†ç‚¹
2. **ä¸ªæ€§åŒ–è·¯å¾„** - ç”Ÿæˆå®šåˆ¶åŒ–å­¦ä¹ è®¡åˆ’
3. **è‡ªé€‚åº”éš¾åº¦** - æ ¹æ®ç­”é¢˜æƒ…å†µåŠ¨æ€è°ƒæ•´
4. **æ™ºèƒ½æ¨è** - æ¨èæœ€é€‚åˆçš„å­¦ä¹ å†…å®¹
5. **æ•°æ®åˆ†æ** - å¯è§†åŒ–å­¦ä¹ è¿›åº¦å’ŒæŒæ¡æƒ…å†µ

---

## ğŸ”Œ APIæ¥å£é€ŸæŸ¥

**Base URL**: `http://localhost:3000/api/adaptive-learning`

### 1. è·å–çŸ¥è¯†å›¾è°±

```http
GET /knowledge-graph?subject=math&grade=grade_3
Authorization: Bearer <token>
```

**ç”¨é€”**: åœ¨å­¦ä¹ åœ°å›¾é¡µé¢æ˜¾ç¤ºçŸ¥è¯†ç‚¹å…³ç³»

---

### 2. æäº¤ç­”é¢˜è®°å½•

```http
POST /submit-answer
Content-Type: application/json
Authorization: Bearer <token>

{
  "knowledgePointId": "math_g3_multiplication",
  "difficultyLevel": 2,
  "isCorrect": true,
  "answerTime": 15
}
```

**ç”¨é€”**: åšé¢˜é¡µé¢æäº¤ç­”æ¡ˆåè°ƒç”¨

**å“åº”**: åŒ…å«ä¸‹ä¸€é¢˜éš¾åº¦å»ºè®®å’ŒæŒæ¡åº¦æ›´æ–°

---

### 3. è·å–è–„å¼±ç‚¹è¯Šæ–­

```http
GET /weak-points?subject=math
Authorization: Bearer <token>
```

**ç”¨é€”**: è–„å¼±ç‚¹è¯Šæ–­ä¸­å¿ƒé¡µé¢

**å“åº”**: è¿”å›æ‰€æœ‰è–„å¼±çŸ¥è¯†ç‚¹åŠè¯Šæ–­åŸå› 

---

### 4. ç”Ÿæˆå­¦ä¹ è·¯å¾„

```http
POST /generate-path
Content-Type: application/json
Authorization: Bearer <token>

{
  "subject": "math",
  "grade": "grade_3",
  "goal": "improve_weak_points",
  "timeConstraint": 10,
  "dailyTimeLimit": 30
}
```

**ç”¨é€”**: ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„é¡µé¢

**å“åº”**: è¿”å›åŒ…å«8-15æ­¥çš„å­¦ä¹ è·¯å¾„

---

### 5. è·å–æ™ºèƒ½æ¨è

```http
GET /recommendations?limit=5
Authorization: Bearer <token>
```

**ç”¨é€”**: é¦–é¡µæ¨èã€å­¦ä¹ åœ°å›¾æ¨è

**å“åº”**: è¿”å›5æ¡ä¼˜å…ˆçº§æ’åºçš„æ¨è

---

### 6. è·å–å­¦ä¹ åˆ†ææŠ¥å‘Š

```http
GET /analysis-report?subject=math&timeRange=week
Authorization: Bearer <token>
```

**ç”¨é€”**: å­¦ä¹ æ•°æ®çœ‹æ¿ã€æˆé•¿æŠ¥å‘Š

**å“åº”**: åŒ…å«å­¦ä¹ æ—¶é•¿ã€æ­£ç¡®ç‡ã€è¶‹åŠ¿å›¾æ•°æ®ç­‰

---

## ğŸ’» å‰ç«¯ç¤ºä¾‹ä»£ç 

### ç¤ºä¾‹1: è·å–å¹¶æ˜¾ç¤ºè–„å¼±ç‚¹

```typescript
import { useState, useEffect } from 'react';

function WeakPointsPage() {
  const [weakPoints, setWeakPoints] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    fetchWeakPoints();
  }, []);

  const fetchWeakPoints = async () => {
    try {
      const response = await fetch(
        'http://localhost:3000/api/adaptive-learning/weak-points?subject=math',
        {
          headers: {
            'Authorization': `Bearer ${localStorage.getItem('token')}`
          }
        }
      );
      const data = await response.json();
      if (data.success) {
        setWeakPoints(data.data.weakPoints);
      }
    } catch (error) {
      console.error('è·å–è–„å¼±ç‚¹å¤±è´¥:', error);
    } finally {
      setLoading(false);
    }
  };

  if (loading) return <div>åŠ è½½ä¸­...</div>;

  return (
    <div className="weak-points-page">
      <h1>è–„å¼±ç‚¹è¯Šæ–­ä¸­å¿ƒ</h1>
      <p>å‘ç° {weakPoints.length} ä¸ªè–„å¼±çŸ¥è¯†ç‚¹</p>

      {weakPoints.map(wp => (
        <div key={wp.knowledgePointId} className="weak-point-card">
          <div className="severity-badge">
            {wp.severity === 'high' ? 'âš ï¸ ä¸¥é‡' : 'âš ï¸ ä¸­ç­‰'}
          </div>
          <h3>{wp.knowledgePointName}</h3>
          <div className="stats">
            <span>æŒæ¡åº¦: {wp.masteryLevel}/5</span>
            <span>æ­£ç¡®ç‡: {wp.accuracyRate}%</span>
          </div>
          <p className="reason">è¯Šæ–­åŸå› : {wp.reason}</p>
          <button onClick={() => startPractice(wp)}>
            å¼€å§‹å¼ºåŒ–
          </button>
        </div>
      ))}
    </div>
  );
}
```

---

### ç¤ºä¾‹2: æäº¤ç­”é¢˜å¹¶å¤„ç†åé¦ˆ

```typescript
const submitAnswer = async (questionData) => {
  try {
    const response = await fetch(
      'http://localhost:3000/api/adaptive-learning/submit-answer',
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: JSON.stringify({
          knowledgePointId: questionData.knowledgePointId,
          difficultyLevel: questionData.difficulty,
          answer: questionData.userAnswer,
          isCorrect: questionData.isCorrect,
          answerTime: questionData.timeSpent
        })
      }
    );

    const data = await response.json();

    if (data.success) {
      const { feedback, nextAction, knowledgePointUpdate } = data.data;

      // æ˜¾ç¤ºåé¦ˆ
      showFeedback(feedback);

      // æ˜¾ç¤ºæŒæ¡åº¦å˜åŒ–
      console.log('æŒæ¡åº¦:', knowledgePointUpdate.currentMastery);

      // è°ƒæ•´ä¸‹ä¸€é¢˜éš¾åº¦
      if (nextAction.type === 'increase_difficulty') {
        loadNextQuestion(nextAction.nextDifficulty);
      } else if (nextAction.type === 'decrease_difficulty') {
        loadNextQuestion(nextAction.nextDifficulty);
      }
    }
  } catch (error) {
    console.error('æäº¤ç­”æ¡ˆå¤±è´¥:', error);
  }
};
```

---

### ç¤ºä¾‹3: ç”Ÿæˆå¹¶æ˜¾ç¤ºå­¦ä¹ è·¯å¾„

```typescript
const generateLearningPath = async () => {
  try {
    const response = await fetch(
      'http://localhost:3000/api/adaptive-learning/generate-path',
      {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Authorization': `Bearer ${localStorage.getItem('token')}`
        },
        body: JSON.stringify({
          subject: 'math',
          grade: 'grade_3',
          goal: 'improve_weak_points',  // æˆ– 'review_all', 'advance_learning'
          timeConstraint: 10,            // 10å¤©å®Œæˆ
          dailyTimeLimit: 30             // æ¯å¤©30åˆ†é’Ÿ
        })
      }
    );

    const data = await response.json();

    if (data.success) {
      const path = data.data;
      console.log('å­¦ä¹ è·¯å¾„å·²ç”Ÿæˆ:', path);
      console.log('æ€»æ­¥éª¤:', path.totalSteps);
      console.log('é¢„è®¡å¤©æ•°:', path.estimatedDays);

      // ä¿å­˜pathIdç”¨äºåç»­æ›´æ–°è¿›åº¦
      localStorage.setItem('currentPathId', path.pathId);

      // æ˜¾ç¤ºå­¦ä¹ è·¯å¾„
      displayLearningPath(path);
    }
  } catch (error) {
    console.error('ç”Ÿæˆå­¦ä¹ è·¯å¾„å¤±è´¥:', error);
  }
};
```

---

## ğŸ¨ UIç»„ä»¶å»ºè®®

### 1. è–„å¼±ç‚¹å¡ç‰‡ç»„ä»¶

```jsx
<WeakPointCard severity="high">
  <SeverityBadge>âš ï¸ ä¸¥é‡</SeverityBadge>
  <Title>ä¹˜æ³•å£è¯€</Title>
  <Stats>
    <StatItem icon="ğŸ¯">æŒæ¡åº¦: 2/5</StatItem>
    <StatItem icon="ğŸ“Š">æ­£ç¡®ç‡: 45.5%</StatItem>
    <StatItem icon="ğŸ”„">é‡å¤é”™è¯¯: 5æ¬¡</StatItem>
  </Stats>
  <Reason>è¿ç»­5æ¬¡ç­”é”™ï¼›é‡å¤é”™è¯¯5æ¬¡</Reason>
  <ActionButton>å¼€å§‹å¼ºåŒ–</ActionButton>
</WeakPointCard>
```

---

### 2. å­¦ä¹ è·¯å¾„æ­¥éª¤ç»„ä»¶

```jsx
<LearningPathStep
  stepNumber={2}
  status="in_progress"  // completed, locked
  knowledgePoint="ä¹˜æ³•å£è¯€"
  estimatedMinutes={30}
>
  <Resources>
    <VideoResource>ä¹˜æ³•å£è¯€å¿«é€Ÿè®°å¿†æ³•</VideoResource>
    <QuestionResource count={10} />
    <GameResource>ä¹˜æ³•å¤§å†’é™©</GameResource>
  </Resources>
  <ProgressBar value={60} />
  <ActionButton>ç»§ç»­å­¦ä¹ </ActionButton>
</LearningPathStep>
```

---

### 3. æŒæ¡åº¦è¿›åº¦æ¡ç»„ä»¶

```jsx
<MasteryProgress
  level={3}
  percentage={60}
  color={getMasteryColor(3)}  // green/yellow/red
>
  <Label>ä¹˜æ³•å£è¯€</Label>
  <ProgressBar value={60} />
  <MasteryLevel>æŒæ¡ä¸­ (3/5)</MasteryLevel>
  <Trend>â†—ï¸ +15%</Trend>
</MasteryProgress>
```

---

## ğŸ¯ é›†æˆåˆ°ç°æœ‰é¡µé¢

### 1. åœ¨å­¦ä¹ åœ°å›¾ä¸­æ·»åŠ æ¨è

```typescript
// LearningMap.tsx
useEffect(() => {
  // è·å–æ¨è
  fetch('/api/adaptive-learning/recommendations?limit=3', {
    headers: { 'Authorization': `Bearer ${token}` }
  })
    .then(res => res.json())
    .then(data => {
      if (data.success) {
        setRecommendations(data.data.recommendations);
      }
    });
}, []);

// æ¸²æŸ“æ¨èåŒºåŸŸ
<RecommendationSection>
  <h3>ğŸ¯ æ¨èå­¦ä¹ </h3>
  {recommendations.map(rec => (
    <RecommendationCard key={rec.id} {...rec} />
  ))}
</RecommendationSection>
```

---

### 2. åœ¨é”™é¢˜æœ¬ä¸­æ·»åŠ è–„å¼±ç‚¹åˆ†æ

```typescript
// WrongQuestions.tsx
const showWeakPointAnalysis = async () => {
  const response = await fetch(
    '/api/adaptive-learning/weak-points?subject=math',
    {
      headers: { 'Authorization': `Bearer ${token}` }
    }
  );
  const data = await response.json();

  if (data.success) {
    setShowAnalysisModal(true);
    setWeakPoints(data.data.weakPoints);
  }
};

// æ·»åŠ æŒ‰é’®
<Button onClick={showWeakPointAnalysis}>
  ğŸ“Š è–„å¼±ç‚¹åˆ†æ
</Button>
```

---

## ğŸ“Š æ•°æ®å¯è§†åŒ–å»ºè®®

### ä½¿ç”¨EChartsæˆ–Recharts

```typescript
import { RadarChart, Radar, PolarGrid, PolarAngleAxis } from 'recharts';

// çŸ¥è¯†ç‚¹æŒæ¡åº¦é›·è¾¾å›¾
const knowledgeMasteryData = [
  { subject: 'åŠ æ³•', value: 90 },
  { subject: 'ä¹˜æ³•', value: 45 },
  { subject: 'é™¤æ³•', value: 20 },
  { subject: 'åº”ç”¨é¢˜', value: 0 }
];

<RadarChart data={knowledgeMasteryData}>
  <PolarGrid />
  <PolarAngleAxis dataKey="subject" />
  <Radar dataKey="value" stroke="#8884d8" fill="#8884d8" fillOpacity={0.6} />
</RadarChart>
```

---

## ğŸ”” é‡è¦æç¤º

### 1. è®¤è¯Token
æ‰€æœ‰è¯·æ±‚éƒ½éœ€è¦æºå¸¦Bearer Tokenï¼š
```typescript
headers: {
  'Authorization': `Bearer ${localStorage.getItem('token')}`
}
```

### 2. é”™è¯¯å¤„ç†
å»ºè®®ç»Ÿä¸€å¤„ç†APIé”™è¯¯ï¼š
```typescript
const handleApiError = (error) => {
  if (error.response?.status === 401) {
    // è·³è½¬ç™»å½•é¡µ
    router.push('/login');
  } else {
    // æ˜¾ç¤ºé”™è¯¯æç¤º
    toast.error(error.message);
  }
};
```

### 3. æ•°æ®ç¼“å­˜
é¢‘ç¹è°ƒç”¨çš„æ•°æ®å»ºè®®ç¼“å­˜ï¼š
```typescript
// ç¼“å­˜çŸ¥è¯†å›¾è°±æ•°æ®
const useKnowledgeGraph = (subject, grade) => {
  return useQuery(
    ['knowledgeGraph', subject, grade],
    () => fetchKnowledgeGraph(subject, grade),
    {
      staleTime: 5 * 60 * 1000,  // 5åˆ†é’Ÿå†…ä¸é‡æ–°è¯·æ±‚
      cacheTime: 30 * 60 * 1000  // ç¼“å­˜30åˆ†é’Ÿ
    }
  );
};
```

---

## ğŸ‰ å¼€å§‹å¼€å‘

### æ¨èå¼€å‘é¡ºåº:

1. **ç¬¬1å¤©**: è–„å¼±ç‚¹è¯Šæ–­ä¸­å¿ƒé¡µé¢ (æœ€ç®€å•ï¼Œå¯ç«‹å³çœ‹åˆ°æ•ˆæœ)
2. **ç¬¬2å¤©**: ä¸ªæ€§åŒ–å­¦ä¹ è·¯å¾„é¡µé¢
3. **ç¬¬3å¤©**: çŸ¥è¯†æŒæ¡åº¦çœ‹æ¿é¡µé¢
4. **ç¬¬4å¤©**: é›†æˆåˆ°å­¦ä¹ åœ°å›¾å’Œé”™é¢˜æœ¬

### éœ€è¦çš„ç»„ä»¶åº“:
- âœ… **å›¾è¡¨**: recharts æˆ– echarts
- âœ… **UIç»„ä»¶**: antd-mobile æˆ– è‡ªå®šä¹‰
- âœ… **HTTPè¯·æ±‚**: axios æˆ– fetch
- âœ… **çŠ¶æ€ç®¡ç†**: react-query (æ¨è)

---

## ğŸ“ é‡åˆ°é—®é¢˜?

1. **APIè¿”å›401** â†’ æ£€æŸ¥Tokenæ˜¯å¦æœ‰æ•ˆ
2. **APIè¿”å›404** â†’ æ£€æŸ¥URLæ‹¼å†™å’ŒæœåŠ¡å™¨æ˜¯å¦å¯åŠ¨
3. **æ•°æ®ä¸ºç©º** â†’ éœ€è¦å…ˆæäº¤ç­”é¢˜è®°å½•ç”Ÿæˆå­¦ä¹ æ•°æ®
4. **ä¸çŸ¥é“å¦‚ä½•å¯è§†åŒ–** â†’ å‚è€ƒä¸Šé¢çš„ECharts/Rechartsç¤ºä¾‹

---

**ç¥å¼€å‘é¡ºåˆ©ï¼ğŸš€**

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ–‡æ¡£ï¼š`ä¸ªæ€§åŒ–å­¦ä¹ å¼•æ“-è¯¦ç»†è®¾è®¡æ–‡æ¡£.md`
