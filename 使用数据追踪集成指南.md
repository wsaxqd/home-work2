# ä½¿ç”¨æ•°æ®è¿½è¸ªé›†æˆæŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•åœ¨å„¿ç«¥ç«¯å„ä¸ªåŠŸèƒ½é¡µé¢ä¸­é›†æˆä½¿ç”¨æ•°æ®è¿½è¸ªåŠŸèƒ½,ä»¥ä¾¿å®¶é•¿ç«¯èƒ½å¤ŸæŸ¥çœ‹å­©å­çš„å­¦ä¹ å’Œæ¸¸æˆæ•°æ®ã€‚

---

## ğŸ¯ å·²å®Œæˆçš„å·¥ä½œ

### 1. åç«¯API
âœ… åˆ›å»ºäº† `/api/usage/record` æ¥å£ç”¨äºè®°å½•ä½¿ç”¨æ•°æ®
âœ… åˆ›å»ºäº† `/api/usage/records/:userId` æ¥å£ç”¨äºæŸ¥è¯¢ä½¿ç”¨è®°å½•
âœ… åˆ›å»ºäº† `/api/usage/today-stats/:userId` æ¥å£ç”¨äºè·å–ä»Šæ—¥ç»Ÿè®¡

### 2. å‰ç«¯æœåŠ¡
âœ… åˆ›å»ºäº† `usageTracking.ts` æœåŠ¡æ–‡ä»¶
âœ… æä¾›äº† `UsageTracker` ç±»ç”¨äºè‡ªåŠ¨è®¡æ—¶
âœ… æä¾›äº† `quickRecord` å¿«æ·è®°å½•å‡½æ•°

### 3. ç¤ºä¾‹é›†æˆ
âœ… åœ¨ `FruitMatch.tsx` ä¸­å®Œæˆäº†å®Œæ•´çš„é›†æˆç¤ºä¾‹

---

## ğŸ”§ é›†æˆæ­¥éª¤

### æ­¥éª¤1: å¯¼å…¥è¿½è¸ªæœåŠ¡

```typescript
import { UsageTracker } from '../services/usageTracking';
```

### æ­¥éª¤2: åˆ›å»ºè¿½è¸ªå™¨å¼•ç”¨

```typescript
const usageTrackerRef = useRef<UsageTracker | null>(null);
```

### æ­¥éª¤3: åœ¨æ´»åŠ¨å¼€å§‹æ—¶å¯åŠ¨è¿½è¸ª

```typescript
// æ¸¸æˆå¼€å§‹æ—¶
const startGame = () => {
  setIsPlaying(true);

  // åˆ›å»ºå¹¶å¯åŠ¨è¿½è¸ªå™¨
  usageTrackerRef.current = new UsageTracker(
    'æ¸¸æˆ',           // æ´»åŠ¨ç±»å‹
    'æ‰“åœ°é¼ ',         // æ´»åŠ¨æ ‡é¢˜
    { difficulty }    // å¯é€‰çš„å…ƒæ•°æ®
  );
  usageTrackerRef.current.start();
};
```

### æ­¥éª¤4: åœ¨æ´»åŠ¨ç»“æŸæ—¶è®°å½•æ•°æ®

```typescript
// æ¸¸æˆç»“æŸæ—¶
const endGame = () => {
  setIsPlaying(false);

  // è®°å½•æ•°æ®
  if (usageTrackerRef.current) {
    usageTrackerRef.current.end(
      score,  // åˆ†æ•°(å¯é€‰)
      {       // é¢å¤–çš„å…ƒæ•°æ®(å¯é€‰)
        hits: totalHits,
        misses: totalMisses,
      }
    );
    usageTrackerRef.current = null;
  }
};
```

### æ­¥éª¤5: åœ¨ç»„ä»¶å¸è½½æ—¶æ¸…ç†

```typescript
useEffect(() => {
  return () => {
    // å¦‚æœç”¨æˆ·ç¦»å¼€é¡µé¢,å–æ¶ˆè¿½è¸ª
    if (usageTrackerRef.current) {
      usageTrackerRef.current.cancel();
    }
  };
}, []);
```

---

## ğŸ“ å„ç±»å‹é¡µé¢çš„é›†æˆç¤ºä¾‹

### æ¸¸æˆç±»é¡µé¢

```typescript
// ç¤ºä¾‹: WhackAMole.tsx
import { UsageTracker } from '../services/usageTracking';

export default function WhackAMole() {
  const usageTrackerRef = useRef<UsageTracker | null>(null);

  const startGame = () => {
    setIsPlaying(true);
    usageTrackerRef.current = new UsageTracker('æ¸¸æˆ', 'æ‰“åœ°é¼ ');
    usageTrackerRef.current.start();
  };

  const endGame = () => {
    if (usageTrackerRef.current) {
      usageTrackerRef.current.end(score, { timeLeft });
      usageTrackerRef.current = null;
    }
  };

  // æ¸…ç†é€»è¾‘
  useEffect(() => {
    return () => {
      if (usageTrackerRef.current) {
        usageTrackerRef.current.cancel();
      }
    };
  }, []);
}
```

### é˜…è¯»ç±»é¡µé¢

```typescript
// ç¤ºä¾‹: PictureBook.tsx
import { UsageTracker } from '../services/usageTracking';

export default function PictureBook() {
  const usageTrackerRef = useRef<UsageTracker | null>(null);

  // å¼€å§‹é˜…è¯»
  const startReading = (bookTitle: string) => {
    usageTrackerRef.current = new UsageTracker('é˜…è¯»', bookTitle);
    usageTrackerRef.current.start();
  };

  // ç»“æŸé˜…è¯»
  const finishReading = (pagesRead: number) => {
    if (usageTrackerRef.current) {
      usageTrackerRef.current.end(undefined, { pagesRead });
      usageTrackerRef.current = null;
    }
  };
}
```

### åˆ›ä½œç±»é¡µé¢

```typescript
// ç¤ºä¾‹: ArtCreator.tsx
import { UsageTracker } from '../services/usageTracking';

export default function ArtCreator() {
  const usageTrackerRef = useRef<UsageTracker | null>(null);

  // å¼€å§‹åˆ›ä½œ
  useEffect(() => {
    usageTrackerRef.current = new UsageTracker('åˆ›ä½œ', 'ç»˜ç”»åˆ›ä½œ');
    usageTrackerRef.current.start();

    return () => {
      // ç¦»å¼€é¡µé¢æ—¶è‡ªåŠ¨è®°å½•
      if (usageTrackerRef.current) {
        usageTrackerRef.current.end(undefined, {
          completed: isWorkSaved
        });
      }
    };
  }, []);
}
```

---

## ğŸš€ å¿«æ·è®°å½•æ–¹å¼

å¦‚æœä¸éœ€è¦ç²¾ç¡®è®¡æ—¶,å¯ä»¥ä½¿ç”¨å¿«æ·è®°å½•å‡½æ•°:

```typescript
import { quickRecord } from '../services/usageTracking';

// è®°å½•æ¸¸æˆ
await quickRecord.gaming('æ‰“åœ°é¼ ', 180, 95, 5);
// å‚æ•°: æ¸¸æˆå, æ—¶é•¿(ç§’), åˆ†æ•°, å…³å¡

// è®°å½•é˜…è¯»
await quickRecord.reading('å°çº¢å¸½', 300, 10);
// å‚æ•°: ä¹¦å, æ—¶é•¿(ç§’), é¡µæ•°

// è®°å½•åˆ›ä½œ
await quickRecord.creation('ç»˜ç”»', 'æˆ‘çš„å®¶', 600);
// å‚æ•°: åˆ›ä½œç±»å‹, ä½œå“å, æ—¶é•¿(ç§’)

// è®°å½•å­¦ä¹ 
await quickRecord.learning('æ•°å­¦ç»ƒä¹ ', 420, 85);
// å‚æ•°: å­¦ä¹ å†…å®¹, æ—¶é•¿(ç§’), åˆ†æ•°
```

---

## ğŸ“Š æ´»åŠ¨ç±»å‹è¯´æ˜

| æ´»åŠ¨ç±»å‹ | è¯´æ˜ | ç¤ºä¾‹ |
|---------|------|------|
| æ¸¸æˆ | æ‰€æœ‰ç›Šæ™ºæ¸¸æˆ | æ°´æœè¿è¿çœ‹ã€æ‰“åœ°é¼ ã€æ•°å­—æ‹¼å›¾ |
| é˜…è¯» | ç»˜æœ¬ã€æ•…äº‹ã€å››å¤§åè‘— | å°çº¢å¸½ã€è¥¿æ¸¸è®° |
| åˆ›ä½œ | ç»˜ç”»ã€éŸ³ä¹ã€æ•…äº‹åˆ›ä½œ | ç»˜ç”»åˆ›ä½œã€éŸ³ä¹åˆ›ä½œ |
| å­¦ä¹  | AIç™¾ç§‘ã€å­¦ä¹ è¯„ä¼° | AIé—®ç­”ã€çŸ¥è¯†å­¦ä¹  |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»åœ¨ç”¨æˆ·ç™»å½•åæ‰èƒ½è®°å½•æ•°æ®**
   - æœåŠ¡ä¼šè‡ªåŠ¨æ£€æŸ¥ç™»å½•çŠ¶æ€
   - æœªç™»å½•æ—¶ä¼šåœ¨æ§åˆ¶å°è¾“å‡ºè­¦å‘Š

2. **é¿å…é‡å¤è®°å½•**
   - ç¡®ä¿åœ¨æ´»åŠ¨ç»“æŸæ—¶è°ƒç”¨ `end()` æˆ– `cancel()`
   - ä¸è¦åœ¨åŒä¸€ä¸ªæ´»åŠ¨ä¸­å¤šæ¬¡è°ƒç”¨ `start()`

3. **å¤„ç†å¼‚å¸¸æƒ…å†µ**
   - ç”¨æˆ·ä¸­é€”ç¦»å¼€é¡µé¢
   - æ¸¸æˆè¢«æ‰“æ–­
   - ç½‘ç»œè¯·æ±‚å¤±è´¥

4. **å…ƒæ•°æ®å»ºè®®**
   - è®°å½•æœ‰æ„ä¹‰çš„æ•°æ®(éš¾åº¦ã€å…³å¡ã€é¡µæ•°ç­‰)
   - é¿å…è®°å½•æ•æ„Ÿä¿¡æ¯
   - ä¿æŒæ•°æ®ç»“æ„ç®€å•

---

## ğŸ¯ å¾…é›†æˆçš„é¡µé¢æ¸…å•

### æ¸¸æˆç±» (ä¼˜å…ˆçº§: é«˜)
- [ ] WhackAMole.tsx - æ‰“åœ°é¼ 
- [ ] NumberPuzzle.tsx - æ•°å­—æ‹¼å›¾
- [ ] JigsawPuzzle.tsx - æ‹¼å›¾æ¸¸æˆ
- [ ] ChessGame.tsx - å›½é™…è±¡æ£‹
- [ ] ChineseChess.tsx - ä¸­å›½è±¡æ£‹
- [ ] TankBattle.tsx - å¦å…‹å¤§æˆ˜
- [ ] CrystalMatch.tsx - å®çŸ³æ¶ˆæ¶ˆä¹
- [x] FruitMatch.tsx - æ°´æœè¿è¿çœ‹ âœ…

### é˜…è¯»ç±» (ä¼˜å…ˆçº§: é«˜)
- [ ] PictureBook.tsx - ç»˜æœ¬é˜…è¯»
- [ ] FourClassics.tsx - å››å¤§åè‘—
- [ ] StoryLibrary.tsx - æ•…äº‹åº“

### åˆ›ä½œç±» (ä¼˜å…ˆçº§: ä¸­)
- [ ] ArtCreator.tsx - ç»˜ç”»åˆ›ä½œ
- [ ] MusicCreator.tsx - éŸ³ä¹åˆ›ä½œ
- [ ] StoryCreator.tsx - æ•…äº‹åˆ›ä½œ
- [ ] PoemCreator.tsx - è¯—æ­Œåˆ›ä½œ

### å­¦ä¹ ç±» (ä¼˜å…ˆçº§: ä¸­)
- [ ] AIEncyclopedia.tsx - AIç™¾ç§‘
- [ ] Assessment.tsx - å­¦ä¹ è¯„ä¼°

---

## ğŸ” æµ‹è¯•éªŒè¯

### 1. æœ¬åœ°æµ‹è¯•
```bash
# å¯åŠ¨åç«¯æœåŠ¡å™¨
cd server && npm run dev

# å¯åŠ¨å‰ç«¯æœåŠ¡å™¨
cd app && npm run dev
```

### 2. æµ‹è¯•æ­¥éª¤
1. ç™»å½•å„¿ç«¥è´¦å·
2. ç©ä¸€å±€æ¸¸æˆ(å¦‚æ°´æœè¿è¿çœ‹)
3. å®Œæˆæ¸¸æˆ
4. åˆ‡æ¢åˆ°å®¶é•¿ç«¯ç™»å½•
5. æŸ¥çœ‹å­¦ä¹ æ•°æ®é¡µé¢
6. éªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®æ˜¾ç¤º

### 3. æ£€æŸ¥æ•°æ®åº“
```sql
-- æŸ¥çœ‹æœ€è¿‘çš„ä½¿ç”¨è®°å½•
SELECT * FROM usage_logs
ORDER BY created_at DESC
LIMIT 10;
```

---

## ğŸ“ˆ ä¸‹ä¸€æ­¥å·¥ä½œ

1. âœ… å®Œæˆåç«¯APIå¼€å‘
2. âœ… å®Œæˆå‰ç«¯è¿½è¸ªæœåŠ¡
3. âœ… åœ¨ä¸€ä¸ªæ¸¸æˆä¸­å®Œæˆç¤ºä¾‹é›†æˆ
4. â³ åœ¨å…¶ä»–æ¸¸æˆé¡µé¢ä¸­é›†æˆè¿½è¸ª
5. â³ åœ¨é˜…è¯»é¡µé¢ä¸­é›†æˆè¿½è¸ª
6. â³ åœ¨åˆ›ä½œé¡µé¢ä¸­é›†æˆè¿½è¸ª
7. â³ å®ç°æ—¶é—´æ§åˆ¶æ‰§è¡Œé€»è¾‘
8. â³ å®ç°å†…å®¹è®¿é—®æ§åˆ¶æ‰§è¡Œ

---

## ğŸ’¡ æœ€ä½³å®è·µ

1. **ç»Ÿä¸€å‘½åè§„èŒƒ**
   - æ¸¸æˆåç§°ä½¿ç”¨ä¸­æ–‡
   - ä¿æŒå‘½åç®€æ´æ˜äº†

2. **åˆç†çš„å…ƒæ•°æ®**
   - è®°å½•å¯¹åˆ†ææœ‰ç”¨çš„æ•°æ®
   - é¿å…è¿‡åº¦è®°å½•

3. **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**
   - è®°å½•è¿‡ç¨‹ä¸åº”å½±å“æ€§èƒ½
   - å¤±è´¥æ—¶é™é»˜å¤„ç†,ä¸æ‰“æ–­ç”¨æˆ·

4. **æ•°æ®éšç§**
   - ä¸è®°å½•ä¸ªäººæ•æ„Ÿä¿¡æ¯
   - éµå®ˆæ•°æ®ä¿æŠ¤è§„èŒƒ

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜,è¯·å‚è€ƒ:
- åç«¯APIæ–‡æ¡£: `å®¶é•¿ç«¯åç«¯å®ç°æŒ‡å—.md`
- å‰ç«¯æœåŠ¡ä»£ç : `app/src/services/usageTracking.ts`
- ç¤ºä¾‹ä»£ç : `app/src/pages/FruitMatch.tsx`
