# 腾讯云容器镜像服务激活指南

## 错误原因

你遇到的错误 `ResourceNotFound.ErrNoUser` 表示：
- **还未激活腾讯云容器镜像服务（TCR）**
- 需要先开通服务才能使用

---

## 快速激活步骤（5分钟）

### 方法 1：个人版（免费，推荐）

#### 1. 访问腾讯云容器镜像服务控制台

https://console.cloud.tencent.com/tcr

#### 2. 点击「立即开通」

- 选择「个人版」（免费）
- 阅读服务协议并勾选
- 点击「确定」

#### 3. 创建命名空间

开通后自动进入控制台，点击左侧「命名空间」：

```
命名空间名称：qmzg
访问级别：私有
```

#### 4. 创建镜像仓库

点击左侧「镜像仓库」→「创建」：

```
仓库名称：qmzg-server
命名空间：qmzg
仓库类型：私有
详细描述：启蒙之光后端服务镜像
```

重复创建：
- `qmzg-frontend` - 前端镜像
- `qmzg-nginx` - Nginx镜像

#### 5. 获取登录凭证

点击右上角用户名 → 「访问凭证」：

```
用户名：你的腾讯云账号ID（一般是100开头的数字）
密码：点击「生成密码」
```

**重要：** 复制并保存这个密码！

---

## 测试镜像仓库连接

```bash
# 1. 登录镜像仓库
docker login ccr.ccs.tencentyun.com
# 输入用户名：你的账号ID
# 输入密码：刚才生成的密码

# 2. 测试推送（使用hello-world镜像测试）
docker pull hello-world
docker tag hello-world ccr.ccs.tencentyun.com/qmzg/test:latest
docker push ccr.ccs.tencentyun.com/qmzg/test:latest

# 3. 测试拉取
docker rmi ccr.ccs.tencentyun.com/qmzg/test:latest
docker pull ccr.ccs.tencentyun.com/qmzg/test:latest
```

如果以上命令都成功，说明镜像仓库配置正确！

---

## 更新 build-and-push.sh 配置

激活服务后，需要更新构建脚本中的配置：

```bash
# 编辑 build-and-push.sh
vim build-and-push.sh
```

确认以下配置正确：

```bash
# 镜像仓库配置
REGISTRY_URL="ccr.ccs.tencentyun.com"
REGISTRY_NAMESPACE="qmzg"  # 你创建的命名空间
```

---

## 方法 2：企业版（付费，功能更强）

如果你需要更多功能（镜像安全扫描、高可用、更大存储）：

**价格：** 680元/月起

#### 优点：
- 独立域名
- 更高的并发拉取速度
- 镜像安全扫描
- 支持跨地域同步
- SLA 保障

#### 开通方式：
1. 访问：https://console.cloud.tencent.com/tcr
2. 选择「企业版」
3. 按需选择配置
4. 支付并创建实例

---

## 镜像仓库地址说明

开通个人版后，你的镜像地址格式：

```
ccr.ccs.tencentyun.com/qmzg/qmzg-server:v1.0.0
    ↑                    ↑      ↑          ↑
  仓库地址            命名空间  镜像名      版本
```

---

## 常见问题

### Q1：个人版有什么限制？

- 命名空间：最多 10 个
- 镜像仓库：每个命名空间最多 500 个
- 镜像版本：每个仓库最多 100 个
- 存储空间：10GB
- 网络流量：无限制（但速度可能受限）

### Q2：个人版适合生产环境吗？

- ✅ 适合：小型项目、个人项目、MVP
- ❌ 不适合：高并发、大规模、对SLA有要求的企业项目

### Q3：可以从个人版升级到企业版吗？

- 可以，但需要手动迁移镜像
- 建议提前规划，避免后期迁移

### Q4：忘记密码怎么办？

- 控制台 → 访问凭证 → 重置密码

---

## 下一步

激活成功后，你可以：

1. **构建并推送镜像**
   ```bash
   ./build-and-push.sh v1.0.0 --push
   ```

2. **在生产服务器拉取镜像**
   ```bash
   docker login ccr.ccs.tencentyun.com
   docker pull ccr.ccs.tencentyun.com/qmzg/qmzg-server:v1.0.0
   ```

3. **使用 docker-compose 部署**
   ```bash
   VERSION=v1.0.0 docker-compose -f docker-compose.prod-image.yml up -d
   ```

---

**文档创建时间：** 2026-01-28
**腾讯云服务：** 容器镜像服务（TCR）
**服务类型：** 个人版（免费）

