# å¯è’™ä¹‹å…‰ - è…¾è®¯äº‘é•œåƒæ¨é€å®Œæ•´æŒ‡å—

## ğŸ“¦ é•œåƒä¿¡æ¯

**ä»“åº“åœ°å€:** `ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu`

**é•œåƒæ ‡ç­¾:**
- åç«¯æœåŠ¡: `ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest` (196MB)
- å‰ç«¯åº”ç”¨: `ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest` (82MB)

---

## ğŸš€ å¿«é€Ÿæ¨é€(3æ­¥å®Œæˆ)

### æ–¹æ³•1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ â­æ¨è

**æ­¥éª¤1:** åŒå‡»è¿è¡Œè„šæœ¬
```bash
push-to-ccr.bat
```

**æ­¥éª¤2:** æŒ‰æç¤ºç™»å½•è…¾è®¯äº‘
- è®¿é—®: https://console.cloud.tencent.com/tke2/registry
- ç‚¹å‡»"è®¿é—®å‡­è¯" - "ç”Ÿæˆä¸´æ—¶ç™»å½•æŒ‡ä»¤"
- åœ¨æ–°çª—å£æ‰§è¡Œç™»å½•å‘½ä»¤

**æ­¥éª¤3:** ç­‰å¾…æ¨é€å®Œæˆ(çº¦5-10åˆ†é’Ÿ)

---

### æ–¹æ³•2: æ‰‹åŠ¨æ¨é€

#### 1ï¸âƒ£ ç™»å½•è…¾è®¯äº‘é•œåƒä»“åº“

è®¿é—®æ§åˆ¶å°è·å–ç™»å½•å‘½ä»¤:
```
https://console.cloud.tencent.com/tke2/registry
```

æ‰§è¡Œç™»å½•:
```bash
docker login --username=ä½ çš„ç”¨æˆ·å ccr.ccs.tencentyun.com
# è¾“å…¥å¯†ç 
```

#### 2ï¸âƒ£ ç¡®è®¤é•œåƒå·²æ‰“æ ‡ç­¾

```bash
docker images | grep ccr.ccs.tencentyun.com
```

åº”è¯¥çœ‹åˆ°:
```
ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu   server-latest   ...   196MB
ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu   app-latest      ...   82.2MB
```

âœ… å¦‚æœçœ‹åˆ°ä»¥ä¸Šè¾“å‡º,è¯´æ˜æ ‡ç­¾å·²ç»è®¾ç½®å¥½äº†!

#### 3ï¸âƒ£ æ¨é€åç«¯é•œåƒ

```bash
docker push ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest
```

é¢„è®¡è€—æ—¶: 3-5åˆ†é’Ÿ (å–å†³äºç½‘ç»œé€Ÿåº¦)

#### 4ï¸âƒ£ æ¨é€å‰ç«¯é•œåƒ

```bash
docker push ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest
```

é¢„è®¡è€—æ—¶: 2-3åˆ†é’Ÿ

---

## âœ… éªŒè¯æ¨é€ç»“æœ

### æ–¹æ³•1: åœ¨æ§åˆ¶å°æŸ¥çœ‹

è®¿é—®:
```
https://console.cloud.tencent.com/tke2/registry/user/space
```

1. ç‚¹å‡»å‘½åç©ºé—´ `qmzg-ai-edu`
2. ç‚¹å‡»ä»“åº“ `qmzg-edu`
3. æŸ¥çœ‹é•œåƒç‰ˆæœ¬åˆ—è¡¨

åº”è¯¥èƒ½çœ‹åˆ°:
- `server-latest` (çº¦196MB)
- `app-latest` (çº¦82MB)

### æ–¹æ³•2: å‘½ä»¤è¡ŒéªŒè¯

å°è¯•æ‹‰å–é•œåƒ:
```bash
docker pull ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest
docker pull ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest
```

å¦‚æœèƒ½æˆåŠŸæ‹‰å–,è¯´æ˜æ¨é€æˆåŠŸ! âœ…

---

## ğŸ”§ å¸¸è§é—®é¢˜æ’æŸ¥

### âŒ é—®é¢˜1: "unauthorized: authentication required"

**åŸå› :** æœªç™»å½•æˆ–ç™»å½•å·²è¿‡æœŸ

**è§£å†³:**
```bash
# é‡æ–°ç™»å½•
docker login ccr.ccs.tencentyun.com
```

---

### âŒ é—®é¢˜2: "denied: requested access to the resource is denied"

**åŸå› :**
- å‘½åç©ºé—´ä¸å­˜åœ¨
- ä»“åº“ä¸å­˜åœ¨
- æ²¡æœ‰æ¨é€æƒé™

**è§£å†³:**
1. è®¿é—®æ§åˆ¶å°: https://console.cloud.tencent.com/tke2/registry/user/space
2. ç¡®è®¤å‘½åç©ºé—´ `qmzg-ai-edu` å­˜åœ¨
3. å¦‚æœä¸å­˜åœ¨,ç‚¹å‡»"æ–°å»ºå‘½åç©ºé—´"åˆ›å»º
4. ä»“åº“ä¼šåœ¨é¦–æ¬¡æ¨é€æ—¶è‡ªåŠ¨åˆ›å»º

---

### âŒ é—®é¢˜3: æ¨é€é€Ÿåº¦å¾ˆæ…¢æˆ–è¶…æ—¶

**åŸå› :** ç½‘ç»œé—®é¢˜

**è§£å†³:**
1. æ£€æŸ¥ç½‘ç»œè¿æ¥
2. ä½¿ç”¨å›½å†…ç½‘ç»œä¼šæ›´å¿«
3. å¦‚æœæ˜¯æµ·å¤–ç½‘ç»œ,å¯èƒ½éœ€è¦ä»£ç†
4. æˆ–è€…åœ¨è…¾è®¯äº‘æœåŠ¡å™¨ä¸Šæ¨é€ä¼šæ›´å¿«

---

### âŒ é—®é¢˜4: "Error response from daemon: Get https://...: net/http: TLS handshake timeout"

**åŸå› :** Dockeré…ç½®æˆ–ç½‘ç»œé—®é¢˜

**è§£å†³:**
```bash
# 1. é‡å¯Docker
# Windows: å³é”®Dockerå›¾æ ‡ - Restart

# 2. æ¸…ç†Dockerç¼“å­˜
docker system prune

# 3. é‡è¯•æ¨é€
```

---

## ğŸ“ åœ¨æœåŠ¡å™¨ä¸Šä½¿ç”¨é•œåƒ

### 1ï¸âƒ£ æœåŠ¡å™¨ä¸Šç™»å½•

```bash
docker login ccr.ccs.tencentyun.com
```

### 2ï¸âƒ£ æ‹‰å–é•œåƒ

```bash
docker pull ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest
docker pull ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest
```

### 3ï¸âƒ£ åˆ›å»º docker-compose é…ç½®

åˆ›å»º `docker-compose.prod.yml`:

```yaml
version: '3.8'

services:
  # PostgreSQL æ•°æ®åº“
  postgres:
    image: postgres:15-alpine
    container_name: qmzg-postgres
    environment:
      POSTGRES_DB: qmzg_prod
      POSTGRES_USER: qmzg_admin
      POSTGRES_PASSWORD: ${DB_PASSWORD}
    volumes:
      - postgres_data:/var/lib/postgresql/data
    networks:
      - qmzg-network
    restart: unless-stopped

  # åç«¯æœåŠ¡
  server:
    image: ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest
    container_name: qmzg-server
    environment:
      NODE_ENV: production
      DB_HOST: postgres
      DB_PORT: 5432
      DB_NAME: qmzg_prod
      DB_USER: qmzg_admin
      DB_PASSWORD: ${DB_PASSWORD}
      JWT_SECRET: ${JWT_SECRET}
      JWT_REFRESH_SECRET: ${JWT_REFRESH_SECRET}
      PORT: 3000
    depends_on:
      - postgres
    networks:
      - qmzg-network
    restart: unless-stopped

  # å‰ç«¯åº”ç”¨
  app:
    image: ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest
    container_name: qmzg-app
    networks:
      - qmzg-network
    restart: unless-stopped

  # Nginx åå‘ä»£ç†
  nginx:
    image: nginx:alpine
    container_name: qmzg-nginx
    ports:
      - "80:80"
      - "443:443"
    volumes:
      - ./nginx/qmzgai.conf:/etc/nginx/conf.d/default.conf
      - ./ssl:/etc/nginx/ssl
    depends_on:
      - server
      - app
    networks:
      - qmzg-network
    restart: unless-stopped

volumes:
  postgres_data:

networks:
  qmzg-network:
    driver: bridge
```

### 4ï¸âƒ£ å¯åŠ¨æœåŠ¡

```bash
docker-compose -f docker-compose.prod.yml up -d
```

### 5ï¸âƒ£ æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

```bash
docker-compose -f docker-compose.prod.yml ps
docker-compose -f docker-compose.prod.yml logs -f
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥æ“ä½œ

æ¨é€æˆåŠŸå,ä½ å¯ä»¥:

### âœ… å·²å®Œæˆ
- [x] æœ¬åœ°é•œåƒæ„å»º
- [x] é•œåƒæ ‡ç­¾è®¾ç½®
- [x] å‡†å¤‡å¥½æ¨é€è„šæœ¬

### ğŸ“‹ å¾…å®Œæˆ
- [ ] ç™»å½•è…¾è®¯äº‘é•œåƒä»“åº“
- [ ] æ¨é€åç«¯é•œåƒ (196MB)
- [ ] æ¨é€å‰ç«¯é•œåƒ (82MB)
- [ ] éªŒè¯æ¨é€æˆåŠŸ
- [ ] åœ¨æœåŠ¡å™¨ä¸Šéƒ¨ç½²

---

## ğŸ“ éœ€è¦å¸®åŠ©?

- è…¾è®¯äº‘å®¹å™¨é•œåƒæ–‡æ¡£: https://cloud.tencent.com/document/product/1141
- é¡¹ç›®GitHub: https://github.com/wsaxqd/home-work2

---

## ğŸ’¡ æ¨é€å‘½ä»¤é€ŸæŸ¥

```bash
# ç™»å½•
docker login ccr.ccs.tencentyun.com

# æ¨é€åç«¯
docker push ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest

# æ¨é€å‰ç«¯
docker push ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest

# æ‹‰å–åç«¯
docker pull ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:server-latest

# æ‹‰å–å‰ç«¯
docker pull ccr.ccs.tencentyun.com/qmzg-ai-edu/qmzg-edu:app-latest
```

---

**å‡†å¤‡å¥½äº†å—?**

ç°åœ¨ä½ å¯ä»¥:
1. è¿è¡Œ `push-to-ccr.bat` å¼€å§‹æ¨é€
2. æˆ–è€…æŒ‰ç…§ä¸Šé¢çš„æ‰‹åŠ¨æ­¥éª¤æ‰§è¡Œ

ç¥æ¨é€é¡ºåˆ©! ğŸš€
