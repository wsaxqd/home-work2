# API 1.4 - 刷新令牌

## 接口信息

- **接口名称**: 刷新令牌
- **请求方法**: POST
- **请求路径**: `/api/auth/refresh-token`
- **需要认证**: 否

---

## 接口描述

当accessToken过期时，使用refreshToken获取新的Token对，避免用户重新登录。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| refreshToken | String | 是 | 刷新令牌 | "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..." |

### 请求示例

```json
{
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "令牌刷新成功",
  "data": {
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### 错误响应

#### 400 Bad Request - 参数缺失
```json
{
  "success": false,
  "message": "请提供刷新令牌"
}
```

#### 401 Unauthorized - Token无效
```json
{
  "success": false,
  "message": "刷新令牌无效或已过期"
}
```

#### 500 Internal Server Error
```json
{
  "success": false,
  "message": "令牌刷新失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| accessToken | String | 新的访问令牌（有效期2小时） |
| refreshToken | String | 新的刷新令牌（有效期7天） |

---

## 业务规则

1. refreshToken有效期为7天
2. accessToken有效期为2小时
3. 刷新成功后返回全新的Token对
4. 旧的Token对自动失效
5. 如果refreshToken也过期，需要重新登录
6. 建议在accessToken即将过期前主动刷新

---

## 使用场景

- accessToken已过期，需要获取新Token
- 移动应用后台保活，定期刷新Token
- 单点登录场景下的Token同步

---

## 刷新策略建议

### 客户端实现
1. 监听401错误响应
2. 检查是否为Token过期
3. 使用refreshToken调用此接口
4. 更新本地存储的Token
5. 重试原请求

### 主动刷新
建议在accessToken剩余有效期不足10分钟时主动刷新

---

## Postman测试

### 配置步骤
1. 方法：`POST`
2. URL：`http://localhost:3000/api/auth/refresh-token`
3. Body → raw → JSON
4. 输入请求体（包含refreshToken）
5. 发送请求
6. 保存返回的新Token

### 测试流程
1. 先调用登录接口获取Token对
2. 复制refreshToken
3. 调用此接口刷新Token
4. 验证返回的新Token可正常使用

### 环境变量设置
```javascript
// Tests标签中添加
pm.environment.set("accessToken", pm.response.json().data.accessToken);
pm.environment.set("refreshToken", pm.response.json().data.refreshToken);
```

---

## 相关接口

- [1.2 用户登录](./1.2-login.md)
- [1.3 退出登录](./1.3-logout.md)
- [1.1 用户注册](./1.1-register.md)

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
