# API 3.6 - 更新作品

## 接口信息

- **接口名称**: 更新作品
- **请求方法**: PUT
- **请求路径**: `/api/works/:id`
- **需要认证**: 是

---

## 接口描述

更新指定作品的信息，仅作者本人可以更新。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Path参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | UUID | 是 | 作品ID |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| title | String | 否 | 作品标题 | "我的故事" |
| description | String | 否 | 作品描述 | "一个有趣的故事" |
| content | String | 否 | 作品内容 | "很久很久以前..." |
| cover_image | String | 否 | 封面图片URL | "https://example.com/cover.jpg" |
| tags | Array | 否 | 作品标签 | ["冒险", "友情"] |
| type | String | 否 | 作品类型 | "story" |

### 请求示例

```json
{
  "title": "我的第一个故事（修改版）",
  "description": "这是一个更有趣的故事",
  "content": "很久很久以前，在一个神秘的地方...",
  "tags": ["冒险", "友情", "魔法"]
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "更新成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440100",
    "title": "我的第一个故事（修改版）",
    "type": "story",
    "status": "draft",
    "cover_image": "https://example.com/cover1.jpg",
    "description": "这是一个更有趣的故事",
    "content": "很久很久以前，在一个神秘的地方...",
    "tags": ["冒险", "友情", "魔法"],
    "likes_count": 120,
    "comments_count": 35,
    "views_count": 581,
    "created_at": "2024-12-20T10:00:00.000Z",
    "updated_at": "2024-12-21T14:30:00.000Z",
    "published_at": null
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "标题不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 403 Forbidden - 无权操作
```json
{
  "success": false,
  "message": "无权修改该作品"
}
```

#### 404 Not Found - 作品不存在
```json
{
  "success": false,
  "message": "作品不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "更新作品失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 作品ID |
| title | String | 作品标题 |
| type | String | 作品类型 |
| status | String | 作品状态 |
| cover_image | String | 封面图片URL |
| description | String | 作品描述 |
| content | String | 作品内容 |
| tags | Array | 作品标签 |
| updated_at | DateTime | 更新时间（已更新） |

---

## 业务规则

1. 仅作者本人可以更新作品
2. 所有字段都是可选的，只更新传入的字段
3. 更新后作品状态自动变为draft（草稿）
4. 如果作品已发布，更新后需要重新发布
5. 标题长度限制：1-100字符
6. 描述长度限制：0-500字符
7. 标签数量限制：0-10个

---

## 使用场景

- 编辑作品内容
- 修改作品标题和描述
- 更换作品封面
- 添加或修改作品标签

---

## 注意事项

1. 更新已发布的作品会使其变为草稿状态
2. 建议在更新前提醒用户保存
3. 大量内容更新建议使用防抖
4. 封面图片需要先上传再更新URL

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`PUT`
3. 输入URL：`http://localhost:3000/api/works/{workId}`
4. 在Headers中添加：`Authorization: Bearer {accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回更新后的作品信息
- updated_at字段已更新

---

## 相关接口

- [3.5 获取作品详情](./3.5-work-detail.md)
- [3.8 发布作品](./3.8-publish-work.md)
- [10.1 上传图片](./10.1-upload-image.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-21 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
