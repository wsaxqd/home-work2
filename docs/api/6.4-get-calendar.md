# API 6.4 - 获取日历数据

## 接口信息

- **接口名称**: 获取日历数据
- **请求方法**: GET
- **请求路径**: `/api/diary/calendar`
- **需要认证**: 是

---

## 接口描述

获取指定月份的日记日历数据，用于日历视图展示，显示每天是否有日记以及对应的心情。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| year | Integer | 否 | 年份(默认当前年) | 2024 |
| month | Integer | 否 | 月份(1-12，默认当前月) | 12 |

### 请求示例

```
GET /api/diary/calendar?year=2024&month=12
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "year": 2024,
    "month": 12,
    "total_days": 31,
    "diary_count": 21,
    "calendar": [
      {
        "date": "2024-12-01",
        "has_diary": true,
        "mood": "happy",
        "title": "开心的一天",
        "has_images": true,
        "is_public": false
      },
      {
        "date": "2024-12-02",
        "has_diary": false,
        "mood": null,
        "title": null,
        "has_images": false,
        "is_public": false
      },
      {
        "date": "2024-12-03",
        "has_diary": true,
        "mood": "excited",
        "title": "学到新知识",
        "has_images": false,
        "is_public": true
      },
      {
        "date": "2024-12-04",
        "has_diary": true,
        "mood": "neutral",
        "title": null,
        "has_images": true,
        "is_public": false
      }
    ],
    "mood_summary": {
      "happy": 8,
      "excited": 6,
      "neutral": 5,
      "sad": 1,
      "angry": 1
    },
    "streak": {
      "current_streak": 7,
      "longest_streak": 15,
      "last_diary_date": "2024-12-21"
    }
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "月份参数不正确，应为1-12之间的整数"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取日历数据失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| year | Integer | 年份 |
| month | Integer | 月份 |
| total_days | Integer | 该月总天数 |
| diary_count | Integer | 该月日记数量 |
| calendar | Array | 日历数组(包含该月所有日期) |
| date | String | 日期(YYYY-MM-DD) |
| has_diary | Boolean | 是否有日记 |
| mood | String | 心情(无日记则为null) |
| title | String | 日记标题(无标题则为null) |
| has_images | Boolean | 是否有图片 |
| is_public | Boolean | 是否公开 |
| mood_summary | Object | 该月心情统计 |
| streak | Object | 连续记录统计 |
| current_streak | Integer | 当前连续天数 |
| longest_streak | Integer | 历史最长连续天数 |
| last_diary_date | String | 最后一篇日记日期 |

---

## 业务规则

1. calendar数组包含该月所有日期，从1号到月底
2. 未来日期的has_diary为false
3. diary_count只统计该月实际有日记的天数
4. mood_summary统计该月各心情的数量
5. current_streak为截止到今天的连续记录天数
6. longest_streak为该用户历史最长连续记录天数

---

## 使用场景

- 日记日历视图展示
- 查看某月记录情况
- 连续打卡统计
- 心情可视化日历
- 激励用户坚持写日记

---

## 注意事项

1. calendar数组固定返回该月所有日期
2. 前端需根据has_diary字段判断是否展示日记标记
3. mood可用于设置日期单元格的颜色
4. 建议实现日期点击跳转到日记详情
5. 连续天数计算不包括未来日期

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/diary/calendar`
4. 在Headers中添加：
   - `Authorization`: `Bearer {你的accessToken}`
5. 在Params中添加（可选）：
   - Key: `year`, Value: `2024`
   - Key: `month`, Value: `12`
6. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回该月所有日期的日历数据
- diary_count显示该月日记数量
- streak显示连续记录统计

---

## 相关接口

- [6.1 创建日记](./6.1-create-diary.md)
- [6.2 获取日记列表](./6.2-get-diary-list.md)
- [6.3 获取心情统计](./6.3-get-mood-stats.md)
- [6.5 获取日记详情](./6.5-get-diary-detail.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
