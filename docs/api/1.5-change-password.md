# API 1.5 - 修改密码

## 接口信息

- **接口名称**: 修改密码
- **请求方法**: POST
- **请求路径**: `/api/auth/change-password`
- **需要认证**: 是

---

## 接口描述

已登录用户修改自己的登录密码，需要验证旧密码。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |
| Content-Type | String | 是 | application/json |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| oldPassword | String | 是 | 当前密码 | "123456" |
| newPassword | String | 是 | 新密码(6-20位) | "abc123" |

### 请求示例

```json
{
  "oldPassword": "123456",
  "newPassword": "abc123"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "密码修改成功",
  "data": null
}
```

### 错误响应

#### 400 Bad Request - 参数缺失
```json
{
  "success": false,
  "message": "请提供旧密码和新密码"
}
```

#### 400 Bad Request - 密码格式错误
```json
{
  "success": false,
  "message": "新密码长度必须在6-20位之间"
}
```

#### 401 Unauthorized - 旧密码错误
```json
{
  "success": false,
  "message": "旧密码不正确"
}
```

#### 401 Unauthorized - 未登录
```json
{
  "success": false,
  "message": "请先登录"
}
```

#### 500 Internal Server Error
```json
{
  "success": false,
  "message": "密码修改失败，请稍后重试"
}
```

---

## 业务规则

1. 必须验证旧密码正确性
2. 新密码长度必须为6-20位
3. 新密码不能与旧密码相同
4. 密码使用bcrypt加密存储（salt rounds: 10）
5. 修改成功后，建议用户重新登录
6. 修改成功后，旧的Token仍然有效（可选择实现Token失效机制）

---

## 安全建议

### 客户端
1. 前端进行密码强度校验
2. 建议密码包含字母、数字、特殊字符
3. 修改成功后清除本地Token，引导重新登录

### 服务端
1. 使用bcrypt等安全哈希算法
2. 记录密码修改日志
3. 可选：发送修改通知到绑定手机
4. 可选：限制修改频率（如每天最多3次）

---

## 使用场景

- 用户主动修改密码
- 定期更换密码提升安全性
- 怀疑账号泄露时修改密码

---

## Postman测试

### 配置步骤
1. 方法：`POST`
2. URL：`http://localhost:3000/api/auth/change-password`
3. Headers：`Authorization: Bearer {{accessToken}}`
4. Body → raw → JSON
5. 输入请求体
6. 发送请求

### 测试用例

#### 用例1：正常修改
```json
{
  "oldPassword": "123456",
  "newPassword": "newpass123"
}
```

#### 用例2：旧密码错误
```json
{
  "oldPassword": "wrongpass",
  "newPassword": "newpass123"
}
```

#### 用例3：新密码太短
```json
{
  "oldPassword": "123456",
  "newPassword": "123"
}
```

### 前置条件
需要先调用登录接口获取accessToken

---

## 注意事项

1. 修改成功后建议重新登录
2. 如果忘记旧密码，应使用"忘记密码"功能（需通过手机验证）
3. 定期修改密码有助于提升账号安全性
4. 不要使用过于简单的密码

---

## 相关接口

- [1.2 用户登录](./1.2-login.md)
- [1.3 退出登录](./1.3-logout.md)
- [2.1 获取用户信息](./2.1-get-profile.md)

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
