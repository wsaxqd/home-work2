# API 7.2 - AI生成故事

## 接口信息

- **接口名称**: AI生成故事
- **请求方法**: POST
- **请求路径**: `/api/ai/story`
- **需要认证**: 是

---

## 接口描述

根据用户提供的主题、角色、场景等要素，由AI创作一个完整的故事，支持多种风格和长度。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| theme | String | 是 | 故事主题 | "勇敢探险" |
| characters | Array | 否 | 主要角色 | ["小明", "机器人"] |
| setting | String | 否 | 场景设定 | "未来城市" |
| style | String | 否 | 故事风格(adventure/fantasy/science/daily，默认adventure) | "adventure" |
| length | String | 否 | 故事长度(short/medium/long，默认medium) | "medium" |
| age_group | String | 否 | 适合年龄(3-6/7-9/10-12，默认7-9) | "7-9" |

### 请求示例

```json
{
  "theme": "勇敢探险",
  "characters": ["小明", "机器人小智"],
  "setting": "神秘的森林",
  "style": "adventure",
  "length": "medium",
  "age_group": "7-9"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "故事生成成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "title": "勇闯神秘森林",
    "content": "在一个阳光明媚的早晨，小明和他的机器人朋友小智来到了一片神秘的森林...\n\n第一章：进入森林\n小明背着背包，小智紧跟在后面。森林里树木茂密，阳光透过树叶洒下斑驳的光影...\n\n第二章：遇到困难\n突然，前方出现了一条湍急的河流...\n\n第三章：智慧解决\n小智想到了一个好办法...\n\n尾声：收获与成长\n经过这次冒险，小明学会了...",
    "theme": "勇敢探险",
    "characters": ["小明", "机器人小智"],
    "setting": "神秘的森林",
    "style": "adventure",
    "length": "medium",
    "age_group": "7-9",
    "word_count": 850,
    "reading_time": 5,
    "created_at": "2024-12-21T14:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "故事主题不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 429 Too Many Requests - 超出限额
```json
{
  "success": false,
  "message": "今日故事生成次数已用完，请明天再试"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "故事生成失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 故事ID |
| title | String | 故事标题(AI自动生成) |
| content | String | 故事完整内容 |
| theme | String | 故事主题 |
| characters | Array | 角色列表 |
| setting | String | 场景设定 |
| style | String | 故事风格 |
| length | String | 故事长度 |
| age_group | String | 适合年龄 |
| word_count | Integer | 字数统计 |
| reading_time | Integer | 预计阅读时间(分钟) |
| created_at | DateTime | 创建时间 |

---

## 业务规则

1. 每个用户每天限定生成次数（如10次）
2. length=short: 约300-500字，medium: 约600-1000字，long: 约1200-2000字
3. 故事内容符合对应年龄段的认知水平
4. AI会自动生成合适的故事标题
5. reading_time = word_count / 150（平均阅读速度）
6. 生成的故事会保存到用户的故事库

---

## 使用场景

- 睡前故事生成
- 创意写作辅助
- 阅读兴趣培养
- 教育场景模拟
- 亲子互动

---

## 注意事项

1. 生成时间可能较长（5-15秒），建议显示加载动画
2. 内容需符合儿童内容安全标准
3. 建议支持故事收藏功能
4. 可实现续写功能
5. 注意控制生成频率

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/ai/story`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回完整的故事内容
- title为AI自动生成的标题
- word_count显示字数统计

---

## 相关接口

- [7.1 AI对话](./7.1-chat.md)
- [7.7 获取AI使用历史](./7.7-get-history.md)
- [7.8 获取AI使用统计](./7.8-get-stats.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
