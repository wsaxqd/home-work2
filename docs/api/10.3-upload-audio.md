# API 10.3 - 上传音频

## 接口信息

- **接口名称**: 上传音频
- **请求方法**: POST
- **请求路径**: `/api/upload/audio`
- **需要认证**: 是

---

## 接口描述

上传音频文件，支持常见音频格式，适用于音乐作品、语音日记、录音等场景。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |
| Content-Type | String | 是 | multipart/form-data |

### FormData参数
| 参数名 | 类型 | 必填 | 说明 | 限制 |
|--------|------|------|------|------|
| audio | File | 是 | 音频文件 | mp3/wav/ogg/m4a, 最大20MB |
| category | String | 否 | 音频分类 | "music", "voice", "other" (默认other) |
| title | String | 否 | 音频标题 | 最多50字符 |

### 请求示例

```javascript
// JavaScript FormData示例
const formData = new FormData();
formData.append('audio', audioFileInput.files[0]);
formData.append('category', 'music');
formData.append('title', '我的第一首歌');

fetch('http://localhost:3000/api/upload/audio', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + accessToken
  },
  body: formData
});
```

---

## 响应结果

### 成功响应 (201 Created)

```json
{
  "success": true,
  "message": "音频上传成功",
  "data": {
    "url": "https://example.com/uploads/audio/2024/12/550e8400-e29b-41d4-a716-446655440000.mp3",
    "filename": "550e8400-e29b-41d4-a716-446655440000.mp3",
    "originalName": "my-first-song.mp3",
    "title": "我的第一首歌",
    "size": 5242880,
    "mimeType": "audio/mpeg",
    "duration": 180,
    "bitrate": 192,
    "sampleRate": 44100,
    "category": "music",
    "uploadedAt": "2024-12-22T10:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "未选择文件"
}
```

#### 400 Bad Request - 文件格式错误
```json
{
  "success": false,
  "message": "不支持的音频格式，请上传mp3/wav/ogg/m4a格式"
}
```

#### 400 Bad Request - 文件过大
```json
{
  "success": false,
  "message": "音频大小超出限制，最大20MB"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "上传失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| url | String | 音频访问URL |
| filename | String | 服务器存储文件名 |
| originalName | String | 原始文件名 |
| title | String | 音频标题 |
| size | Number | 文件大小(字节) |
| mimeType | String | MIME类型 |
| duration | Number | 时长(秒) |
| bitrate | Number | 比特率(kbps) |
| sampleRate | Number | 采样率(Hz) |
| category | String | 音频分类 |
| uploadedAt | DateTime | 上传时间 |

---

## 业务规则

1. 支持的音频格式：mp3, wav, ogg, m4a
2. 单个音频最大20MB
3. 自动提取音频元信息(时长、比特率等)
4. 生成唯一文件名避免冲突
5. 支持分类管理
6. 音频按日期目录存储
7. 返回CDN加速URL

---

## 使用场景

- 上传音乐作品
- 上传语音日记
- 上传录音文件
- 上传播客内容

---

## 注意事项

1. 大文件上传建议显示进度条
2. 文件名会被重命名为UUID
3. 上传前可在前端验证文件格式
4. 音频时长会自动计算
5. 返回的URL可直接用于播放

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/upload/audio`
4. 在Headers中添加：
   - Key: `Authorization`
   - Value: `Bearer {你的accessToken}`
5. 在Body中选择`form-data`
6. 添加字段：
   - Key: `audio`, Type: `File`, Value: 选择音频文件
   - Key: `category`, Type: `Text`, Value: `music`
   - Key: `title`, Type: `Text`, Value: `测试音乐`
7. 点击`Send`发送请求

### 预期结果
- 状态码：201
- 返回音频URL和详细信息
- 可以通过URL播放音频

---

## 相关接口

- [10.1 上传单个图片](./10.1-upload-image.md)
- [10.5 删除文件](./10.5-delete-file.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
