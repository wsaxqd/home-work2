# API 5.2 - 获取游戏进度

## 接口信息

- **接口名称**: 获取游戏进度
- **请求方法**: GET
- **请求路径**: `/api/games/progress`
- **需要认证**: 是

---

## 接口描述

获取当前用户在各个游戏类型中的进度信息，包括已完成关卡、最佳成绩、总游戏时长等统计数据。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| game_type | String | 否 | 游戏类型(不传则返回全部) | "puzzle" |

### 请求示例

```
GET /api/games/progress?game_type=puzzle
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "puzzle": {
      "game_type": "puzzle",
      "total_games": 45,
      "current_level": 12,
      "max_level": 50,
      "best_score": 98,
      "total_stars": 130,
      "total_time": 5400,
      "completion_rate": "24%",
      "last_played": "2024-12-21T14:30:00.000Z"
    },
    "memory": {
      "game_type": "memory",
      "total_games": 30,
      "current_level": 8,
      "max_level": 30,
      "best_score": 95,
      "total_stars": 85,
      "total_time": 3600,
      "completion_rate": "26.67%",
      "last_played": "2024-12-20T10:20:00.000Z"
    },
    "quiz": {
      "game_type": "quiz",
      "total_games": 20,
      "current_level": 5,
      "max_level": 20,
      "best_score": 92,
      "total_stars": 55,
      "total_time": 2400,
      "completion_rate": "25%",
      "last_played": "2024-12-19T16:45:00.000Z"
    },
    "overall": {
      "total_games": 95,
      "total_stars": 270,
      "total_time": 11400,
      "average_score": 95
    }
  }
}
```

### 错误响应

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取进度失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| game_type | String | 游戏类型 |
| total_games | Integer | 总游戏次数 |
| current_level | Integer | 当前关卡 |
| max_level | Integer | 最大关卡数 |
| best_score | Integer | 最佳成绩 |
| total_stars | Integer | 累计获得星星数 |
| total_time | Integer | 总游戏时长(秒) |
| completion_rate | String | 完成率 |
| last_played | DateTime | 最后游戏时间 |
| overall | Object | 总体统计数据 |

---

## 业务规则

1. 不传game_type参数时返回所有游戏类型的进度
2. current_level表示用户已解锁的最高关卡
3. completion_rate = (current_level / max_level) × 100%
4. total_time累计所有游戏记录的用时
5. overall.average_score为所有游戏的平均分

---

## 使用场景

- 游戏主界面展示用户进度
- 生成学习进度报告
- 游戏成就系统的数据来源
- 个人中心展示游戏统计

---

## 注意事项

1. 数据会实时更新，建议合理控制请求频率
2. total_time以秒为单位，前端需转换为可读格式
3. 如果用户从未玩过某个游戏类型，该类型数据为null
4. completion_rate为百分比字符串，包含%符号

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/games/progress`
4. 在Headers中添加：
   - `Authorization`: `Bearer {你的accessToken}`
5. (可选)在Params中添加：
   - Key: `game_type`, Value: `puzzle`
6. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回用户的游戏进度统计数据
- 如果指定game_type，只返回该类型的进度

---

## 相关接口

- [5.1 保存游戏成绩](./5.1-save-score.md)
- [5.3 获取排行榜](./5.3-get-leaderboard.md)
- [5.5 获取游戏历史记录](./5.5-get-history.md)
- [8.4 获取学习进度报告](./8.4-get-report.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
