# API 7.3 - 图像识别

## 接口信息

- **接口名称**: 图像识别
- **请求方法**: POST
- **请求路径**: `/api/ai/image/recognize`
- **需要认证**: 是

---

## 接口描述

识别上传图片中的内容，包括物体识别、场景识别、文字识别等，并返回识别结果和详细描述。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| image_url | String | 是 | 图片URL | "https://example.com/image.jpg" |
| type | String | 否 | 识别类型(general/text/plant/animal，默认general) | "general" |
| detail | Boolean | 否 | 是否返回详细描述(默认true) | true |
| language | String | 否 | 返回语言(zh/en，默认zh) | "zh" |

### 请求示例

```json
{
  "image_url": "https://example.com/image.jpg",
  "type": "general",
  "detail": true,
  "language": "zh"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "识别成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "image_url": "https://example.com/image.jpg",
    "type": "general",
    "results": [
      {
        "label": "猫",
        "confidence": 0.98,
        "category": "动物"
      },
      {
        "label": "毛绒玩具",
        "confidence": 0.85,
        "category": "物品"
      }
    ],
    "description": "这是一张可爱的小猫图片。小猫有着柔软的毛发，正在玩耍一个毛绒玩具。图片背景是室内环境，光线柔和。",
    "tags": ["猫", "宠物", "可爱", "室内", "玩具"],
    "scene": "室内",
    "color_scheme": {
      "dominant_colors": ["#F5E6D3", "#8B6F47", "#FFFFFF"],
      "color_description": "以暖色调为主"
    },
    "created_at": "2024-12-21T14:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "图片URL不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 422 Unprocessable Entity - 无法处理
```json
{
  "success": false,
  "message": "图片格式不支持或无法识别"
}
```

#### 429 Too Many Requests - 超出限额
```json
{
  "success": false,
  "message": "今日图像识别次数已用完，请明天再试"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "图像识别失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 识别记录ID |
| image_url | String | 图片URL |
| type | String | 识别类型 |
| results | Array | 识别结果列表 |
| label | String | 识别标签 |
| confidence | Float | 置信度(0-1) |
| category | String | 类别 |
| description | String | 详细描述 |
| tags | Array | 相关标签 |
| scene | String | 场景 |
| color_scheme | Object | 色彩方案 |
| dominant_colors | Array | 主色调(Hex颜色值) |
| color_description | String | 色彩描述 |
| created_at | DateTime | 创建时间 |

---

## 业务规则

1. 图片URL需通过上传接口获取
2. 支持的图片格式：jpg、png、webp
3. 图片大小限制：最大5MB
4. results按confidence降序排列
5. type=text时专注于文字识别
6. type=plant时专注于植物识别
7. type=animal时专注于动物识别
8. detail=false时不返回description和color_scheme

---

## 使用场景

- 拍照识物学习
- 植物识别
- 动物识别
- 作业图片识别
- 场景理解辅助

---

## 注意事项

1. 图片需先通过上传接口上传
2. 识别时间约3-8秒，需显示加载状态
3. confidence低于0.6的结果可能不准确
4. 建议对识别结果进行展示优化
5. 注意控制识别频率

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/ai/image/recognize`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回识别结果列表
- description包含详细描述
- tags包含相关标签

---

## 相关接口

- [7.1 AI对话](./7.1-chat.md)
- [7.7 获取AI使用历史](./7.7-get-history.md)
- [10.1 上传单个图片](./10.1-upload-image.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
