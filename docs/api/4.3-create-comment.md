# API 4.3 - 发表评论

## 接口信息

- **接口名称**: 发表评论
- **请求方法**: POST
- **请求路径**: `/api/community/works/:id/comments`
- **需要认证**: 是

---

## 接口描述

对指定作品发表评论，支持普通评论和回复评论。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Path参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | UUID | 是 | 作品ID |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| content | String | 是 | 评论内容(1-500字符) | "非常棒的作品！" |
| parent_id | UUID | 否 | 父评论ID（回复评论时使用） | "550e..." |

### 请求示例

#### 普通评论
```json
{
  "content": "非常棒的作品！继续加油！"
}
```

#### 回复评论
```json
{
  "content": "我也这么觉得！",
  "parent_id": "550e8400-e29b-41d4-a716-446655440200"
}
```

---

## 响应结果

### 成功响应 (201 Created)

```json
{
  "success": true,
  "message": "评论成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440201",
    "work_id": "550e8400-e29b-41d4-a716-446655440100",
    "user_id": "550e8400-e29b-41d4-a716-446655440001",
    "content": "非常棒的作品！继续加油！",
    "parent_id": null,
    "created_at": "2024-12-21T15:30:00.000Z",
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440001",
      "nickname": "小明",
      "avatar": "https://example.com/avatar1.jpg"
    }
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "评论内容不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 404 Not Found - 作品不存在
```json
{
  "success": false,
  "message": "作品不存在"
}
```

#### 404 Not Found - 父评论不存在
```json
{
  "success": false,
  "message": "父评论不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "发表评论失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 评论ID |
| work_id | UUID | 作品ID |
| user_id | UUID | 评论者ID |
| content | String | 评论内容 |
| parent_id | UUID | 父评论ID（顶级评论为null） |
| created_at | DateTime | 评论时间 |
| user | Object | 评论者信息 |

---

## 业务规则

1. 评论内容长度：1-500字符
2. 支持多级评论回复
3. 评论成功后作品评论数+1
4. 作品作者和被回复者会收到通知
5. 评论内容需要进行敏感词过滤

---

## 使用场景

- 对作品发表看法
- 与作者互动交流
- 回复其他用户的评论
- 提供建议和反馈

---

## 注意事项

1. 建议前端进行内容长度校验
2. 需要过滤敏感词和违规内容
3. 建议限制评论频率，防止刷屏
4. 评论应支持换行显示

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/community/works/{workId}/comments`
4. 在Headers中添加：`Authorization: Bearer {accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：201
- 返回评论信息
- 作品评论数+1
- 相关用户收到通知

---

## 相关接口

- [4.4 获取评论列表](./4.4-get-comments.md)
- [4.5 获取评论回复](./4.5-get-replies.md)
- [4.6 删除评论](./4.6-delete-comment.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-21 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
