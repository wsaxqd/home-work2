# API 10.2 - 批量上传图片

## 接口信息

- **接口名称**: 批量上传图片
- **请求方法**: POST
- **请求路径**: `/api/upload/images`
- **需要认证**: 是

---

## 接口描述

一次性上传多个图片文件，适用于需要多图上传的场景，如作品集、相册等。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |
| Content-Type | String | 是 | multipart/form-data |

### FormData参数
| 参数名 | 类型 | 必填 | 说明 | 限制 |
|--------|------|------|------|------|
| images | File[] | 是 | 图片文件数组 | jpg/jpeg/png/gif, 每个最大5MB, 最多9张 |
| category | String | 否 | 图片分类 | "work", "diary", "other" (默认other) |

### 请求示例

```javascript
// JavaScript FormData示例
const formData = new FormData();
for (let i = 0; i < fileInput.files.length; i++) {
  formData.append('images', fileInput.files[i]);
}
formData.append('category', 'work');

fetch('http://localhost:3000/api/upload/images', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + accessToken
  },
  body: formData
});
```

---

## 响应结果

### 成功响应 (201 Created)

```json
{
  "success": true,
  "message": "上传成功，共3张图片",
  "data": {
    "totalCount": 3,
    "successCount": 3,
    "failedCount": 0,
    "images": [
      {
        "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440001.jpg",
        "filename": "550e8400-e29b-41d4-a716-446655440001.jpg",
        "originalName": "image1.jpg",
        "size": 1024567,
        "mimeType": "image/jpeg",
        "width": 1920,
        "height": 1080,
        "category": "work",
        "status": "success"
      },
      {
        "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440002.jpg",
        "filename": "550e8400-e29b-41d4-a716-446655440002.jpg",
        "originalName": "image2.jpg",
        "size": 856789,
        "mimeType": "image/jpeg",
        "width": 1280,
        "height": 720,
        "category": "work",
        "status": "success"
      },
      {
        "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440003.png",
        "filename": "550e8400-e29b-41d4-a716-446655440003.png",
        "originalName": "image3.png",
        "size": 2345678,
        "mimeType": "image/png",
        "width": 2560,
        "height": 1440,
        "category": "work",
        "status": "success"
      }
    ],
    "uploadedAt": "2024-12-22T10:30:00.000Z"
  }
}
```

### 部分成功响应 (207 Multi-Status)

```json
{
  "success": true,
  "message": "部分上传成功，成功2张，失败1张",
  "data": {
    "totalCount": 3,
    "successCount": 2,
    "failedCount": 1,
    "images": [
      {
        "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440001.jpg",
        "originalName": "image1.jpg",
        "status": "success"
      },
      {
        "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440002.jpg",
        "originalName": "image2.jpg",
        "status": "success"
      },
      {
        "originalName": "image3.bmp",
        "status": "failed",
        "error": "不支持的图片格式"
      }
    ],
    "uploadedAt": "2024-12-22T10:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "未选择文件"
}
```

#### 400 Bad Request - 数量超限
```json
{
  "success": false,
  "message": "最多只能上传9张图片"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "批量上传失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| totalCount | Number | 总上传数量 |
| successCount | Number | 成功数量 |
| failedCount | Number | 失败数量 |
| images | Array | 上传结果列表 |
| images[].url | String | 图片URL(成功时) |
| images[].originalName | String | 原始文件名 |
| images[].status | String | 上传状态(success/failed) |
| images[].error | String | 错误信息(失败时) |
| uploadedAt | DateTime | 上传时间 |

---

## 业务规则

1. 最多同时上传9张图片
2. 每张图片最大5MB
3. 支持的格式：jpg, jpeg, png, gif
4. 部分失败不影响其他图片
5. 返回所有图片的上传结果
6. 失败的图片会返回错误原因
7. 图片自动压缩优化

---

## 使用场景

- 上传作品集多图
- 上传相册
- 批量上传创作素材
- 多图场景

---

## 注意事项

1. 建议显示整体上传进度
2. 部分失败时允许用户重试失败项
3. 前端应限制选择图片数量
4. 大量图片建议分批上传
5. 注意处理部分成功的情况

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/upload/images`
4. 在Headers中添加：
   - Key: `Authorization`
   - Value: `Bearer {你的accessToken}`
5. 在Body中选择`form-data`
6. 添加多个图片文件：
   - Key: `images`, Type: `File`, Value: 选择图片1
   - Key: `images`, Type: `File`, Value: 选择图片2
   - Key: `images`, Type: `File`, Value: 选择图片3
   - Key: `category`, Type: `Text`, Value: `work`
7. 点击`Send`发送请求

### 预期结果
- 状态码：201或207
- 返回所有图片的上传结果
- 可以通过URL访问成功上传的图片

---

## 相关接口

- [10.1 上传单个图片](./10.1-upload-image.md)
- [10.5 删除文件](./10.5-delete-file.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
