# API 7.5 - 语音转文字

## 接口信息

- **接口名称**: 语音转文字
- **请求方法**: POST
- **请求路径**: `/api/ai/voice/to-text`
- **需要认证**: 是

---

## 接口描述

将音频文件转换为文字，支持多种音频格式，可用于语音日记、语音问答等场景。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| audio_url | String | 是 | 音频文件URL | "https://example.com/audio.mp3" |
| language | String | 否 | 音频语言(zh/en，默认zh) | "zh" |
| format | String | 否 | 音频格式(mp3/wav/m4a，默认mp3) | "mp3" |
| enable_punctuation | Boolean | 否 | 是否添加标点(默认true) | true |

### 请求示例

```json
{
  "audio_url": "https://example.com/audio.mp3",
  "language": "zh",
  "format": "mp3",
  "enable_punctuation": true
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "转换成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "audio_url": "https://example.com/audio.mp3",
    "text": "今天天气真好，我和朋友们一起去公园玩了。我们玩了很多游戏，还吃了好吃的冰淇淋。",
    "duration": 15.5,
    "word_count": 32,
    "language": "zh",
    "confidence": 0.95,
    "segments": [
      {
        "text": "今天天气真好",
        "start_time": 0.0,
        "end_time": 2.1,
        "confidence": 0.96
      },
      {
        "text": "我和朋友们一起去公园玩了",
        "start_time": 2.2,
        "end_time": 5.8,
        "confidence": 0.94
      },
      {
        "text": "我们玩了很多游戏",
        "start_time": 6.0,
        "end_time": 9.2,
        "confidence": 0.97
      },
      {
        "text": "还吃了好吃的冰淇淋",
        "start_time": 9.5,
        "end_time": 15.5,
        "confidence": 0.93
      }
    ],
    "created_at": "2024-12-21T14:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "音频URL不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 422 Unprocessable Entity - 无法处理
```json
{
  "success": false,
  "message": "音频格式不支持或无法识别"
}
```

#### 429 Too Many Requests - 超出限额
```json
{
  "success": false,
  "message": "今日语音转文字次数已用完，请明天再试"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "语音转文字失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 转换记录ID |
| audio_url | String | 音频URL |
| text | String | 转换后的完整文本 |
| duration | Float | 音频时长(秒) |
| word_count | Integer | 字数统计 |
| language | String | 识别语言 |
| confidence | Float | 平均置信度(0-1) |
| segments | Array | 分段识别结果 |
| start_time | Float | 开始时间(秒) |
| end_time | Float | 结束时间(秒) |
| created_at | DateTime | 创建时间 |

---

## 业务规则

1. 音频文件需先通过上传接口上传
2. 支持的音频格式：mp3、wav、m4a
3. 音频大小限制：最大10MB
4. 音频时长限制：最大5分钟
5. confidence为所有segments的平均置信度
6. enable_punctuation=true时自动添加标点符号
7. segments按时间顺序排列

---

## 使用场景

- 语音日记录入
- 语音问答
- 语音笔记
- 语音作业提交
- 口语练习评估

---

## 注意事项

1. 音频需先通过上传接口上传
2. 转换时间约为音频时长的1-2倍
3. 背景噪音会影响识别准确度
4. 建议音频清晰、语速适中
5. 注意控制使用频率

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/ai/voice/to-text`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回转换后的文本
- segments包含分段结果
- confidence显示识别置信度

---

## 相关接口

- [7.6 文字转语音](./7.6-voice-to-speech.md)
- [7.7 获取AI使用历史](./7.7-get-history.md)
- [10.3 上传音频](./10.3-upload-audio.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
