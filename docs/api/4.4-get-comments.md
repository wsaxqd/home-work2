# API 4.4 - 获取评论列表

## 接口信息

- **接口名称**: 获取评论列表
- **请求方法**: GET
- **请求路径**: `/api/community/works/:id/comments`
- **需要认证**: 否

---

## 接口描述

获取指定作品的评论列表，默认只返回顶级评论，支持分页。

---

## 请求参数

### Path参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | UUID | 是 | 作品ID |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 默认值 |
|--------|------|------|------|--------|
| page | Integer | 否 | 页码 | 1 |
| pageSize | Integer | 否 | 每页数量 | 20 |
| sortBy | String | 否 | 排序方式(time/hot) | time |

### 请求示例

```
GET /api/community/works/550e8400-e29b-41d4-a716-446655440100/comments?page=1&pageSize=20&sortBy=time
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "data": [
    {
      "id": "550e8400-e29b-41d4-a716-446655440201",
      "work_id": "550e8400-e29b-41d4-a716-446655440100",
      "content": "非常棒的作品！",
      "parent_id": null,
      "replies_count": 3,
      "created_at": "2024-12-21T15:30:00.000Z",
      "user": {
        "id": "550e8400-e29b-41d4-a716-446655440001",
        "nickname": "小明",
        "avatar": "https://example.com/avatar1.jpg"
      }
    },
    {
      "id": "550e8400-e29b-41d4-a716-446655440202",
      "work_id": "550e8400-e29b-41d4-a716-446655440100",
      "content": "很有创意！",
      "parent_id": null,
      "replies_count": 0,
      "created_at": "2024-12-21T14:20:00.000Z",
      "user": {
        "id": "550e8400-e29b-41d4-a716-446655440002",
        "nickname": "小红",
        "avatar": "https://example.com/avatar2.jpg"
      }
    }
  ],
  "pagination": {
    "page": 1,
    "pageSize": 20,
    "total": 35,
    "totalPages": 2
  }
}
```

### 错误响应

#### 404 Not Found - 作品不存在
```json
{
  "success": false,
  "message": "作品不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取评论列表失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 评论ID |
| work_id | UUID | 作品ID |
| content | String | 评论内容 |
| parent_id | UUID | 父评论ID（顶级评论为null） |
| replies_count | Integer | 回复数量 |
| created_at | DateTime | 评论时间 |
| user | Object | 评论者信息 |

---

## 业务规则

1. 默认只返回顶级评论（parent_id为null）
2. 排序方式：time（时间倒序），hot（热度排序）
3. 热度排序综合考虑回复数和时间
4. 已删除的评论不返回
5. 支持分页查询

---

## 使用场景

- 作品详情页展示评论
- 评论列表浏览
- 评论区加载更多
- 评论数据统计

---

## 注意事项

1. 建议使用分页加载，避免一次加载过多数据
2. 可以缓存热门评论提高性能
3. 评论内容应支持换行显示
4. 长评论建议截断显示

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/community/works/{workId}/comments?page=1&pageSize=20`
4. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回评论列表和分页信息
- 仅包含顶级评论

---

## 相关接口

- [4.3 发表评论](./4.3-create-comment.md)
- [4.5 获取评论回复](./4.5-get-replies.md)
- [4.6 删除评论](./4.6-delete-comment.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-21 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
