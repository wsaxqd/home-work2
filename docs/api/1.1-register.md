# API 1.1 - 用户注册

## 接口信息

- **接口名称**: 用户注册
- **请求方法**: POST
- **请求路径**: `/api/auth/register`
- **需要认证**: 否

---

## 接口描述

用户通过手机号和密码注册新账号，注册成功后自动登录并返回JWT Token。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| phone | String | 是 | 手机号(唯一) | "13800138000" |
| password | String | 是 | 密码(6-20位) | "123456" |
| nickname | String | 否 | 用户昵称 | "小明" |

### 请求示例

```json
{
  "phone": "13800138000",
  "password": "123456",
  "nickname": "小明"
}
```

---

## 响应结果

### 成功响应 (201 Created)

```json
{
  "success": true,
  "message": "注册成功",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "phone": "13800138000",
      "nickname": "小明",
      "avatar": null,
      "bio": null,
      "created_at": "2024-12-21T14:30:00.000Z",
      "updated_at": "2024-12-21T14:30:00.000Z"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "手机号格式不正确"
}
```

#### 409 Conflict - 手机号已存在
```json
{
  "success": false,
  "message": "该手机号已被注册"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "注册失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| user.id | UUID | 用户唯一标识 |
| user.phone | String | 手机号 |
| user.nickname | String | 用户昵称 |
| user.avatar | String | 头像URL（可为null） |
| user.bio | String | 个人简介（可为null） |
| user.created_at | DateTime | 注册时间 |
| user.updated_at | DateTime | 更新时间 |
| accessToken | String | 访问令牌（有效期2小时） |
| refreshToken | String | 刷新令牌（有效期7天） |

---

## 业务规则

1. 手机号必须唯一，不能重复注册
2. 密码长度为6-20位
3. 密码使用bcrypt加密存储（salt rounds: 10）
4. nickname为可选项，不填则为null
5. 注册成功后自动生成JWT Token
6. accessToken有效期为2小时
7. refreshToken有效期为7天

---

## 使用场景

- 新用户首次注册账号
- 移动端、Web端注册流程
- 第三方平台接入时创建新账号

---

## 注意事项

1. 请妥善保管返回的Token
2. 建议在客户端对手机号进行格式验证
3. 建议对密码强度进行前端校验
4. Token应存储在安全位置（如HTTPOnly Cookie或安全存储）

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/auth/register`
4. 选择Body标签
5. 选择`raw`和`JSON`格式
6. 输入请求体（见上方示例）
7. 点击`Send`发送请求

### 预期结果
- 状态码：201
- 返回用户信息和Token
- 可以使用返回的accessToken访问需要认证的接口

---

## 相关接口

- [1.2 用户登录](./1.2-login.md)
- [1.4 刷新令牌](./1.4-refresh-token.md)
- [2.1 获取当前用户信息](./2.1-get-profile.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-21 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
