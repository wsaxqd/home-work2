# API 7.6 - 文字转语音

## 接口信息

- **接口名称**: 文字转语音
- **请求方法**: POST
- **请求路径**: `/api/ai/voice/to-speech`
- **需要认证**: 是

---

## 接口描述

将文字内容转换为语音音频文件，支持多种音色和语速，可用于故事朗读、文本播报等场景。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| text | String | 是 | 待转换文本(最大1000字) | "今天天气真好..." |
| voice | String | 否 | 音色(xiaoming/xiaohong/xiaogang，默认xiaoming) | "xiaoming" |
| speed | Float | 否 | 语速(0.5-2.0，默认1.0) | 1.0 |
| pitch | Float | 否 | 音调(0.5-2.0，默认1.0) | 1.0 |
| volume | Float | 否 | 音量(0.5-2.0，默认1.0) | 1.0 |
| format | String | 否 | 输出格式(mp3/wav，默认mp3) | "mp3" |

### 请求示例

```json
{
  "text": "今天天气真好，我和朋友们一起去公园玩了。我们玩了很多游戏，还吃了好吃的冰淇淋。",
  "voice": "xiaoming",
  "speed": 1.0,
  "pitch": 1.0,
  "volume": 1.0,
  "format": "mp3"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "转换成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "text": "今天天气真好，我和朋友们一起去公园玩了...",
    "audio_url": "https://example.com/audio/550e8400.mp3",
    "voice": "xiaoming",
    "speed": 1.0,
    "pitch": 1.0,
    "volume": 1.0,
    "format": "mp3",
    "duration": 12.5,
    "file_size": 200000,
    "word_count": 32,
    "created_at": "2024-12-21T14:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "文本内容不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 429 Too Many Requests - 超出限额
```json
{
  "success": false,
  "message": "今日文字转语音次数已用完，请明天再试"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "文字转语音失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 转换记录ID |
| text | String | 原始文本 |
| audio_url | String | 音频文件URL |
| voice | String | 使用的音色 |
| speed | Float | 语速 |
| pitch | Float | 音调 |
| volume | Float | 音量 |
| format | String | 音频格式 |
| duration | Float | 音频时长(秒) |
| file_size | Integer | 文件大小(字节) |
| word_count | Integer | 字数统计 |
| created_at | DateTime | 创建时间 |

---

## 业务规则

1. 文本长度限制：1-1000字
2. voice可选值：
   - xiaoming: 男童音（7-12岁）
   - xiaohong: 女童音（7-12岁）
   - xiaogang: 少年音（13-15岁）
3. speed: 0.5-2.0，1.0为正常语速
4. pitch: 0.5-2.0，1.0为正常音调
5. volume: 0.5-2.0，1.0为正常音量
6. 生成的音频文件保留7天
7. 每个用户每天限定转换次数（如50次）

---

## 使用场景

- 故事朗读
- 文章播报
- 学习内容朗读
- 睡前故事播放
- 无障碍阅读

---

## 注意事项

1. 转换时间约2-5秒，需显示加载状态
2. 音频URL有效期为7天
3. 建议实现音频播放器
4. 可以下载音频文件到本地
5. 注意控制转换频率

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/ai/voice/to-speech`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回音频文件URL
- duration显示音频时长
- audio_url可直接播放

---

## 相关接口

- [7.2 AI生成故事](./7.2-story.md)
- [7.5 语音转文字](./7.5-voice-to-text.md)
- [7.7 获取AI使用历史](./7.7-get-history.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
