# API 6.6 - 更新日记

## 接口信息

- **接口名称**: 更新日记
- **请求方法**: PUT
- **请求路径**: `/api/diary/:id`
- **需要认证**: 是

---

## 接口描述

更新指定日记的内容，可以修改标题、内容、心情、图片等信息。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Path参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| id | UUID | 是 | 日记ID | "550e8400-e29b-41d4-a716-446655440000" |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| title | String | 否 | 日记标题(最大100字) | "更新后的标题" |
| content | String | 否 | 日记内容(最大5000字) | "更新后的内容..." |
| mood | String | 否 | 心情(happy/sad/neutral/excited/angry) | "excited" |
| weather | String | 否 | 天气(sunny/cloudy/rainy/snowy) | "cloudy" |
| images | Array | 否 | 图片URL数组(最多9张) | ["url1"] |
| tags | Array | 否 | 标签数组 | ["学习", "思考"] |
| is_public | Boolean | 否 | 是否公开 | true |

### 请求示例

```json
{
  "title": "更新后的标题",
  "content": "今天的日记需要补充一些内容...",
  "mood": "excited",
  "weather": "cloudy",
  "images": [
    "https://example.com/new-image.jpg"
  ],
  "tags": ["学习", "思考", "总结"],
  "is_public": true
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "更新成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "user_id": "660e8400-e29b-41d4-a716-446655440000",
    "title": "更新后的标题",
    "content": "今天的日记需要补充一些内容...",
    "mood": "excited",
    "weather": "cloudy",
    "images": [
      "https://example.com/new-image.jpg"
    ],
    "tags": ["学习", "思考", "总结"],
    "is_public": true,
    "diary_date": "2024-12-21",
    "created_at": "2024-12-21T14:30:00.000Z",
    "updated_at": "2024-12-21T16:20:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "日记内容不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 403 Forbidden - 无权限
```json
{
  "success": false,
  "message": "无权修改该日记"
}
```

#### 404 Not Found - 不存在
```json
{
  "success": false,
  "message": "日记不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "更新日记失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 日记ID |
| user_id | UUID | 用户ID |
| title | String | 日记标题 |
| content | String | 日记内容 |
| mood | String | 心情 |
| weather | String | 天气 |
| images | Array | 图片URL数组 |
| tags | Array | 标签数组 |
| is_public | Boolean | 是否公开 |
| diary_date | String | 日记日期 |
| created_at | DateTime | 创建时间 |
| updated_at | DateTime | 更新时间 |

---

## 业务规则

1. 只能更新自己的日记
2. 可以部分更新，只传需要修改的字段
3. diary_date不能修改
4. updated_at自动更新为当前时间
5. content至少保留10个字符
6. 图片URL需通过上传接口获取

---

## 使用场景

- 修改日记内容
- 补充日记信息
- 修改隐私设置
- 添加或删除图片
- 更新标签和心情

---

## 注意事项

1. 只传需要修改的字段，支持部分更新
2. 需要校验权限，只能修改自己的日记
3. 建议实现自动保存功能
4. 修改公开状态需谨慎
5. 图片URL需提前上传

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`PUT`
3. 输入URL：`http://localhost:3000/api/diary/{日记ID}`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回更新后的日记信息
- updated_at字段已更新

---

## 相关接口

- [6.1 创建日记](./6.1-create-diary.md)
- [6.5 获取日记详情](./6.5-get-diary-detail.md)
- [6.7 删除日记](./6.7-delete-diary.md)
- [10.1 上传单个图片](./10.1-upload-image.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
