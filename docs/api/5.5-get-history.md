# API 5.5 - 获取游戏历史记录

## 接口信息

- **接口名称**: 获取游戏历史记录
- **请求方法**: GET
- **请求路径**: `/api/games/history`
- **需要认证**: 是

---

## 接口描述

获取用户的游戏历史记录，支持按游戏类型、时间范围、关卡等条件筛选，用于查看个人游戏历程。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| game_type | String | 否 | 游戏类型(不传则返回全部) | "puzzle" |
| level | Integer | 否 | 关卡筛选 | 5 |
| start_date | String | 否 | 开始日期(YYYY-MM-DD) | "2024-12-01" |
| end_date | String | 否 | 结束日期(YYYY-MM-DD) | "2024-12-31" |
| limit | Integer | 否 | 返回数量(默认20，最大100) | 20 |
| offset | Integer | 否 | 偏移量(默认0) | 0 |
| sort | String | 否 | 排序(time/score，默认time) | "score" |
| order | String | 否 | 顺序(asc/desc，默认desc) | "desc" |

### 请求示例

```
GET /api/games/history?game_type=puzzle&level=5&limit=20&sort=score&order=desc
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total": 45,
    "page": 1,
    "limit": 20,
    "list": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "game_type": "puzzle",
        "level": 5,
        "score": 98,
        "time_spent": 175,
        "stars": 3,
        "is_best": true,
        "rank": 12,
        "details": {
          "correct_answers": 19,
          "total_questions": 20,
          "combo_max": 15
        },
        "created_at": "2024-12-21T14:30:00.000Z"
      },
      {
        "id": "660e8400-e29b-41d4-a716-446655440000",
        "game_type": "puzzle",
        "level": 5,
        "score": 95,
        "time_spent": 180,
        "stars": 3,
        "is_best": false,
        "rank": 15,
        "details": {
          "correct_answers": 18,
          "total_questions": 20,
          "combo_max": 10
        },
        "created_at": "2024-12-21T10:15:00.000Z"
      },
      {
        "id": "770e8400-e29b-41d4-a716-446655440000",
        "game_type": "puzzle",
        "level": 5,
        "score": 92,
        "time_spent": 190,
        "stars": 3,
        "is_best": false,
        "rank": 20,
        "details": {
          "correct_answers": 17,
          "total_questions": 20,
          "combo_max": 8
        },
        "created_at": "2024-12-20T16:45:00.000Z"
      }
    ],
    "stats": {
      "total_games": 45,
      "best_score": 98,
      "average_score": 88.5,
      "total_time": 8100,
      "total_stars": 128
    }
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "日期格式不正确"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取历史记录失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| total | Integer | 总记录数 |
| page | Integer | 当前页码 |
| limit | Integer | 每页数量 |
| list | Array | 历史记录列表 |
| id | UUID | 记录ID |
| game_type | String | 游戏类型 |
| level | Integer | 关卡 |
| score | Integer | 得分 |
| time_spent | Integer | 用时(秒) |
| stars | Integer | 星级 |
| is_best | Boolean | 是否为最佳成绩 |
| rank | Integer | 当时排名 |
| details | Object | 详细数据 |
| created_at | DateTime | 创建时间 |
| stats | Object | 统计信息 |

---

## 业务规则

1. 默认按时间倒序排列(最新的在前)
2. sort=score时按得分排序，sort=time时按时间排序
3. is_best标记用户在该关卡的最佳成绩
4. stats返回筛选条件下的统计数据
5. 日期范围最大不超过1年
6. limit最大值为100

---

## 使用场景

- 个人中心查看游戏记录
- 分析游戏进步曲线
- 回顾历史最佳成绩
- 生成游戏报告
- 数据分析和统计

---

## 注意事项

1. 建议使用分页加载历史记录
2. details字段内容因游戏类型而异
3. rank为记录创建时的排名，可能与当前实际排名不同
4. 时间范围过大时查询可能较慢
5. 建议添加加载状态提示

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/games/history`
4. 在Headers中添加：
   - `Authorization`: `Bearer {你的accessToken}`
5. 在Params中添加：
   - Key: `game_type`, Value: `puzzle`
   - Key: `level`, Value: `5`
   - Key: `limit`, Value: `20`
   - Key: `sort`, Value: `score`
   - Key: `order`, Value: `desc`
6. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回历史记录列表
- stats包含统计信息
- is_best标记最佳成绩

---

## 相关接口

- [5.1 保存游戏成绩](./5.1-save-score.md)
- [5.2 获取游戏进度](./5.2-get-progress.md)
- [5.3 获取排行榜](./5.3-get-leaderboard.md)
- [5.4 获取用户排名](./5.4-get-rank.md)
- [8.4 获取学习进度报告](./8.4-get-report.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
