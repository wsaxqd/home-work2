# API 6.3 - 获取心情统计

## 接口信息

- **接口名称**: 获取心情统计
- **请求方法**: GET
- **请求路径**: `/api/diary/mood-stats`
- **需要认证**: 是

---

## 接口描述

获取用户在指定时间范围内的心情统计数据，包括各种心情的数量、占比、趋势等信息，用于可视化展示。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| start_date | String | 否 | 开始日期(YYYY-MM-DD，默认30天前) | "2024-11-21" |
| end_date | String | 否 | 结束日期(YYYY-MM-DD，默认今天) | "2024-12-21" |
| period | String | 否 | 统计周期(day/week/month，默认day) | "day" |

### 请求示例

```
GET /api/diary/mood-stats?start_date=2024-11-21&end_date=2024-12-21&period=day
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "period": "day",
    "start_date": "2024-11-21",
    "end_date": "2024-12-21",
    "total_entries": 28,
    "mood_distribution": {
      "happy": {
        "count": 12,
        "percentage": 42.86
      },
      "excited": {
        "count": 8,
        "percentage": 28.57
      },
      "neutral": {
        "count": 5,
        "percentage": 17.86
      },
      "sad": {
        "count": 2,
        "percentage": 7.14
      },
      "angry": {
        "count": 1,
        "percentage": 3.57
      }
    },
    "mood_trend": [
      {
        "date": "2024-12-21",
        "mood": "happy",
        "count": 1
      },
      {
        "date": "2024-12-20",
        "mood": "excited",
        "count": 1
      },
      {
        "date": "2024-12-19",
        "mood": "happy",
        "count": 1
      },
      {
        "date": "2024-12-18",
        "mood": "neutral",
        "count": 1
      }
    ],
    "dominant_mood": "happy",
    "mood_change_rate": 0.25,
    "continuous_positive_days": 5
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "日期格式不正确"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取心情统计失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| period | String | 统计周期 |
| start_date | String | 开始日期 |
| end_date | String | 结束日期 |
| total_entries | Integer | 总日记数 |
| mood_distribution | Object | 心情分布 |
| count | Integer | 该心情数量 |
| percentage | Float | 占比(保留2位小数) |
| mood_trend | Array | 心情趋势(时间序列) |
| dominant_mood | String | 主导心情 |
| mood_change_rate | Float | 心情变化率 |
| continuous_positive_days | Integer | 连续积极情绪天数 |

---

## 业务规则

1. 默认统计最近30天的数据
2. period=day时返回每天的心情，week时返回每周，month时返回每月
3. mood_distribution按心情类型分组统计
4. dominant_mood为出现次数最多的心情
5. mood_change_rate = 心情变化次数 / 总天数
6. continuous_positive_days统计happy和excited的连续天数
7. 积极情绪包括happy、excited

---

## 使用场景

- 心情统计图表展示
- 情绪健康分析
- 学习情绪报告
- 家长查看孩子情绪状态
- 生成情绪趋势报告

---

## 注意事项

1. 时间范围最大不超过1年
2. percentage保留2位小数
3. mood_trend数组按时间倒序排列
4. 如果某天没有日记，该日期不会出现在mood_trend中
5. 建议使用图表库进行可视化展示

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/diary/mood-stats`
4. 在Headers中添加：
   - `Authorization`: `Bearer {你的accessToken}`
5. 在Params中添加（可选）：
   - Key: `start_date`, Value: `2024-11-21`
   - Key: `end_date`, Value: `2024-12-21`
   - Key: `period`, Value: `day`
6. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回心情统计数据
- mood_distribution包含各心情占比
- mood_trend包含时间序列数据

---

## 相关接口

- [6.2 获取日记列表](./6.2-get-diary-list.md)
- [6.4 获取日历数据](./6.4-get-calendar.md)
- [8.4 获取学习进度报告](./8.4-get-report.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
