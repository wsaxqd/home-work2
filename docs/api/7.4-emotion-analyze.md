# API 7.4 - 情感分析

## 接口信息

- **接口名称**: 情感分析
- **请求方法**: POST
- **请求路径**: `/api/ai/emotion/analyze`
- **需要认证**: 是

---

## 接口描述

分析文本内容的情感倾向，识别情绪类型、强度、关键词等，可用于日记情感分析、文本情绪理解等场景。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| text | String | 是 | 待分析文本(最大2000字) | "今天非常开心..." |
| type | String | 否 | 分析类型(basic/detailed，默认basic) | "detailed" |
| language | String | 否 | 文本语言(zh/en，默认zh) | "zh" |

### 请求示例

```json
{
  "text": "今天非常开心！我在学校学到了很多新知识，老师夸奖了我，还交到了新朋友。虽然作业有点难，但我还是认真完成了。",
  "type": "detailed",
  "language": "zh"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "分析成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "text": "今天非常开心！我在学校学到了很多新知识...",
    "primary_emotion": "happy",
    "emotion_scores": {
      "happy": 0.85,
      "excited": 0.15,
      "neutral": 0.05,
      "sad": 0.02,
      "angry": 0.01
    },
    "sentiment": "positive",
    "sentiment_score": 0.82,
    "intensity": "strong",
    "keywords": [
      {
        "word": "开心",
        "emotion": "happy",
        "weight": 0.9
      },
      {
        "word": "学到",
        "emotion": "excited",
        "weight": 0.7
      },
      {
        "word": "夸奖",
        "emotion": "happy",
        "weight": 0.8
      },
      {
        "word": "难",
        "emotion": "neutral",
        "weight": 0.3
      }
    ],
    "themes": ["学习", "社交", "成就"],
    "suggestion": "你今天过得很充实！保持这种积极的学习态度，继续加油！",
    "created_at": "2024-12-21T14:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "文本内容不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 429 Too Many Requests - 超出限额
```json
{
  "success": false,
  "message": "今日情感分析次数已用完，请明天再试"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "情感分析失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 分析记录ID |
| text | String | 原始文本 |
| primary_emotion | String | 主要情绪 |
| emotion_scores | Object | 各情绪得分(0-1) |
| sentiment | String | 情感倾向(positive/negative/neutral) |
| sentiment_score | Float | 情感得分(-1到1) |
| intensity | String | 情绪强度(weak/medium/strong) |
| keywords | Array | 情感关键词 |
| word | String | 关键词 |
| emotion | String | 关联情绪 |
| weight | Float | 权重(0-1) |
| themes | Array | 主题标签 |
| suggestion | String | AI建议 |
| created_at | DateTime | 创建时间 |

---

## 业务规则

1. primary_emotion为得分最高的情绪
2. emotion_scores所有值之和为1
3. sentiment_score: 正值为positive，负值为negative，接近0为neutral
4. intensity根据情绪得分判断：>0.7为strong，0.4-0.7为medium，<0.4为weak
5. type=basic时只返回primary_emotion、sentiment、sentiment_score
6. type=detailed时返回完整分析结果
7. keywords按weight降序排列

---

## 使用场景

- 日记情感分析
- 文本情绪理解
- 情绪健康监测
- 学习状态评估
- 心理健康辅助

---

## 注意事项

1. 文本长度建议在50-2000字之间
2. 过短的文本可能分析不准确
3. 建议结合上下文理解分析结果
4. suggestion仅供参考，不作为专业建议
5. 隐私敏感内容不应提交分析

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/ai/emotion/analyze`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回情感分析结果
- primary_emotion显示主要情绪
- emotion_scores包含各情绪得分

---

## 相关接口

- [6.1 创建日记](./6.1-create-diary.md)
- [6.3 获取心情统计](./6.3-get-mood-stats.md)
- [7.1 AI对话](./7.1-chat.md)
- [7.7 获取AI使用历史](./7.7-get-history.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
