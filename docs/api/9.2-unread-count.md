# API 9.2 - 获取未读通知数量

## 接口信息

- **接口名称**: 获取未读通知数量
- **请求方法**: GET
- **请求路径**: `/api/notifications/unread-count`
- **需要认证**: 是

---

## 接口描述

获取当前用户的未读通知数量，用于显示通知角标。可选择获取总数或按类型分组统计。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| grouped | Boolean | 否 | 是否按类型分组(默认false) | true, false |

### 请求示例

```http
GET /api/notifications/unread-count?grouped=true
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## 响应结果

### 成功响应 - 不分组 (200 OK)

```json
{
  "success": true,
  "data": {
    "total": 15
  }
}
```

### 成功响应 - 按类型分组 (200 OK)

```json
{
  "success": true,
  "data": {
    "total": 15,
    "byType": {
      "system": 2,
      "comment": 5,
      "like": 6,
      "follow": 1,
      "achievement": 1
    }
  }
}
```

### 错误响应

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取未读数量失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| total | Number | 未读通知总数 |
| byType | Object | 按类型分组的未读数(当grouped=true时返回) |
| byType.system | Number | 系统通知未读数 |
| byType.comment | Number | 评论通知未读数 |
| byType.like | Number | 点赞通知未读数 |
| byType.follow | Number | 关注通知未读数 |
| byType.achievement | Number | 成就通知未读数 |

---

## 业务规则

1. 只统计当前用户的未读通知
2. 实时计算，确保数据准确
3. 支持按类型分组统计
4. 不包含已删除的通知
5. 超过99条显示为99+

---

## 使用场景

- 显示通知角标
- 导航栏未读提示
- 实时更新未读数量
- 分类显示未读统计

---

## 注意事项

1. 建议使用轮询或WebSocket实时更新
2. 轮询间隔建议不少于30秒
3. 超过99条建议显示为"99+"
4. 已读后需要刷新未读数量

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/notifications/unread-count?grouped=true`
4. 在Headers中添加：
   - Key: `Authorization`
   - Value: `Bearer {你的accessToken}`
5. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回未读通知数量
- 如果grouped=true，返回分类统计

---

## 相关接口

- [9.1 获取通知列表](./9.1-notifications-list.md)
- [9.3 标记单个通知为已读](./9.3-mark-as-read.md)
- [9.4 标记所有通知为已读](./9.4-mark-all-as-read.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
