# API 6.2 - 获取日记列表

## 接口信息

- **接口名称**: 获取日记列表
- **请求方法**: GET
- **请求路径**: `/api/diary`
- **需要认证**: 是

---

## 接口描述

获取用户的日记列表，支持按时间、心情、标签等条件筛选，可分页加载。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Query参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| mood | String | 否 | 心情筛选(happy/sad/neutral/excited/angry) | "happy" |
| tag | String | 否 | 标签筛选 | "学习" |
| start_date | String | 否 | 开始日期(YYYY-MM-DD) | "2024-12-01" |
| end_date | String | 否 | 结束日期(YYYY-MM-DD) | "2024-12-31" |
| limit | Integer | 否 | 返回数量(默认20，最大100) | 20 |
| offset | Integer | 否 | 偏移量(默认0) | 0 |
| order | String | 否 | 排序(asc/desc，默认desc) | "desc" |

### 请求示例

```
GET /api/diary?mood=happy&limit=20&order=desc
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "获取成功",
  "data": {
    "total": 45,
    "page": 1,
    "limit": 20,
    "list": [
      {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "title": "快乐的一天",
        "content": "今天学习了很多知识，完成了三个小游戏...",
        "mood": "happy",
        "weather": "sunny",
        "images": [
          "https://example.com/image1.jpg",
          "https://example.com/image2.jpg"
        ],
        "tags": ["学习", "成长", "游戏"],
        "is_public": false,
        "diary_date": "2024-12-21",
        "created_at": "2024-12-21T14:30:00.000Z"
      },
      {
        "id": "660e8400-e29b-41d4-a716-446655440000",
        "title": "有趣的实验",
        "content": "今天做了一个科学小实验，太神奇了...",
        "mood": "excited",
        "weather": "cloudy",
        "images": [
          "https://example.com/image3.jpg"
        ],
        "tags": ["科学", "实验"],
        "is_public": true,
        "diary_date": "2024-12-20",
        "created_at": "2024-12-20T16:20:00.000Z"
      }
    ]
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "日期格式不正确"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "获取日记列表失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| total | Integer | 总记录数 |
| page | Integer | 当前页码 |
| limit | Integer | 每页数量 |
| list | Array | 日记列表 |
| id | UUID | 日记ID |
| title | String | 日记标题 |
| content | String | 日记内容(列表中截取前100字) |
| mood | String | 心情 |
| weather | String | 天气 |
| images | Array | 图片URL数组 |
| tags | Array | 标签数组 |
| is_public | Boolean | 是否公开 |
| diary_date | String | 日记日期 |
| created_at | DateTime | 创建时间 |

---

## 业务规则

1. 默认按diary_date倒序排列(最新的在前)
2. 列表中content字段只返回前100字，完整内容需调用详情接口
3. 可同时使用多个筛选条件
4. 日期范围最大不超过1年
5. limit最大值为100
6. 只能查看自己的日记列表

---

## 使用场景

- 日记列表页面展示
- 按心情查看日记
- 按标签分类浏览
- 时间轴展示
- 搜索和筛选日记

---

## 注意事项

1. 建议使用分页加载
2. content字段被截断，完整内容需调用详情接口
3. 筛选条件支持组合使用
4. 图片数组可能为空
5. title可能为null

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`GET`
3. 输入URL：`http://localhost:3000/api/diary`
4. 在Headers中添加：
   - `Authorization`: `Bearer {你的accessToken}`
5. 在Params中添加（可选）：
   - Key: `mood`, Value: `happy`
   - Key: `limit`, Value: `20`
   - Key: `order`, Value: `desc`
6. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回日记列表数据
- total显示总数量
- list包含日记数组

---

## 相关接口

- [6.1 创建日记](./6.1-create-diary.md)
- [6.3 获取心情统计](./6.3-get-mood-stats.md)
- [6.4 获取日历数据](./6.4-get-calendar.md)
- [6.5 获取日记详情](./6.5-get-diary-detail.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
