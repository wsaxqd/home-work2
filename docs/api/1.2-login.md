# API 1.2 - 用户登录

## 接口信息

- **接口名称**: 用户登录
- **请求方法**: POST
- **请求路径**: `/api/auth/login`
- **需要认证**: 否

---

## 接口描述

用户使用手机号和密码登录系统，成功后返回JWT Token用于后续请求认证。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| phone | String | 是 | 注册的手机号 | "13800138000" |
| password | String | 是 | 登录密码 | "123456" |

### 请求示例

```json
{
  "phone": "13800138000",
  "password": "123456"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "550e8400-e29b-41d4-a716-446655440000",
      "phone": "13800138000",
      "nickname": "小明",
      "avatar": "https://example.com/avatar.jpg",
      "bio": "这是我的个人简介",
      "created_at": "2024-12-20T10:00:00.000Z",
      "updated_at": "2024-12-21T14:30:00.000Z"
    },
    "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
    "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
  }
}
```

### 错误响应

#### 400 Bad Request - 参数缺失
```json
{
  "success": false,
  "message": "请提供手机号和密码"
}
```

#### 401 Unauthorized - 认证失败
```json
{
  "success": false,
  "message": "手机号或密码错误"
}
```

#### 500 Internal Server Error
```json
{
  "success": false,
  "message": "登录失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| user.id | UUID | 用户唯一标识 |
| user.phone | String | 手机号 |
| user.nickname | String | 用户昵称 |
| user.avatar | String | 头像URL |
| user.bio | String | 个人简介 |
| accessToken | String | 访问令牌（有效期2小时） |
| refreshToken | String | 刷新令牌（有效期7天） |

---

## 业务规则

1. 验证手机号是否存在
2. 使用bcrypt验证密码
3. 密码验证失败不返回具体原因（安全考虑）
4. 登录成功生成新的Token对
5. Token包含用户ID信息

---

## Postman测试

### 配置步骤
1. 方法：`POST`
2. URL：`http://localhost:3000/api/auth/login`
3. Body → raw → JSON
4. 输入请求体
5. 发送请求
6. 保存返回的accessToken用于后续测试

### 环境变量设置
可以在Postman中设置环境变量：
```javascript
// Tests标签中添加
pm.environment.set("accessToken", pm.response.json().data.accessToken);
```

---

## 相关接口

- [1.1 用户注册](./1.1-register.md)
- [1.3 退出登录](./1.3-logout.md)
- [1.4 刷新令牌](./1.4-refresh-token.md)
- [1.5 修改密码](./1.5-change-password.md)

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
