# API 4.10 - 更新心愿状态

## 接口信息

- **接口名称**: 更新心愿状态
- **请求方法**: PUT
- **请求路径**: `/api/community/wishes/:id/status`
- **需要认证**: 是

---

## 接口描述

更新心愿状态，将心愿标记为已实现或重新标记为进行中。仅心愿发布者可以操作。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Path参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | UUID | 是 | 心愿ID |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| status | String | 是 | 心愿状态(pending/achieved) | "achieved" |

### 请求示例

```json
{
  "status": "achieved"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "心愿状态更新成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440300",
    "content": "我希望能够创作出一个精彩的故事！",
    "category": "创作",
    "status": "achieved",
    "support_count": 25,
    "created_at": "2024-12-21T16:00:00.000Z",
    "achieved_at": "2024-12-21T17:00:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "无效的状态值"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 403 Forbidden - 无权操作
```json
{
  "success": false,
  "message": "只能更新自己的心愿"
}
```

#### 404 Not Found - 心愿不存在
```json
{
  "success": false,
  "message": "心愿不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "更新心愿状态失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| status | String | 心愿状态（已更新） |
| achieved_at | DateTime | 实现时间（标记为achieved时更新） |

---

## 业务规则

1. 仅心愿发布者本人可以更新状态
2. 状态枚举值：pending（进行中）、achieved（已实现）
3. 标记为achieved时，自动记录achieved_at时间
4. 标记为pending时，清空achieved_at时间
5. 支持者会收到心愿实现的通知

---

## 使用场景

- 心愿实现后标记
- 庆祝目标达成
- 激励其他用户
- 记录成长里程碑

---

## 注意事项

1. 建议添加庆祝动画效果
2. 可以分享心愿实现的喜悦
3. 已实现的心愿可以重新标记为进行中
4. 建议记录心愿实现的过程

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`PUT`
3. 输入URL：`http://localhost:3000/api/community/wishes/{wishId}/status`
4. 在Headers中添加：`Authorization: Bearer {accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回更新后的心愿信息
- achieved_at字段已更新
- 支持者收到通知

---

## 相关接口

- [4.7 发布心愿](./4.7-create-wish.md)
- [4.8 获取心愿墙](./4.8-get-wishes.md)
- [9.1 获取通知列表](./9.1-notifications-list.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-21 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
