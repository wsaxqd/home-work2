# API 10.5 - 删除文件

## 接口信息

- **接口名称**: 删除文件
- **请求方法**: DELETE
- **请求路径**: `/api/upload`
- **需要认证**: 是

---

## 接口描述

删除已上传的文件(图片、音频等)，从服务器和CDN中彻底移除。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |
| Content-Type | String | 是 | application/json |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| url | String | 是 | 文件URL或文件名 | "https://example.com/uploads/images/..." 或 "filename.jpg" |

### 请求示例

```json
{
  "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440000.jpg"
}
```

或

```json
{
  "url": "550e8400-e29b-41d4-a716-446655440000.jpg"
}
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "文件删除成功",
  "data": {
    "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440000.jpg",
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "deletedAt": "2024-12-22T10:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "文件URL不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "请先登录"
}
```

#### 403 Forbidden - 无权限
```json
{
  "success": false,
  "message": "无权删除此文件"
}
```

#### 404 Not Found - 文件不存在
```json
{
  "success": false,
  "message": "文件不存在或已被删除"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "删除失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| url | String | 被删除的文件URL |
| filename | String | 文件名 |
| deletedAt | DateTime | 删除时间 |

---

## 业务规则

1. 只能删除自己上传的文件
2. 支持通过完整URL或文件名删除
3. 删除操作不可撤销
4. 如果是头像的多个尺寸，会一并删除
5. 删除关联文件的引用记录
6. 从CDN中清除缓存
7. 重复删除返回404错误

---

## 使用场景

- 删除不需要的图片
- 清理临时上传文件
- 更换作品图片时删除旧图
- 删除错误上传的文件

---

## 注意事项

1. 删除操作不可恢复，请谨慎使用
2. 建议在删除前进行二次确认
3. 如果文件被其他内容引用，建议先解除引用
4. 头像删除会删除所有尺寸的文件
5. 只能删除自己上传的文件

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`DELETE`
3. 输入URL：`http://localhost:3000/api/upload`
4. 在Headers中添加：
   - Key: `Authorization`
   - Value: `Bearer {你的accessToken}`
   - Key: `Content-Type`
   - Value: `application/json`
5. 在Body中选择`raw`和`JSON`格式
6. 输入请求体：
```json
{
  "url": "你要删除的文件URL"
}
```
7. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 返回删除确认信息
- 文件无法再访问

---

## 相关接口

- [10.1 上传单个图片](./10.1-upload-image.md)
- [10.2 批量上传图片](./10.2-upload-images.md)
- [10.3 上传音频](./10.3-upload-audio.md)
- [10.4 上传头像](./10.4-upload-avatar.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
