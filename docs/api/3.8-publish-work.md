# API 3.8 - 发布作品

## 接口信息

- **接口名称**: 发布作品
- **请求方法**: POST
- **请求路径**: `/api/works/:id/publish`
- **需要认证**: 是

---

## 接口描述

将草稿状态的作品发布到公开画廊，发布后所有用户可见。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |

### Path参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| id | UUID | 是 | 作品ID |

### 请求示例

```
POST /api/works/550e8400-e29b-41d4-a716-446655440100/publish
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
```

---

## 响应结果

### 成功响应 (200 OK)

```json
{
  "success": true,
  "message": "作品发布成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440100",
    "title": "我的第一个故事",
    "type": "story",
    "status": "published",
    "cover_image": "https://example.com/cover1.jpg",
    "description": "这是一个有趣的故事",
    "content": "很久很久以前...",
    "created_at": "2024-12-20T10:00:00.000Z",
    "updated_at": "2024-12-21T15:00:00.000Z",
    "published_at": "2024-12-21T15:00:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 作品未完成
```json
{
  "success": false,
  "message": "作品标题和内容不能为空"
}
```

#### 400 Bad Request - 已发布
```json
{
  "success": false,
  "message": "作品已经发布"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 403 Forbidden - 无权操作
```json
{
  "success": false,
  "message": "无权发布该作品"
}
```

#### 404 Not Found - 作品不存在
```json
{
  "success": false,
  "message": "作品不存在"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "发布作品失败"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| status | String | 作品状态（已变为published） |
| published_at | DateTime | 发布时间（已更新） |

---

## 业务规则

1. 仅作者本人可以发布作品
2. 作品必须包含标题和内容才能发布
3. 发布后作品状态从draft变为published
4. 发布时间published_at记录为当前时间
5. 已发布的作品会出现在公开画廊中
6. 发布操作可以重复执行（幂等）

---

## 发布前校验

1. 标题不能为空
2. 内容不能为空
3. 作品类型必须有效
4. 封面图片建议但非必需

---

## 使用场景

- 完成创作后发布作品
- 草稿完善后公开展示
- 作品审核通过后发布
- 重新发布已下架的作品

---

## 注意事项

1. 发布前建议预览作品
2. 发布后作品立即公开，注意内容审核
3. 发布操作可以撤销（通过取消发布接口）
4. 建议添加发布确认提示

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/works/{workId}/publish`
4. 在Headers中添加：`Authorization: Bearer {accessToken}`
5. 点击`Send`发送请求

### 预期结果
- 状态码：200
- 作品状态变为published
- published_at字段有值
- 作品出现在公开画廊中

---

## 相关接口

- [3.5 获取作品详情](./3.5-work-detail.md)
- [3.9 取消发布](./3.9-unpublish-work.md)
- [3.1 获取公开作品画廊](./3.1-works-gallery.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-21 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-21
