# API 6.1 - 创建日记

## 接口信息

- **接口名称**: 创建日记
- **请求方法**: POST
- **请求路径**: `/api/diary`
- **需要认证**: 是

---

## 接口描述

创建一篇新的日记，支持文字、图片、心情标签等内容，可设置是否公开。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Content-Type | String | 是 | application/json |
| Authorization | String | 是 | Bearer {accessToken} |

### Body参数
| 参数名 | 类型 | 必填 | 说明 | 示例 |
|--------|------|------|------|------|
| title | String | 否 | 日记标题(最大100字) | "快乐的一天" |
| content | String | 是 | 日记内容(最大5000字) | "今天学习了很多知识..." |
| mood | String | 是 | 心情(happy/sad/neutral/excited/angry) | "happy" |
| weather | String | 否 | 天气(sunny/cloudy/rainy/snowy) | "sunny" |
| images | Array | 否 | 图片URL数组(最多9张) | ["url1", "url2"] |
| tags | Array | 否 | 标签数组 | ["学习", "成长"] |
| is_public | Boolean | 否 | 是否公开(默认false) | false |
| diary_date | String | 否 | 日记日期(YYYY-MM-DD，默认今天) | "2024-12-21" |

### 请求示例

```json
{
  "title": "快乐的一天",
  "content": "今天学习了很多知识，完成了三个小游戏，感觉非常开心！爸爸妈妈都夸奖我了。",
  "mood": "happy",
  "weather": "sunny",
  "images": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ],
  "tags": ["学习", "成长", "游戏"],
  "is_public": false,
  "diary_date": "2024-12-21"
}
```

---

## 响应结果

### 成功响应 (201 Created)

```json
{
  "success": true,
  "message": "日记创建成功",
  "data": {
    "id": "550e8400-e29b-41d4-a716-446655440000",
    "user_id": "660e8400-e29b-41d4-a716-446655440000",
    "title": "快乐的一天",
    "content": "今天学习了很多知识，完成了三个小游戏，感觉非常开心！爸爸妈妈都夸奖我了。",
    "mood": "happy",
    "weather": "sunny",
    "images": [
      "https://example.com/image1.jpg",
      "https://example.com/image2.jpg"
    ],
    "tags": ["学习", "成长", "游戏"],
    "is_public": false,
    "diary_date": "2024-12-21",
    "created_at": "2024-12-21T14:30:00.000Z",
    "updated_at": "2024-12-21T14:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "日记内容不能为空"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "未授权，请先登录"
}
```

#### 409 Conflict - 日期冲突
```json
{
  "success": false,
  "message": "该日期已存在日记"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "创建日记失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | UUID | 日记ID |
| user_id | UUID | 用户ID |
| title | String | 日记标题 |
| content | String | 日记内容 |
| mood | String | 心情标签 |
| weather | String | 天气 |
| images | Array | 图片URL数组 |
| tags | Array | 标签数组 |
| is_public | Boolean | 是否公开 |
| diary_date | String | 日记日期 |
| created_at | DateTime | 创建时间 |
| updated_at | DateTime | 更新时间 |

---

## 业务规则

1. 同一用户同一天只能创建一篇日记
2. title可选，不填则为null
3. content必填，最大5000字
4. mood必须是预定义的值之一
5. images最多9张，需先通过上传接口获取URL
6. tags数组最多10个标签，每个标签最大20字
7. diary_date不能晚于今天
8. 公开的日记可以被其他用户查看

---

## 使用场景

- 记录每日学习心得
- 记录情绪变化
- 图文日记创作
- 成长轨迹记录

---

## 注意事项

1. 图片需先通过上传接口上传
2. diary_date格式必须为YYYY-MM-DD
3. 建议前端实现自动保存草稿功能
4. 内容长度需在前端进行校验
5. 公开日记需注意内容审核

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/diary`
4. 在Headers中添加：
   - `Content-Type`: `application/json`
   - `Authorization`: `Bearer {你的accessToken}`
5. 选择Body标签
6. 选择`raw`和`JSON`格式
7. 输入请求体（见上方示例）
8. 点击`Send`发送请求

### 预期结果
- 状态码：201
- 返回创建的日记信息
- id字段为新生成的UUID

---

## 相关接口

- [6.2 获取日记列表](./6.2-get-diary-list.md)
- [6.5 获取日记详情](./6.5-get-diary-detail.md)
- [6.6 更新日记](./6.6-update-diary.md)
- [10.1 上传单个图片](./10.1-upload-image.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
