# API 10.1 - 上传单个图片

## 接口信息

- **接口名称**: 上传单个图片
- **请求方法**: POST
- **请求路径**: `/api/upload/image`
- **需要认证**: 是

---

## 接口描述

上传单个图片文件，支持常见图片格式，返回图片URL。适用于作品、日记等单图上传场景。

---

## 请求参数

### Header参数
| 参数名 | 类型 | 必填 | 说明 |
|--------|------|------|------|
| Authorization | String | 是 | Bearer {accessToken} |
| Content-Type | String | 是 | multipart/form-data |

### FormData参数
| 参数名 | 类型 | 必填 | 说明 | 限制 |
|--------|------|------|------|------|
| image | File | 是 | 图片文件 | jpg/jpeg/png/gif, 最大5MB |
| category | String | 否 | 图片分类 | "work", "diary", "other" (默认other) |

### 请求示例

```javascript
// JavaScript FormData示例
const formData = new FormData();
formData.append('image', fileInput.files[0]);
formData.append('category', 'work');

fetch('http://localhost:3000/api/upload/image', {
  method: 'POST',
  headers: {
    'Authorization': 'Bearer ' + accessToken
  },
  body: formData
});
```

---

## 响应结果

### 成功响应 (201 Created)

```json
{
  "success": true,
  "message": "图片上传成功",
  "data": {
    "url": "https://example.com/uploads/images/2024/12/550e8400-e29b-41d4-a716-446655440000.jpg",
    "filename": "550e8400-e29b-41d4-a716-446655440000.jpg",
    "originalName": "beautiful-scenery.jpg",
    "size": 1024567,
    "mimeType": "image/jpeg",
    "width": 1920,
    "height": 1080,
    "category": "work",
    "uploadedAt": "2024-12-22T10:30:00.000Z"
  }
}
```

### 错误响应

#### 400 Bad Request - 参数错误
```json
{
  "success": false,
  "message": "未选择文件"
}
```

#### 400 Bad Request - 文件格式错误
```json
{
  "success": false,
  "message": "不支持的图片格式，请上传jpg/jpeg/png/gif格式"
}
```

#### 400 Bad Request - 文件过大
```json
{
  "success": false,
  "message": "图片大小超出限制，最大5MB"
}
```

#### 401 Unauthorized - 未授权
```json
{
  "success": false,
  "message": "请先登录"
}
```

#### 500 Internal Server Error - 服务器错误
```json
{
  "success": false,
  "message": "上传失败，请稍后重试"
}
```

---

## 字段说明

### 响应字段
| 字段名 | 类型 | 说明 |
|--------|------|------|
| url | String | 图片访问URL(完整路径) |
| filename | String | 服务器存储文件名 |
| originalName | String | 原始文件名 |
| size | Number | 文件大小(字节) |
| mimeType | String | MIME类型 |
| width | Number | 图片宽度(像素) |
| height | Number | 图片高度(像素) |
| category | String | 图片分类 |
| uploadedAt | DateTime | 上传时间 |

---

## 业务规则

1. 支持的图片格式：jpg, jpeg, png, gif
2. 单个图片最大5MB
3. 图片自动压缩优化
4. 生成唯一文件名避免冲突
5. 支持分类管理
6. 图片按日期目录存储
7. 返回CDN加速URL

---

## 使用场景

- 上传作品封面图
- 上传日记配图
- 上传用户生成内容
- 单图上传场景

---

## 注意事项

1. 上传前建议在前端进行图片压缩
2. 文件名会被重命名为UUID
3. 建议显示上传进度条
4. 上传失败可以重试
5. 返回的URL可直接用于展示

---

## Postman测试

### 配置步骤
1. 创建新请求
2. 选择方法：`POST`
3. 输入URL：`http://localhost:3000/api/upload/image`
4. 在Headers中添加：
   - Key: `Authorization`
   - Value: `Bearer {你的accessToken}`
5. 在Body中选择`form-data`
6. 添加字段：
   - Key: `image`, Type: `File`, Value: 选择图片文件
   - Key: `category`, Type: `Text`, Value: `work`
7. 点击`Send`发送请求

### 预期结果
- 状态码：201
- 返回图片URL和详细信息
- 可以通过URL访问图片

---

## 相关接口

- [10.2 批量上传图片](./10.2-upload-images.md)
- [10.4 上传头像](./10.4-upload-avatar.md)
- [10.5 删除文件](./10.5-delete-file.md)

---

## 更新记录

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2024-12-22 | 初始版本 |

---

**维护者**: AI Assistant
**最后更新**: 2024-12-22
