## ğŸ”§ æ‰‹åŠ¨éƒ¨ç½²

å¦‚æœéœ€è¦æ‰‹åŠ¨æ§åˆ¶æ¯ä¸ªæ­¥éª¤ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æµç¨‹æ“ä½œã€‚

### 1. å®‰è£…ä¾èµ–

```bash
# å®‰è£…åç«¯ä¾èµ–
cd server
npm ci --production=false
cd ..

# å®‰è£…å‰ç«¯ä¾èµ–
cd app
npm ci --production=false
cd ..
```

### 2. è¿è¡Œæ•°æ®åº“è¿ç§»

```bash
cd server

# å¤åˆ¶ç¯å¢ƒå˜é‡æ–‡ä»¶
cp ../.env.production .env

# è¿è¡Œè¿ç§»
npm run migrate

cd ..
```

**é¢„æœŸè¾“å‡ºï¼š**
```
Running migration: 023_create_parent_tables
Running migration: 024_create_email_verify_codes
Migration completed successfully
```

### 3. æ„å»ºé¡¹ç›®

```bash
# æ„å»ºåç«¯
cd server
npm run build
cd ..

# æ„å»ºå‰ç«¯
cd app
npm run build
cd ..
```

**æ£€æŸ¥æ„å»ºç»“æœï¼š**
- `server/dist/` ç›®å½•åº”åŒ…å«ç¼–è¯‘åçš„ JavaScript æ–‡ä»¶
- `app/dist/` ç›®å½•åº”åŒ…å«é™æ€èµ„æºæ–‡ä»¶

### 4. å¯åŠ¨æœåŠ¡

#### æ–¹å¼ Aï¼šä½¿ç”¨ PM2ï¼ˆæ¨èï¼‰

```bash
# å®‰è£… PM2
npm install -g pm2

# å¯åŠ¨åç«¯æœåŠ¡
cd server
pm2 start dist/index.js --name qmzg-server

# æŸ¥çœ‹çŠ¶æ€
pm2 status

# æŸ¥çœ‹æ—¥å¿—
pm2 logs qmzg-server

# è®¾ç½®å¼€æœºè‡ªå¯
pm2 startup
pm2 save
```

#### æ–¹å¼ Bï¼šä½¿ç”¨ systemd

åˆ›å»ºæœåŠ¡æ–‡ä»¶ `/etc/systemd/system/qmzg.service`ï¼š

```ini
[Unit]
Description=å¯è’™ä¹‹å…‰åç«¯æœåŠ¡
After=network.target postgresql.service

[Service]
Type=simple
User=www-data
WorkingDirectory=/path/to/qmzg/server
Environment=NODE_ENV=production
ExecStart=/usr/bin/node dist/index.js
Restart=on-failure
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯åŠ¨æœåŠ¡ï¼š
```bash
sudo systemctl daemon-reload
sudo systemctl start qmzg
sudo systemctl enable qmzg
sudo systemctl status qmzg
```

#### æ–¹å¼ Cï¼šä½¿ç”¨ nohup

```bash
cd server
nohup node dist/index.js > ../logs/server.log 2>&1 &
echo $! > .pid
```

### 5. éªŒè¯éƒ¨ç½²

```bash
# æ£€æŸ¥åç«¯å¥åº·
curl http://localhost:3000/health

# é¢„æœŸè¾“å‡º
{"status":"ok"}
```

---
