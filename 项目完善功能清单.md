# 启蒙之光 - 项目完善功能清单

> 生成时间: 2026-01-19
> 当前完成度: 96%
> 待完善项: 13个核心功能

---

## 📊 项目概况

**项目名称**: 启蒙之光 (儿童AI教育平台)
**技术栈**: React + TypeScript + Express + PostgreSQL
**代码规模**: 4294个源文件
**核心功能**: 10大模块,49个前端页面,25个后端路由

---

## 🎯 完善清单总览

### 按优先级分类

| 优先级 | 数量 | 完成期限 | 说明 |
|--------|------|----------|------|
| 🔴 紧急 | 2项 | 立即处理 | 安全隐患,必须修复 |
| 🟠 高 | 4项 | 1-2周 | 核心功能,影响用户体验 |
| 🟡 中 | 4项 | 2-4周 | 质量提升,增强稳定性 |
| 🟢 低 | 3项 | 1-2月 | 可选功能,长期优化 |

### 按类型分类

| 类型 | 数量 | 说明 |
|------|------|------|
| 🔒 安全配置 | 2项 | 密钥、密码、权限 |
| 🤖 AI服务 | 3项 | 图像识别、语音功能 |
| 📱 用户认证 | 2项 | 短信验证、邮件配置 |
| 🧹 代码质量 | 2项 | 清理调试代码、测试 |
| ⚡ 性能优化 | 2项 | 缓存、数据库优化 |
| 📊 监控运维 | 2项 | 日志、CI/CD |

---

## 🔴 紧急优先级 (立即处理)

### ☑️ 1. 安全配置加固

**优先级**: 🔴 P0 (最高)
**预估工时**: 30分钟
**影响范围**: 整个系统安全

#### 当前问题
```env
# server/.env 存在安全隐患
JWT_SECRET=your-super-secret-key-change-in-production  # ⚠️ 默认值
JWT_REFRESH_SECRET=your-refresh-secret-key-change-in-production  # ⚠️ 默认值
DB_PASSWORD=dev_password_123  # ⚠️ 弱密码
```

#### 待完成任务

- [ ] 生成强随机JWT密钥 (至少64字符)
  ```bash
  node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
  ```

- [ ] 生成Refresh Token密钥 (不同于JWT)
  ```bash
  node -e "console.log(require('crypto').randomBytes(64).toString('hex'))"
  ```

- [ ] 修改数据库密码为强密码
  - 最小16字符
  - 包含大小写字母、数字、特殊符号
  - 示例: `Qm2026!Pg#Secure$Pass`

- [ ] 更新 `.env` 文件所有占位符

- [ ] 验证配置生效
  ```bash
  cd server && npm run dev
  # 检查控制台无警告
  ```

#### 验收标准
- ✅ 无默认密钥和密码
- ✅ 所有密钥长度 ≥ 64字符
- ✅ 服务启动无安全警告

---

### ☑️ 2. AI服务配置

**优先级**: 🔴 P0
**预估工时**: 1-2小时
**影响范围**: AI对话、故事生成等核心功能

#### 当前问题
```env
# AI服务使用占位符,功能不可用
ZHIPU_API_KEY=your-zhipu-api-key-here
DIFY_CHAT_APP_KEY=app-your-chat-app-key
DIFY_STORY_APP_KEY=app-your-story-app-key
DIFY_EMOTION_APP_KEY=app-your-emotion-app-key
```

#### 待完成任务

**方案A: 使用智谱AI (推荐)**

- [ ] 注册智谱AI账号
  - 访问: https://open.bigmodel.cn
  - 完成实名认证

- [ ] 获取API密钥
  - 进入控制台 → API Keys
  - 创建新密钥

- [ ] 配置环境变量
  ```env
  AI_PROVIDER=zhipu
  ZHIPU_API_KEY=your-actual-api-key
  ```

- [ ] 测试AI功能
  ```bash
  cd server/scripts
  node test-ai-service.js
  ```

**方案B: 使用Dify AI**

- [ ] 部署Dify服务 (可选自建)
  - 访问: https://cloud.dify.ai
  - 或 Docker自建: `docker-compose up -d`

- [ ] 创建3个应用
  - 聊天应用 (Chat Assistant)
  - 故事生成 (Text Generator)
  - 情感分析 (Text Generator)

- [ ] 获取App Keys
  - 每个应用的设置页面
  - 复制 API Key (app-xxxx格式)

- [ ] 配置环境变量
  ```env
  AI_PROVIDER=dify
  DIFY_API_URL=https://api.dify.ai/v1
  DIFY_CHAT_APP_KEY=app-your-chat-key
  DIFY_STORY_APP_KEY=app-your-story-key
  DIFY_EMOTION_APP_KEY=app-your-emotion-key
  ```

- [ ] 测试连接
  ```bash
  cd server
  node scripts/check-dify-config.js
  ```

#### 验收标准
- ✅ AI对话功能正常返回
- ✅ 故事生成功能可用
- ✅ 无模拟数据返回

**参考文档**:
- `DIFY_CONFIG_GUIDE.md`
- `ZHIPU_CONFIG_GUIDE.md`

---

## 🟠 高优先级 (1-2周内完成)

### ☑️ 3. AI图像识别服务对接

**优先级**: 🟠 P1
**预估工时**: 4-6小时
**影响范围**: 图像识别游戏功能

#### 当前问题
```typescript
// server/src/services/aiService.ts:194
// 返回模拟数据,游戏无法正常使用
return {
  objects: ['示例对象'],
  confidence: 0.95,
  description: '图像识别功能开发中'
}
```

#### 待完成任务

**推荐方案: 百度AI图像识别**

- [ ] 注册百度AI开放平台
  - 访问: https://ai.baidu.com
  - 创建应用获取 AppID、API Key、Secret Key

- [ ] 安装SDK
  ```bash
  cd server
  npm install baidu-aip-sdk
  ```

- [ ] 配置环境变量
  ```env
  BAIDU_AI_APP_ID=your-app-id
  BAIDU_AI_API_KEY=your-api-key
  BAIDU_AI_SECRET_KEY=your-secret-key
  ```

- [ ] 实现图像识别服务
  ```typescript
  // server/src/services/imageRecognitionService.ts
  import AipImageClassifyClient from 'baidu-aip-sdk'

  const client = new AipImageClassifyClient(
    process.env.BAIDU_AI_APP_ID,
    process.env.BAIDU_AI_API_KEY,
    process.env.BAIDU_AI_SECRET_KEY
  )

  export async function recognizeImage(imageBuffer: Buffer) {
    const result = await client.objectDetect(imageBuffer)
    return {
      objects: result.result.map(item => item.name),
      confidence: result.result[0]?.score || 0,
      description: '识别成功'
    }
  }
  ```

- [ ] 更新aiService.ts调用真实服务

- [ ] 测试图像识别游戏

#### 替代方案
- 腾讯云智能图像识别
- 阿里云视觉智能开放平台
- Google Cloud Vision API

#### 验收标准
- ✅ 上传图片返回真实识别结果
- ✅ 图像识别游戏正常运行
- ✅ 识别准确率 > 80%

---

### ☑️ 4. 短信验证码功能实现

**优先级**: 🟠 P1
**预估工时**: 6-8小时
**影响范围**: 用户登录注册

#### 当前状态
- ✅ 前端UI已完成
- ❌ 后端服务未实现
- ❌ 数据库表未创建

#### 待完成任务

**第一步: 数据库迁移**

- [ ] 创建迁移文件
  ```bash
  cd server/migrations
  touch 010_create_sms_verify_codes_table.sql
  ```

- [ ] 编写SQL
  ```sql
  CREATE TABLE sms_verify_codes (
    id SERIAL PRIMARY KEY,
    phone VARCHAR(11) NOT NULL,
    code VARCHAR(6) NOT NULL,
    expires_at TIMESTAMP NOT NULL,
    used BOOLEAN DEFAULT false,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
  );

  CREATE INDEX idx_sms_phone_code ON sms_verify_codes(phone, code);
  CREATE INDEX idx_sms_expires ON sms_verify_codes(expires_at);
  ```

- [ ] 运行迁移
  ```bash
  cd server
  npx ts-node src/migrations/run.ts
  ```

**第二步: 对接短信服务**

- [ ] 选择短信服务商
  - 阿里云短信服务 (推荐)
  - 腾讯云短信
  - 华为云短信

- [ ] 注册并配置
  ```bash
  npm install @alicloud/dysmsapi20170525
  ```

- [ ] 配置环境变量
  ```env
  SMS_PROVIDER=aliyun
  ALIYUN_ACCESS_KEY_ID=your-access-key-id
  ALIYUN_ACCESS_KEY_SECRET=your-access-key-secret
  SMS_SIGN_NAME=启蒙之光
  SMS_TEMPLATE_CODE=SMS_12345678
  ```

**第三步: 实现服务层**

- [ ] 创建服务文件
  ```bash
  touch server/src/services/smsVerifyService.ts
  ```

- [ ] 实现核心功能
  ```typescript
  // 参考 emailVerifyService.ts 实现
  export class SmsVerifyService {
    async sendVerifyCode(phone: string): Promise<boolean>
    async verifyCode(phone: string, code: string): Promise<boolean>
  }
  ```

**第四步: 添加路由**

- [ ] 更新认证路由
  ```typescript
  // server/src/routes/auth.ts
  router.post('/send-sms-code', authController.sendSmsVerifyCode)
  router.post('/sms-login', authController.smsLogin)
  ```

- [ ] 实现控制器
  ```typescript
  // server/src/controllers/authController.ts
  export async function sendSmsVerifyCode(req, res) { }
  export async function smsLogin(req, res) { }
  ```

**第五步: 测试**

- [ ] 单元测试
  ```bash
  cd server/scripts
  touch test-sms-service.ts
  npx ts-node test-sms-service.ts
  ```

- [ ] 前端集成测试
  - 访问登录页面
  - 选择"短信验证码"登录
  - 输入手机号获取验证码
  - 验证登录成功

#### 验收标准
- ✅ 数据库表创建成功
- ✅ 发送验证码成功
- ✅ 验证码登录成功
- ✅ 验证码过期检查正常

---

### ☑️ 5. 邮件服务配置

**优先级**: 🟠 P1
**预估工时**: 1小时
**影响范围**: 邮箱验证码登录

#### 当前状态
- ✅ 代码已实现 (emailService.ts)
- ⚠️ 使用模拟模式 (未配置SMTP)

#### 待完成任务

**方案A: Gmail (推荐测试)**

- [ ] 开启Google两步验证
  - 访问: https://myaccount.google.com/security

- [ ] 生成应用专用密码
  - 安全 → 两步验证 → 应用专用密码
  - 选择"邮件"和"其他设备"

- [ ] 配置环境变量
  ```env
  SMTP_HOST=smtp.gmail.com
  SMTP_PORT=587
  SMTP_SECURE=false
  SMTP_USER=your-email@gmail.com
  SMTP_PASSWORD=your-16-digit-app-password
  EMAIL_FROM=your-email@gmail.com
  ```

**方案B: QQ邮箱**

- [ ] 开启SMTP服务
  - 设置 → 账户 → POP3/IMAP/SMTP
  - 生成授权码

- [ ] 配置
  ```env
  SMTP_HOST=smtp.qq.com
  SMTP_PORT=587
  SMTP_SECURE=false
  SMTP_USER=your-qq-number@qq.com
  SMTP_PASSWORD=your-authorization-code
  EMAIL_FROM=your-qq-number@qq.com
  ```

**方案C: 163邮箱**

- [ ] 开启SMTP服务并获取授权码

- [ ] 配置
  ```env
  SMTP_HOST=smtp.163.com
  SMTP_PORT=465
  SMTP_SECURE=true
  SMTP_USER=your-email@163.com
  SMTP_PASSWORD=your-authorization-code
  EMAIL_FROM=your-email@163.com
  ```

**测试邮件发送**

- [ ] 重启服务
  ```bash
  cd server
  npm run dev
  ```

- [ ] 测试登录
  - 访问 http://localhost:5174/login
  - 选择"邮箱验证码"
  - 输入邮箱获取验证码
  - 检查邮箱收件箱

#### 验收标准
- ✅ 验证码邮件成功发送
- ✅ 邮件格式美观
- ✅ 验证码登录成功
- ✅ 控制台无SMTP错误

**参考文档**: `EMAIL_CONFIG_GUIDE.md`

---

### ☑️ 6. 调试代码清理

**优先级**: 🟠 P1
**预估工时**: 2-3小时
**影响范围**: 代码质量、生产环境性能

#### 当前问题
- **console.log**: 70+处调试语句
- **alert()**: 90+处临时提示
- 影响生产环境性能和用户体验

#### 待完成任务

**第一步: 创建统一日志工具**

- [ ] 创建日志工具
  ```bash
  touch server/src/utils/logger.ts
  touch app/src/utils/logger.ts
  ```

- [ ] 实现环境感知日志
  ```typescript
  // server/src/utils/logger.ts
  export const logger = {
    log: (...args: any[]) => {
      if (process.env.NODE_ENV !== 'production') {
        console.log(...args)
      }
    },
    error: (...args: any[]) => {
      console.error(...args) // 错误总是记录
    },
    warn: (...args: any[]) => {
      if (process.env.NODE_ENV !== 'production') {
        console.warn(...args)
      }
    }
  }
  ```

**第二步: 创建Toast通知组件**

- [ ] 创建Toast组件
  ```bash
  touch app/src/components/Toast.tsx
  touch app/src/components/Toast.css
  ```

- [ ] 实现Toast Hook
  ```typescript
  // app/src/hooks/useToast.ts
  export const useToast = () => {
    return {
      success: (message: string) => {},
      error: (message: string) => {},
      info: (message: string) => {}
    }
  }
  ```

**第三步: 批量替换**

- [ ] 替换console.log
  ```bash
  # 查找所有console.log
  cd server
  grep -r "console.log" src/ --exclude-dir=node_modules

  # 手动替换为 logger.log
  ```

- [ ] 替换alert()
  ```bash
  # 查找所有alert
  cd app
  grep -r "alert(" src/ --exclude-dir=node_modules

  # 替换为 toast.success/error/info
  ```

**第四步: 保留合理日志**

- [ ] 保留以下场景的日志
  - ✅ 服务启动信息
  - ✅ 错误日志 (console.error)
  - ✅ 配置验证工具
  - ✅ 测试脚本

#### 验收标准
- ✅ 生产环境无console.log输出
- ✅ 所有alert替换为Toast
- ✅ 错误日志保留
- ✅ 用户体验改善

---

## 🟡 中优先级 (2-4周内完成)

### ☑️ 7. 错误处理优化

**优先级**: 🟡 P2
**预估工时**: 4-6小时

#### 待完成任务

- [ ] 集成Sentry错误监控
  ```bash
  npm install @sentry/node @sentry/react
  ```

- [ ] 配置Sentry
  ```typescript
  // server/src/index.ts
  import * as Sentry from '@sentry/node'

  Sentry.init({
    dsn: process.env.SENTRY_DSN,
    environment: process.env.NODE_ENV
  })
  ```

- [ ] 统一API响应格式
  ```typescript
  interface ApiResponse<T> {
    success: boolean
    data?: T
    error?: {
      code: string
      message: string
    }
  }
  ```

- [ ] 添加详细错误日志
  - 请求ID追踪
  - 用户上下文
  - 堆栈信息

#### 验收标准
- ✅ 所有错误上报到Sentry
- ✅ API响应格式统一
- ✅ 错误日志详细可追溯

---

### ☑️ 8. 性能优化

**优先级**: 🟡 P2
**预估工时**: 8-12小时

#### 待完成任务

**添加Redis缓存**

- [ ] 安装Redis
  ```bash
  npm install redis
  npm install -D @types/redis
  ```

- [ ] 配置环境变量
  ```env
  REDIS_HOST=localhost
  REDIS_PORT=6379
  REDIS_PASSWORD=your-redis-password
  ```

- [ ] 实现缓存服务
  ```typescript
  // server/src/services/cacheService.ts
  import { createClient } from 'redis'

  export const cache = {
    get: async (key: string) => {},
    set: async (key: string, value: any, ttl?: number) => {},
    del: async (key: string) => {}
  }
  ```

- [ ] 缓存热点数据
  - 用户会话
  - AI对话历史
  - 社区热门内容
  - 收藏列表

**数据库优化**

- [ ] 添加关键索引
  ```sql
  CREATE INDEX idx_users_email ON users(email);
  CREATE INDEX idx_works_user_created ON works(user_id, created_at DESC);
  CREATE INDEX idx_favorites_user_type ON favorites(user_id, item_type);
  ```

- [ ] 优化查询
  - 使用EXPLAIN分析慢查询
  - 添加必要的JOIN优化
  - 分页查询优化

- [ ] 连接池配置
  ```typescript
  const pool = new Pool({
    max: 20,
    idleTimeoutMillis: 30000,
    connectionTimeoutMillis: 2000
  })
  ```

**CDN加速**

- [ ] 配置静态资源CDN
- [ ] 图片压缩和优化
- [ ] 启用Gzip压缩

#### 验收标准
- ✅ Redis缓存命中率 > 80%
- ✅ API响应时间 < 200ms
- ✅ 数据库查询优化 > 50%

---

### ☑️ 9. 自动化测试

**优先级**: 🟡 P2
**预估工时**: 16-20小时

#### 待完成任务

**安装测试框架**

- [ ] 安装依赖
  ```bash
  # 后端测试
  cd server
  npm install -D jest @types/jest ts-jest supertest @types/supertest

  # 前端测试
  cd app
  npm install -D vitest @testing-library/react @testing-library/jest-dom

  # E2E测试
  npm install -D cypress
  ```

**单元测试 (目标覆盖率60%+)**

- [ ] 配置Jest/Vitest
  ```javascript
  // jest.config.js
  module.exports = {
    preset: 'ts-jest',
    testEnvironment: 'node',
    coverageThreshold: {
      global: {
        branches: 60,
        functions: 60,
        lines: 60
      }
    }
  }
  ```

- [ ] 编写服务层测试
  - authService.test.ts
  - aiService.test.ts
  - communityService.test.ts

- [ ] 编写组件测试
  - Login.test.tsx
  - StoryCreator.test.tsx
  - Favorites.test.tsx

**集成测试**

- [ ] API端点测试
  ```typescript
  // __tests__/api/auth.test.ts
  describe('POST /api/auth/login', () => {
    it('should login successfully', async () => {
      const res = await request(app)
        .post('/api/auth/login')
        .send({ username: 'test', password: 'test123' })
      expect(res.status).toBe(200)
      expect(res.body.success).toBe(true)
    })
  })
  ```

**E2E测试**

- [ ] 关键用户流程测试
  - 用户注册登录
  - 创作故事并收藏
  - 社区发布和互动
  - 家长控制功能

- [ ] 编写Cypress测试
  ```javascript
  // cypress/e2e/user-flow.cy.js
  describe('用户完整流程', () => {
    it('应该能够注册、登录、创作、收藏', () => {
      cy.visit('/login')
      cy.get('[data-testid="username"]').type('testuser')
      // ...
    })
  })
  ```

**CI配置**

- [ ] 创建GitHub Actions配置
  ```yaml
  # .github/workflows/test.yml
  name: Test
  on: [push, pull_request]
  jobs:
    test:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - run: npm install
        - run: npm test
  ```

#### 验收标准
- ✅ 单元测试覆盖率 ≥ 60%
- ✅ 所有API测试通过
- ✅ 关键流程E2E测试通过
- ✅ CI自动运行测试

---

### ☑️ 10. 文档完善

**优先级**: 🟡 P2
**预估工时**: 8-12小时

#### 待完成任务

**API文档**

- [ ] 集成Swagger/OpenAPI
  ```bash
  npm install swagger-ui-express swagger-jsdoc
  ```

- [ ] 添加API注释
  ```typescript
  /**
   * @swagger
   * /api/auth/login:
   *   post:
   *     summary: 用户登录
   *     tags: [认证]
   *     requestBody:
   *       required: true
   *       content:
   *         application/json:
   *           schema:
   *             type: object
   *             properties:
   *               username:
   *                 type: string
   */
  ```

- [ ] 生成API文档页面
  - 访问: http://localhost:3000/api-docs

**数据库文档**

- [ ] 绘制ER图
  - 使用dbdiagram.io或draw.io
  - 标注所有表关系

- [ ] 创建表结构说明文档
  ```markdown
  # 数据库设计文档

  ## 用户系统

  ### users 表
  | 字段 | 类型 | 说明 |
  |-----|------|------|
  | id | SERIAL | 主键 |
  | username | VARCHAR(50) | 用户名 |
  ...
  ```

**组件文档**

- [ ] 集成Storybook (可选)
  ```bash
  npx sb init
  ```

- [ ] 编写组件使用说明
  - 每个主要组件添加README
  - Props说明和使用示例

**其他文档**

- [ ] 贡献指南 (CONTRIBUTING.md)
  - 代码规范
  - Git工作流
  - PR流程

- [ ] 更新日志 (CHANGELOG.md)
  - 按版本记录变更

- [ ] 故障排查指南
  - 常见问题汇总
  - 解决方案

#### 验收标准
- ✅ API文档完整可访问
- ✅ 数据库ER图清晰
- ✅ 组件文档齐全
- ✅ 贡献指南完善

---

## 🟢 低优先级 (1-2个月内完成)

### ☑️ 11. 语音功能实现

**优先级**: 🟢 P3
**预估工时**: 12-16小时

#### 待完成任务

**语音识别服务**

- [ ] 选择服务商
  - 讯飞语音 (推荐)
  - 百度语音
  - 腾讯云语音

- [ ] 安装SDK
  ```bash
  npm install iflytek-asr-sdk
  ```

- [ ] 实现语音识别
  ```typescript
  // server/src/services/speechRecognitionService.ts
  export async function recognizeSpeech(audioBuffer: Buffer) {
    // 调用讯飞API
    return {
      text: '识别的文本',
      confidence: 0.95
    }
  }
  ```

- [ ] 更新aiService.ts

**语音合成服务**

- [ ] 实现TTS服务
  ```typescript
  // server/src/services/ttsService.ts
  export async function synthesizeSpeech(text: string) {
    // 调用TTS API
    return audioBuffer
  }
  ```

- [ ] 添加路由
  ```typescript
  router.post('/api/ai/synthesize', aiController.synthesizeSpeech)
  ```

**前端语音组件**

- [ ] 实现语音录制组件
  ```tsx
  // app/src/components/VoiceRecorder.tsx
  export default function VoiceRecorder() {
    // 使用MediaRecorder API
  }
  ```

- [ ] 集成到AI对话页面

#### 验收标准
- ✅ 语音识别准确率 > 85%
- ✅ 语音合成自然流畅
- ✅ 前端录音功能正常

---

### ☑️ 12. 监控与日志系统

**优先级**: 🟢 P3
**预估工时**: 8-10小时

#### 待完成任务

**日志系统**

- [ ] 集成Winston
  ```bash
  npm install winston winston-daily-rotate-file
  ```

- [ ] 配置日志
  ```typescript
  // server/src/utils/logger.ts
  import winston from 'winston'

  export const logger = winston.createLogger({
    level: 'info',
    format: winston.format.json(),
    transports: [
      new winston.transports.File({ filename: 'error.log', level: 'error' }),
      new winston.transports.File({ filename: 'combined.log' })
    ]
  })
  ```

- [ ] 日志分级
  - ERROR: 错误信息
  - WARN: 警告信息
  - INFO: 一般信息
  - DEBUG: 调试信息

**性能监控**

- [ ] 添加APM工具
  - New Relic (推荐)
  - Datadog
  - 自建Prometheus + Grafana

- [ ] 监控指标
  - API响应时间
  - 数据库查询性能
  - 内存使用
  - CPU使用率

**健康检查**

- [ ] 实现健康检查端点
  ```typescript
  app.get('/health', async (req, res) => {
    const dbStatus = await checkDatabase()
    const redisStatus = await checkRedis()

    res.json({
      status: 'ok',
      timestamp: Date.now(),
      services: { database: dbStatus, redis: redisStatus }
    })
  })
  ```

- [ ] 配置告警
  - 服务不可用告警
  - 错误率告警
  - 性能下降告警

#### 验收标准
- ✅ 日志完整可追溯
- ✅ 性能监控可视化
- ✅ 健康检查正常
- ✅ 告警及时准确

---

### ☑️ 13. CI/CD流程

**优先级**: 🟢 P3
**预估工时**: 6-8小时

#### 待完成任务

**GitHub Actions配置**

- [ ] 创建测试流程
  ```yaml
  # .github/workflows/test.yml
  name: Test
  on: [push, pull_request]
  jobs:
    test:
      runs-on: ubuntu-latest
      services:
        postgres:
          image: postgres:14
      steps:
        - uses: actions/checkout@v2
        - uses: actions/setup-node@v2
        - run: npm install
        - run: npm test
  ```

- [ ] 创建构建流程
  ```yaml
  # .github/workflows/build.yml
  name: Build
  on:
    push:
      branches: [main]
  jobs:
    build:
      runs-on: ubuntu-latest
      steps:
        - uses: actions/checkout@v2
        - run: docker build -t qmzg:latest .
        - run: docker push qmzg:latest
  ```

**自动部署**

- [ ] 配置生产环境部署
  ```yaml
  # .github/workflows/deploy.yml
  name: Deploy
  on:
    push:
      tags:
        - 'v*'
  jobs:
    deploy:
      runs-on: ubuntu-latest
      steps:
        - name: Deploy to server
          run: |
            ssh user@server 'cd /app && git pull && docker-compose up -d'
  ```

**代码质量检查**

- [ ] 添加ESLint检查
- [ ] 添加TypeScript编译检查
- [ ] 添加代码覆盖率报告

#### 验收标准
- ✅ 每次提交自动运行测试
- ✅ 主分支自动构建镜像
- ✅ Tag推送自动部署
- ✅ 代码质量门禁生效

---

## 📅 实施计划

### 第1周: 紧急安全修复

**目标**: 解决所有安全隐患

- [ ] Day 1: 安全配置加固 (任务1)
- [ ] Day 2-3: AI服务配置 (任务2)
- [ ] Day 4-5: 邮件服务配置 (任务5)

**交付物**:
- ✅ 所有密钥和密码已更新
- ✅ AI服务可正常使用
- ✅ 邮件验证码可发送

### 第2周: 核心功能完善

**目标**: 实现短信和图像识别

- [ ] Day 1-3: 短信验证码功能 (任务4)
- [ ] Day 4-5: AI图像识别服务 (任务3)

**交付物**:
- ✅ 短信验证码登录可用
- ✅ 图像识别游戏正常

### 第3周: 代码质量提升

**目标**: 清理代码,优化性能

- [ ] Day 1-2: 调试代码清理 (任务6)
- [ ] Day 3-5: 错误处理优化 (任务7)

**交付物**:
- ✅ 生产环境无调试代码
- ✅ 错误监控已集成

### 第4-6周: 性能与测试

**目标**: 性能优化和测试覆盖

- [ ] Week 4: 性能优化 (任务8)
- [ ] Week 5-6: 自动化测试 (任务9)

**交付物**:
- ✅ Redis缓存已部署
- ✅ 测试覆盖率 ≥ 60%

### 第7-8周: 文档与增强

**目标**: 完善文档,长期优化

- [ ] Week 7: 文档完善 (任务10)
- [ ] Week 8: 开始语音功能 (任务11)

**交付物**:
- ✅ API文档完整
- ✅ 语音功能基础版

### 第9-12周: 监控与流程

**目标**: 生产环境准备

- [ ] Week 9-10: 监控与日志 (任务12)
- [ ] Week 11-12: CI/CD流程 (任务13)

**交付物**:
- ✅ 监控告警系统
- ✅ 自动化部署流程

---

## 🎯 最小可行产品 (MVP) 清单

在正式发布前,**必须完成**以下项:

### 必须项 (Must Have)

- [ ] ✅ 修改所有默认密钥和密码 (任务1)
- [ ] ✅ 配置真实AI服务 (任务2)
- [ ] ✅ 配置邮件服务 (任务5)
- [ ] ✅ 清理调试代码 (任务6)
- [ ] ✅ 运行所有数据库迁移
- [ ] ✅ 添加基本错误监控 (任务7)

### 建议项 (Should Have)

- [ ] ⚠️ 实现短信验证码 (任务4)
- [ ] ⚠️ 对接AI图像识别 (任务3)
- [ ] ⚠️ 添加Redis缓存 (任务8)
- [ ] ⚠️ 基础自动化测试 (任务9)

### 可选项 (Nice to Have)

- [ ] 💡 完整API文档 (任务10)
- [ ] 💡 语音功能 (任务11)
- [ ] 💡 完整监控系统 (任务12)
- [ ] 💡 CI/CD流程 (任务13)

---

## 📊 进度追踪

### 总体进度

| 优先级 | 总数 | 已完成 | 进行中 | 未开始 | 完成率 |
|--------|------|--------|--------|--------|--------|
| 🔴 紧急 | 2 | 0 | 0 | 2 | 0% |
| 🟠 高 | 4 | 0 | 0 | 4 | 0% |
| 🟡 中 | 4 | 0 | 0 | 4 | 0% |
| 🟢 低 | 3 | 0 | 0 | 3 | 0% |
| **总计** | **13** | **0** | **0** | **13** | **0%** |

### 工时统计

| 优先级 | 预估总工时 | 实际工时 | 偏差 |
|--------|-----------|----------|------|
| 🔴 紧急 | 3.5小时 | - | - |
| 🟠 高 | 21小时 | - | - |
| 🟡 中 | 48小时 | - | - |
| 🟢 低 | 26小时 | - | - |
| **总计** | **98.5小时** | **-** | **-** |

**换算**: 约 12.3 个工作日 (按8小时/天)

---

## 📝 使用说明

### 如何使用此清单

1. **按优先级执行**: 从🔴紧急开始,逐步完成
2. **勾选完成项**: 完成后在 `- [ ]` 打勾 `- [x]`
3. **更新进度**: 定期更新"进度追踪"表格
4. **记录工时**: 在"实际工时"列记录真实耗时
5. **调整计划**: 根据实际情况调整顺序和工时

### 完成标准

每个任务完成后,需满足:
- ✅ 所有子任务已勾选
- ✅ 验收标准全部通过
- ✅ 代码已提交并合并
- ✅ 相关文档已更新
- ✅ 测试已通过

### 协作建议

如果是团队协作:
1. 每个任务指定负责人
2. 使用项目管理工具 (Jira/Trello)
3. 每日站会同步进度
4. 每周review完成情况
5. 及时调整优先级

---

## 🎓 参考资源

### 官方文档

- [Node.js文档](https://nodejs.org/docs)
- [React文档](https://react.dev)
- [PostgreSQL文档](https://www.postgresql.org/docs)
- [TypeScript文档](https://www.typescriptlang.org/docs)

### 第三方服务

- [智谱AI](https://open.bigmodel.cn)
- [Dify AI](https://cloud.dify.ai)
- [百度AI](https://ai.baidu.com)
- [阿里云短信](https://www.aliyun.com/product/sms)
- [Sentry监控](https://sentry.io)

### 项目内文档

- `README.md` - 项目说明
- `QUICK_START.md` - 快速开始
- `ENV_CONFIG_GUIDE.md` - 环境配置
- `DIFY_CONFIG_GUIDE.md` - AI配置
- `EMAIL_CONFIG_GUIDE.md` - 邮件配置
- `收藏功能使用指南.md` - 收藏功能
- `功能完善分析报告.md` - 分析报告

---

## 💬 常见问题

### Q: 我应该从哪个任务开始?

**A**: 严格按优先级执行:
1. 🔴 紧急: 安全配置 → AI服务配置
2. 🟠 高: 短信验证码 → 图像识别
3. 🟡 中: 按需选择
4. 🟢 低: 长期优化

### Q: 如果没有时间完成所有任务怎么办?

**A**: 至少完成"MVP必须项":
- 安全配置
- AI服务配置
- 邮件服务
- 调试代码清理
- 基本错误监控

这5项可让项目安全上线。

### Q: 某个任务遇到困难怎么办?

**A**: 可以:
1. 查看相关参考文档
2. 搜索官方文档和社区
3. 咨询有经验的开发者
4. 调整优先级,先完成其他任务

### Q: 如何验证任务是否真正完成?

**A**: 参考每个任务的"验收标准":
- 功能测试通过
- 代码review通过
- 文档已更新
- 没有遗留问题

---

## 📞 支持

如有问题或需要帮助:

1. **查看文档**: 先检查项目内文档
2. **搜索issue**: GitHub Issues查找类似问题
3. **提交issue**: 详细描述问题和环境
4. **联系团队**: 内部沟通渠道

---

## 📄 更新日志

| 版本 | 日期 | 说明 |
|------|------|------|
| v1.0 | 2026-01-19 | 初始版本,13个待完善功能 |

---

**祝开发顺利!** 🎉

记住:完成比完美更重要。先让项目安全上线,再逐步优化完善。
