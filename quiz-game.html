<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIçŸ¥è¯†é—®ç­” - å¯è’™ä¹‹å…‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #e1f5fe 0%, #f3e5f5 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding-bottom: 80px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #00bcd4 0%, #7e57c2 100%);
            color: white;
            border-radius: 0 0 20px 20px;
        }

        .back-button {
            font-size: 24px;
            cursor: pointer;
        }

        .page-title {
            font-size: 20px;
            flex: 1;
            text-align: center;
        }

        .score-display {
            background: rgba(255,255,255,0.3);
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 14px;
        }

        .main-content {
            padding: 20px;
        }

        /* æ¸¸æˆç±»å‹é€‰æ‹© */
        .game-type-section {
            margin-bottom: 20px;
        }

        .type-selector {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .type-card {
            background: linear-gradient(135deg, #e1f5fe 0%, #f3e5f5 100%);
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .type-card.selected {
            border-color: #00bcd4;
            background: linear-gradient(135deg, #00bcd4 0%, #7e57c2 100%);
            color: white;
            transform: scale(1.05);
        }

        .type-icon {
            font-size: 40px;
            margin-bottom: 10px;
        }

        .type-name {
            font-size: 16px;
            font-weight: bold;
        }

        /* éš¾åº¦é€‰æ‹© */
        .difficulty-selector {
            display: flex;
            gap: 10px;
            margin: 15px 0;
        }

        .difficulty-btn {
            flex: 1;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 10px;
            background: white;
            cursor: pointer;
            transition: all 0.3s;
        }

        .difficulty-btn.selected {
            background: #00bcd4;
            color: white;
            border-color: #00bcd4;
        }

        /* é¢˜ç›®åŒºåŸŸ */
        .question-area {
            background: #f9f9f9;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            min-height: 300px;
            display: none;
        }

        .question-area.active {
            display: block;
        }

        .question-progress {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 14px;
            color: #666;
        }

        .question-image {
            width: 100%;
            height: 200px;
            background: white;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 80px;
            margin-bottom: 20px;
            border: 2px solid #ddd;
        }

        .question-text {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 20px;
            text-align: center;
            color: #333;
        }

        .options-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        .option-btn {
            padding: 15px;
            background: white;
            border: 2px solid #ddd;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 16px;
        }

        .option-btn:hover {
            background: #e1f5fe;
            border-color: #00bcd4;
        }

        .option-btn.selected {
            background: #00bcd4;
            color: white;
            border-color: #00bcd4;
        }

        .option-btn.correct {
            background: #4caf50;
            color: white;
            border-color: #4caf50;
        }

        .option-btn.wrong {
            background: #f44336;
            color: white;
            border-color: #f44336;
        }

        .option-btn:disabled {
            cursor: not-allowed;
            opacity: 0.7;
        }

        /* åé¦ˆåŒºåŸŸ */
        .feedback-area {
            background: white;
            border-radius: 15px;
            padding: 15px;
            margin-top: 15px;
            display: none;
        }

        .feedback-area.show {
            display: block;
        }

        .feedback-icon {
            font-size: 40px;
            text-align: center;
            margin-bottom: 10px;
        }

        .feedback-text {
            text-align: center;
            font-size: 16px;
            color: #666;
        }

        /* æŒ‰é’® */
        .btn {
            width: 100%;
            padding: 15px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #00bcd4;
            color: white;
        }

        .btn-primary:hover {
            background: #0097a7;
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* ç»“æœé¡µé¢ */
        .result-area {
            background: #f9f9f9;
            border-radius: 20px;
            padding: 30px 20px;
            text-align: center;
            display: none;
        }

        .result-area.show {
            display: block;
        }

        .result-icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .result-score {
            font-size: 48px;
            font-weight: bold;
            color: #00bcd4;
            margin-bottom: 10px;
        }

        .result-text {
            font-size: 18px;
            color: #666;
            margin-bottom: 20px;
        }

        .result-stats {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            font-weight: bold;
            color: #00bcd4;
        }

        /* æ’è¡Œæ¦œ */
        .leaderboard {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
        }

        .leaderboard-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            padding: 10px;
            background: #f9f9f9;
            border-radius: 10px;
            margin-bottom: 8px;
        }

        .rank-number {
            width: 30px;
            height: 30px;
            background: #00bcd4;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 12px;
        }

        .player-info {
            flex: 1;
        }

        .player-name {
            font-weight: bold;
            color: #333;
        }

        .player-score {
            font-size: 18px;
            font-weight: bold;
            color: #00bcd4;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #00bcd4;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 480px;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }

        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #999;
        }

        .nav-item.active .nav-icon {
            color: #00bcd4;
        }

        .nav-text {
            font-size: 12px;
            color: #999;
        }

        .nav-item.active .nav-text {
            color: #00bcd4;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="back-button" onclick="goBack()">â†</div>
            <div class="page-title">AIçŸ¥è¯†é—®ç­”</div>
            <div class="score-display">å¾—åˆ†: <span id="score">0</span></div>
        </div>

        <div class="main-content">
            <!-- æ¸¸æˆç±»å‹é€‰æ‹© -->
            <div id="game-setup" class="game-type-section">
                <h3 style="margin-bottom: 15px;">é€‰æ‹©æ¸¸æˆç±»å‹</h3>
                <div class="type-selector">
                    <div class="type-card" onclick="selectGameType('image_recognition')">
                        <div class="type-icon">ğŸ–¼ï¸</div>
                        <div class="type-name">å›¾åƒè¯†åˆ«</div>
                    </div>
                    <div class="type-card" onclick="selectGameType('emotion_recognition')">
                        <div class="type-icon">ğŸ˜Š</div>
                        <div class="type-name">æƒ…ç»ªè¯†åˆ«</div>
                    </div>
                </div>

                <h3 style="margin: 20px 0 15px;">é€‰æ‹©éš¾åº¦</h3>
                <div class="difficulty-selector">
                    <button class="difficulty-btn selected" onclick="selectDifficulty(1)">ç®€å•</button>
                    <button class="difficulty-btn" onclick="selectDifficulty(2)">ä¸­ç­‰</button>
                    <button class="difficulty-btn" onclick="selectDifficulty(3)">å›°éš¾</button>
                </div>

                <button class="btn btn-primary" onclick="startGame()" id="start-btn" disabled>å¼€å§‹æ¸¸æˆ</button>
            </div>

            <!-- é¢˜ç›®åŒºåŸŸ -->
            <div id="question-area" class="question-area">
                <div class="question-progress">
                    <span>ç¬¬ <span id="current-q">1</span>/<span id="total-q">10</span> é¢˜</span>
                    <span id="timer">å‰©ä½™æ—¶é—´: <span id="time">30</span>ç§’</span>
                </div>

                <div class="question-image" id="question-image">
                    ğŸ–¼ï¸
                </div>

                <div class="question-text" id="question-text">
                    é¢˜ç›®åŠ è½½ä¸­...
                </div>

                <div class="options-grid" id="options-grid">
                    <!-- é€‰é¡¹å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>

                <div class="feedback-area" id="feedback">
                    <div class="feedback-icon" id="feedback-icon"></div>
                    <div class="feedback-text" id="feedback-text"></div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="submitAnswer()" id="submit-btn" disabled>æäº¤ç­”æ¡ˆ</button>
                    <button class="btn btn-primary" onclick="nextQuestion()" id="next-btn" style="display:none;">ä¸‹ä¸€é¢˜</button>
                </div>
            </div>

            <!-- ç»“æœé¡µé¢ -->
            <div id="result-area" class="result-area">
                <div class="result-icon">ğŸ‰</div>
                <div class="result-score"><span id="final-score">0</span> åˆ†</div>
                <div class="result-text">æ­å–œå®Œæˆæ¸¸æˆï¼</div>

                <div class="result-stats">
                    <div class="stat-item">
                        <span class="stat-label">ç­”å¯¹é¢˜æ•°</span>
                        <span class="stat-value"><span id="correct-count">0</span>/10</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">æ­£ç¡®ç‡</span>
                        <span class="stat-value"><span id="accuracy">0</span>%</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-label">ç”¨æ—¶</span>
                        <span class="stat-value"><span id="duration">0</span>ç§’</span>
                    </div>
                </div>

                <div class="leaderboard">
                    <div class="leaderboard-title">ğŸ† æ’è¡Œæ¦œ</div>
                    <div id="leaderboard-list">
                        <div class="loading">
                            <div class="spinner"></div>
                            <div>åŠ è½½ä¸­...</div>
                        </div>
                    </div>
                </div>

                <div class="btn-group">
                    <button class="btn btn-primary" onclick="restartGame()">å†ç©ä¸€æ¬¡</button>
                    <button class="btn btn-primary" onclick="goBack()">è¿”å›</button>
                </div>
            </div>
        </div>

        <div class="bottom-nav">
            <div class="nav-item" onclick="navigateTo('index.html')">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-text">é¦–é¡µ</div>
            </div>
            <div class="nav-item active" onclick="navigateTo('explore.html')">
                <div class="nav-icon">ğŸ”</div>
                <div class="nav-text">æ¢ç´¢</div>
            </div>
            <div class="nav-item" onclick="navigateTo('create.html')">
                <div class="nav-icon">ğŸ¨</div>
                <div class="nav-text">åˆ›ä½œ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('garden.html')">
                <div class="nav-icon">ğŸ’</div>
                <div class="nav-text">å¿ƒçµ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('profile.html')">
                <div class="nav-icon">ğŸ‘¤</div>
                <div class="nav-text">æˆ‘çš„</div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000/api';

        // æ¸¸æˆçŠ¶æ€
        let gameState = {
            gameType: '',
            difficulty: 1,
            questions: [],
            currentIndex: 0,
            score: 0,
            correctCount: 0,
            selectedAnswer: null,
            startTime: null,
            answers: []
        };

        let timer = null;
        let timeLeft = 30;

        // å¯¼èˆª
        function goBack() {
            window.location.href = 'explore.html';
        }

        function navigateTo(page) {
            window.location.href = page;
        }

        // é€‰æ‹©æ¸¸æˆç±»å‹
        function selectGameType(type) {
            gameState.gameType = type;

            document.querySelectorAll('.type-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.target.closest('.type-card').classList.add('selected');

            updateStartButton();
        }

        // é€‰æ‹©éš¾åº¦
        function selectDifficulty(level) {
            gameState.difficulty = level;

            document.querySelectorAll('.difficulty-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            event.target.classList.add('selected');

            updateStartButton();
        }

        // æ›´æ–°å¼€å§‹æŒ‰é’®çŠ¶æ€
        function updateStartButton() {
            const btn = document.getElementById('start-btn');
            btn.disabled = !gameState.gameType;
        }

        // å¼€å§‹æ¸¸æˆ
        async function startGame() {
            try {
                const token = localStorage.getItem('token');
                if (!token) {
                    alert('è¯·å…ˆç™»å½•ï¼');
                    window.location.href = 'login.html';
                    return;
                }

                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                document.getElementById('start-btn').textContent = 'åŠ è½½ä¸­...';
                document.getElementById('start-btn').disabled = true;

                // è·å–é¢˜ç›®
                const response = await fetch(`${API_BASE}/games/questions?gameType=${gameState.gameType}&difficulty=${gameState.difficulty}&limit=10`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                const result = await response.json();

                if (!response.ok || !result.success) {
                    throw new Error(result.message || 'è·å–é¢˜ç›®å¤±è´¥');
                }

                gameState.questions = result.data;
                gameState.currentIndex = 0;
                gameState.score = 0;
                gameState.correctCount = 0;
                gameState.startTime = Date.now();
                gameState.answers = [];

                // éšè—è®¾ç½®ï¼Œæ˜¾ç¤ºé¢˜ç›®
                document.getElementById('game-setup').style.display = 'none';
                document.getElementById('question-area').classList.add('active');

                // æ˜¾ç¤ºç¬¬ä¸€é¢˜
                showQuestion();

            } catch (error) {
                console.error('å¼€å§‹æ¸¸æˆå¤±è´¥:', error);
                alert('å¼€å§‹æ¸¸æˆå¤±è´¥ï¼š' + error.message);
                document.getElementById('start-btn').textContent = 'å¼€å§‹æ¸¸æˆ';
                document.getElementById('start-btn').disabled = false;
            }
        }

        // æ˜¾ç¤ºé¢˜ç›®
        function showQuestion() {
            const question = gameState.questions[gameState.currentIndex];
            if (!question) {
                finishGame();
                return;
            }

            // æ›´æ–°è¿›åº¦
            document.getElementById('current-q').textContent = gameState.currentIndex + 1;
            document.getElementById('total-q').textContent = gameState.questions.length;

            // æ˜¾ç¤ºé¢˜ç›®å›¾ç‰‡ï¼ˆä½¿ç”¨emojiä½œä¸ºå ä½ç¬¦ï¼‰
            const imageIcons = {
                'image_recognition': 'ğŸ–¼ï¸',
                'emotion_recognition': 'ğŸ˜Š'
            };
            document.getElementById('question-image').textContent = imageIcons[question.gameType] || 'ğŸ¯';

            // æ˜¾ç¤ºé¢˜ç›®æ–‡æœ¬
            document.getElementById('question-text').textContent = question.questionData.question;

            // æ˜¾ç¤ºé€‰é¡¹
            const optionsGrid = document.getElementById('options-grid');
            optionsGrid.innerHTML = '';

            question.questionData.options.forEach((option, index) => {
                const btn = document.createElement('button');
                btn.className = 'option-btn';
                btn.textContent = option;
                btn.onclick = () => selectOption(index);
                optionsGrid.appendChild(btn);
            });

            // é‡ç½®çŠ¶æ€
            gameState.selectedAnswer = null;
            document.getElementById('submit-btn').disabled = true;
            document.getElementById('submit-btn').style.display = 'block';
            document.getElementById('next-btn').style.display = 'none';
            document.getElementById('feedback').classList.remove('show');

            // å¼€å§‹è®¡æ—¶
            startTimer();
        }

        // å¼€å§‹è®¡æ—¶
        function startTimer() {
            timeLeft = 30;
            document.getElementById('time').textContent = timeLeft;

            if (timer) clearInterval(timer);

            timer = setInterval(() => {
                timeLeft--;
                document.getElementById('time').textContent = timeLeft;

                if (timeLeft <= 0) {
                    clearInterval(timer);
                    // æ—¶é—´åˆ°ï¼Œè‡ªåŠ¨æäº¤
                    submitAnswer();
                }
            }, 1000);
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(index) {
            gameState.selectedAnswer = index;

            // æ›´æ–°é€‰é¡¹æ ·å¼
            document.querySelectorAll('.option-btn').forEach((btn, i) => {
                btn.classList.remove('selected');
                if (i === index) {
                    btn.classList.add('selected');
                }
            });

            document.getElementById('submit-btn').disabled = false;
        }

        // æäº¤ç­”æ¡ˆ
        async function submitAnswer() {
            if (timer) clearInterval(timer);

            const question = gameState.questions[gameState.currentIndex];
            const questionId = question.id;
            const answer = gameState.selectedAnswer !== null ? gameState.selectedAnswer : -1;

            try {
                const token = localStorage.getItem('token');
                const response = await fetch(`${API_BASE}/games/verify-answer`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        questionId,
                        answer
                    })
                });

                const result = await response.json();

                if (response.ok && result.success) {
                    const { correct, explanation } = result.data;

                    // è®°å½•ç­”æ¡ˆ
                    gameState.answers.push({
                        questionId,
                        answer,
                        correct
                    });

                    if (correct) {
                        gameState.correctCount++;
                        gameState.score += 10;
                        updateScore();
                    }

                    // æ˜¾ç¤ºåé¦ˆ
                    showFeedback(correct, explanation);

                } else {
                    throw new Error(result.message || 'éªŒè¯ç­”æ¡ˆå¤±è´¥');
                }

            } catch (error) {
                console.error('æäº¤ç­”æ¡ˆå¤±è´¥:', error);
                alert('æäº¤ç­”æ¡ˆå¤±è´¥ï¼š' + error.message);
            }

            // ç¦ç”¨é€‰é¡¹æŒ‰é’®
            document.querySelectorAll('.option-btn').forEach(btn => {
                btn.disabled = true;
            });

            document.getElementById('submit-btn').style.display = 'none';
            document.getElementById('next-btn').style.display = 'block';
        }

        // æ˜¾ç¤ºåé¦ˆ
        function showFeedback(correct, explanation) {
            const feedback = document.getElementById('feedback');
            const icon = document.getElementById('feedback-icon');
            const text = document.getElementById('feedback-text');

            if (correct) {
                icon.textContent = 'âœ…';
                text.textContent = 'å›ç­”æ­£ç¡®ï¼' + (explanation || '');

                // æ ‡è®°æ­£ç¡®é€‰é¡¹
                document.querySelectorAll('.option-btn')[gameState.selectedAnswer].classList.add('correct');
            } else {
                icon.textContent = 'âŒ';
                text.textContent = 'å›ç­”é”™è¯¯ã€‚' + (explanation || '');

                // æ ‡è®°é”™è¯¯é€‰é¡¹
                if (gameState.selectedAnswer !== null) {
                    document.querySelectorAll('.option-btn')[gameState.selectedAnswer].classList.add('wrong');
                }
            }

            feedback.classList.add('show');
        }

        // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
        function updateScore() {
            document.getElementById('score').textContent = gameState.score;
        }

        // ä¸‹ä¸€é¢˜
        function nextQuestion() {
            gameState.currentIndex++;

            if (gameState.currentIndex < gameState.questions.length) {
                showQuestion();
            } else {
                finishGame();
            }
        }

        // å®Œæˆæ¸¸æˆ
        async function finishGame() {
            if (timer) clearInterval(timer);

            const duration = Math.floor((Date.now() - gameState.startTime) / 1000);
            const accuracy = Math.round((gameState.correctCount / gameState.questions.length) * 100);

            // ä¿å­˜æˆç»©åˆ°åç«¯
            try {
                const token = localStorage.getItem('token');
                await fetch(`${API_BASE}/games/score`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({
                        gameType: gameState.gameType,
                        score: gameState.score,
                        level: gameState.difficulty,
                        accuracy,
                        duration
                    })
                });
            } catch (error) {
                console.error('ä¿å­˜æˆç»©å¤±è´¥:', error);
            }

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('question-area').classList.remove('active');
            document.getElementById('result-area').classList.add('show');

            document.getElementById('final-score').textContent = gameState.score;
            document.getElementById('correct-count').textContent = gameState.correctCount;
            document.getElementById('accuracy').textContent = accuracy;
            document.getElementById('duration').textContent = duration;

            // åŠ è½½æ’è¡Œæ¦œ
            loadLeaderboard();
        }

        // åŠ è½½æ’è¡Œæ¦œ
        async function loadLeaderboard() {
            try {
                const response = await fetch(`${API_BASE}/games/leaderboard?gameType=${gameState.gameType}&limit=10`);
                const result = await response.json();

                if (response.ok && result.success) {
                    const leaderboard = result.data;
                    const listEl = document.getElementById('leaderboard-list');

                    if (leaderboard.length === 0) {
                        listEl.innerHTML = '<div style="text-align:center;color:#999;padding:20px;">æš‚æ— æ’è¡Œæ¦œæ•°æ®</div>';
                        return;
                    }

                    listEl.innerHTML = leaderboard.map((item, index) => `
                        <div class="leaderboard-item">
                            <div class="rank-number">${index + 1}</div>
                            <div class="player-info">
                                <div class="player-name">${item.nickname || 'ç©å®¶' + (index + 1)}</div>
                            </div>
                            <div class="player-score">${item.score}åˆ†</div>
                        </div>
                    `).join('');
                } else {
                    throw new Error(result.message || 'åŠ è½½æ’è¡Œæ¦œå¤±è´¥');
                }
            } catch (error) {
                console.error('åŠ è½½æ’è¡Œæ¦œå¤±è´¥:', error);
                document.getElementById('leaderboard-list').innerHTML = '<div style="text-align:center;color:#999;padding:20px;">åŠ è½½å¤±è´¥</div>';
            }
        }

        // é‡æ–°å¼€å§‹
        function restartGame() {
            document.getElementById('result-area').classList.remove('show');
            document.getElementById('game-setup').style.display = 'block';

            // é‡ç½®çŠ¶æ€
            gameState = {
                gameType: '',
                difficulty: 1,
                questions: [],
                currentIndex: 0,
                score: 0,
                correctCount: 0,
                selectedAnswer: null,
                startTime: null,
                answers: []
            };

            updateScore();

            // é‡ç½®é€‰æ‹©
            document.querySelectorAll('.type-card').forEach(card => {
                card.classList.remove('selected');
            });

            document.querySelectorAll('.difficulty-btn').forEach((btn, index) => {
                btn.classList.remove('selected');
                if (index === 0) btn.classList.add('selected');
            });

            updateStartButton();
        }

        // åˆå§‹åŒ–
        window.addEventListener('load', () => {
            updateScore();
        });
    </script>
</body>
</html>
