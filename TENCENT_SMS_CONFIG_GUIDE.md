# 腾讯云短信服务配置指南

## 一、前置准备

### 1. 完成企业认证 ✅
你已经完成了这一步

### 2. 配置签名管理

#### 步骤 1: 进入签名管理
1. 登录 [腾讯云控制台](https://console.cloud.tencent.com/)
2. 搜索"短信"或进入 [短信控制台](https://console.cloud.tencent.com/smsv2)
3. 左侧菜单: **国内短信** → **签名管理**

#### 步骤 2: 创建签名
点击"创建签名"按钮,填写以下信息:

| 配置项 | 建议填写 | 说明 |
|--------|---------|------|
| **签名类型** | 网站 | 如果有网站备案;或选择App(需上传应用商店截图) |
| **签名内容** | 启蒙之光 | 短信开头显示的名称,如【启蒙之光】 |
| **签名用途** | 自用 | 给自己的产品使用 |

#### 步骤 3: 上传证明材料

**网站类型**:
- 网站备案截图 或
- 营业执照 + 网站说明文档

**App类型**:
- 应用商店后台截图(应用宝/App Store) 或
- 软件著作权证书 或
- 营业执照 + 应用说明

**授权说明示例**:
```
本短信签名用于【启蒙之光】儿童教育平台，提供以下服务：
1. 用户注册/登录验证码
2. 密码重置验证码
3. 重要通知提醒

本签名为公司自有产品使用。
```

#### 步骤 4: 等待审核
- ⏰ 审核时间: 2小时内(工作日)
- 📧 审核结果会通过短信/邮件通知
- ✅ 通过后获得**签名ID**

---

## 二、配置模板管理

签名审核通过后,需要创建短信模板:

### 步骤 1: 进入模板管理
左侧菜单: **国内短信** → **正文模板管理**

### 步骤 2: 创建模板
点击"创建正文模板",填写:

#### 验证码模板示例

| 配置项 | 内容 |
|--------|------|
| **模板名称** | 用户注册验证码 |
| **短信类型** | 验证码 |
| **短信内容** | 您的验证码是{1},有效期{2}分钟,请勿泄露给他人。 |

**变量说明**:
- `{1}` = 验证码(如: 123456)
- `{2}` = 有效期(如: 5)

#### 通知类模板示例

| 配置项 | 内容 |
|--------|------|
| **模板名称** | 登录通知 |
| **短信类型** | 通知 |
| **短信内容** | 您的账号于{1}在{2}登录,如非本人操作,请及时修改密码。 |

### 步骤 3: 等待审核
- 审核通过后获得**模板ID**
- 记录下所有模板ID,后续配置需要用到

---

## 三、获取 API 密钥

### 步骤 1: 创建密钥
1. 进入 [API密钥管理](https://console.cloud.tencent.com/cam/capi)
2. 点击"新建密钥"
3. 记录 **SecretId** 和 **SecretKey** (请妥善保管)

### 步骤 2: 获取应用信息
1. 返回 [短信控制台](https://console.cloud.tencent.com/smsv2)
2. 进入"应用管理"
3. 记录 **SDK AppID**

---

## 四、配置到项目

### 1. 安装依赖包
```bash
cd server
npm install tencentcloud-sdk-nodejs
```

### 2. 在 `.env` 文件中添加配置

```env
# --------------------------------------------
# 腾讯云短信配置
# --------------------------------------------
# 腾讯云 SecretId (从 API密钥管理获取)
TENCENT_SECRET_ID=your_secret_id_here

# 腾讯云 SecretKey (从 API密钥管理获取)
TENCENT_SECRET_KEY=your_secret_key_here

# 短信应用 SDK AppID (从短信控制台应用管理获取)
TENCENT_SMS_APP_ID=1400xxxxxx

# 短信签名内容 (审核通过的签名,不含【】)
TENCENT_SMS_SIGN=启蒙之光

# 验证码模板ID (从模板管理获取)
TENCENT_SMS_VERIFY_TEMPLATE_ID=1234567

# 通知模板ID (可选)
TENCENT_SMS_NOTIFY_TEMPLATE_ID=7654321

# 短信有效期(分钟)
SMS_CODE_EXPIRE=5
```

### 3. 配置示例
```env
# 示例配置(实际使用时替换为真实值)
TENCENT_SECRET_ID=AKIDxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TENCENT_SECRET_KEY=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TENCENT_SMS_APP_ID=1400123456
TENCENT_SMS_SIGN=启蒙之光
TENCENT_SMS_VERIFY_TEMPLATE_ID=1234567
SMS_CODE_EXPIRE=5
```

---

## 五、验证码发送流程

项目集成后的使用流程:

1. **用户请求验证码**
   - 前端: 用户输入手机号,点击"获取验证码"
   - 后端: 生成6位随机验证码

2. **调用腾讯云API发送短信**
   ```
   【启蒙之光】您的验证码是123456,有效期5分钟,请勿泄露给他人。
   ```

3. **验证码存储**
   - Redis: 存储验证码,设置5分钟过期
   - 或数据库: 记录发送时间和验证次数

4. **用户输入验证**
   - 验证码正确性
   - 验证是否过期
   - 防止重复使用

---

## 六、常见问题

### Q1: 签名审核被驳回怎么办?
**A**: 常见原因:
- 证明材料不清晰 → 重新上传高清截图
- 签名与材料不符 → 确保签名与备案/营业执照名称一致
- 缺少授权说明 → 补充详细的使用场景说明

### Q2: 可以使用个人认证吗?
**A**: 可以,但:
- 个人认证只能申请**验证码类**和**系统通知类**短信
- 不能发送**营销类**短信
- 需要提供个人身份证和应用证明材料

### Q3: 短信费用是多少?
**A**:
- 验证码/通知短信: 约 0.045元/条
- 营销短信: 约 0.055元/条
- 需要预充值,建议先充值100元测试

### Q4: 一天可以发送多少条?
**A**:
- 默认单个手机号: 10条/天
- 可在控制台申请提额
- 建议设置频率限制(60秒/次)

### Q5: 支持国际短信吗?
**A**: 支持,但需要:
- 单独申请国际短信服务
- 费用更高(0.5-1元/条)
- 需要国际短信签名和模板

---

## 七、测试建议

### 1. 先用测试模板
腾讯云提供测试模板,可以不审核直接发送(有数量限制)

### 2. 白名单测试
在正式上线前,先添加测试手机号到白名单

### 3. 监控与告警
- 开启短信发送监控
- 设置余额告警(余额不足及时充值)
- 记录发送日志,便于排查问题

---

## 八、项目集成代码示例

如果你需要将短信功能集成到当前项目,需要:

1. 创建短信服务模块 (`server/src/services/smsService.ts`)
2. 实现验证码发送/验证逻辑
3. 添加发送频率限制
4. 更新用户认证接口

是否需要我帮你生成完整的短信服务代码?

---

## 相关链接

- [腾讯云短信控制台](https://console.cloud.tencent.com/smsv2)
- [短信签名审核标准](https://cloud.tencent.com/document/product/382/39022)
- [短信模板审核标准](https://cloud.tencent.com/document/product/382/39023)
- [API 文档](https://cloud.tencent.com/document/product/382/52077)
- [SDK 文档](https://cloud.tencent.com/document/product/382/43193)
