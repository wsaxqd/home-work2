## ğŸ” æ•…éšœæ’æŸ¥

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æ•°æ®åº“è¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: connect ECONNREFUSED 127.0.0.1:5432
```

**å¯èƒ½åŸå› ï¼š**
- PostgreSQL æœåŠ¡æœªå¯åŠ¨
- ç«¯å£é…ç½®é”™è¯¯
- é˜²ç«å¢™é˜»æ­¢è¿æ¥

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ PostgreSQL æœåŠ¡çŠ¶æ€
sudo systemctl status postgresql

# å¯åŠ¨æœåŠ¡
sudo systemctl start postgresql

# æ£€æŸ¥ç«¯å£
netstat -an | grep 5432

# æµ‹è¯•è¿æ¥
psql -h localhost -U qmzg_admin -d qmzg_production
```

---

#### 2. æ•°æ®åº“è¿ç§»å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: relation "parents" already exists
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥å·²è¿è¡Œçš„è¿ç§»
cd server
npm run migrate:status

# å¦‚æœéœ€è¦é‡ç½®æ•°æ®åº“ï¼ˆâš ï¸ ä¼šåˆ é™¤æ‰€æœ‰æ•°æ®ï¼‰
psql -h localhost -U qmzg_admin -d qmzg_production -c "DROP SCHEMA public CASCADE; CREATE SCHEMA public;"

# é‡æ–°è¿è¡Œè¿ç§»
npm run migrate
```

---

#### 3. JWT Token æ— æ•ˆ

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: invalid signature
```

**å¯èƒ½åŸå› ï¼š**
- JWT_SECRET é…ç½®ä¸ä¸€è‡´
- Token å·²è¿‡æœŸ

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥ .env æ–‡ä»¶ä¸­çš„ JWT_SECRET
grep JWT_SECRET .env.production

# ç¡®ä¿å‰åç«¯ä½¿ç”¨ç›¸åŒçš„å¯†é’¥
# æ¸…é™¤å®¢æˆ·ç«¯å­˜å‚¨çš„æ—§ token
```

---

#### 4. ç«¯å£è¢«å ç”¨

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: listen EADDRINUSE: address already in use :::3000
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :3000
# æˆ–
netstat -ano | findstr :3000

# ç»ˆæ­¢è¿›ç¨‹
kill -9 <PID>

# æˆ–ä¿®æ”¹ .env ä¸­çš„ PORT é…ç½®
```

---

#### 5. å‰ç«¯æ„å»ºå¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: TypeScript compilation failed
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
cd app

# æ¸…ç†ç¼“å­˜
rm -rf node_modules package-lock.json
npm install

# æ£€æŸ¥ TypeScript é”™è¯¯
npm run type-check

# é‡æ–°æ„å»º
npm run build
```

---

#### 6. Nginx 502 Bad Gateway

**å¯èƒ½åŸå› ï¼š**
- åç«¯æœåŠ¡æœªå¯åŠ¨
- åç«¯æœåŠ¡å´©æºƒ
- Nginx é…ç½®é”™è¯¯

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥åç«¯æœåŠ¡çŠ¶æ€
pm2 status
# æˆ–
systemctl status qmzg

# æŸ¥çœ‹åç«¯æ—¥å¿—
pm2 logs qmzg-server
# æˆ–
tail -f /path/to/qmzg/logs/server.log

# æ£€æŸ¥ Nginx é…ç½®
sudo nginx -t

# é‡å¯æœåŠ¡
pm2 restart qmzg-server
sudo systemctl reload nginx
```

---

#### 7. é‚®ä»¶å‘é€å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
Error: Invalid login: 535 Authentication failed
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# æ£€æŸ¥é‚®ä»¶é…ç½®
grep EMAIL_ .env.production

# Gmail ç”¨æˆ·éœ€è¦ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç 
# 1. è®¿é—® https://myaccount.google.com/security
# 2. å¯ç”¨ä¸¤æ­¥éªŒè¯
# 3. ç”Ÿæˆåº”ç”¨ä¸“ç”¨å¯†ç 
# 4. ä½¿ç”¨åº”ç”¨ä¸“ç”¨å¯†ç æ›¿æ¢ EMAIL_PASSWORD
```

---

#### 8. å†…å­˜ä¸è¶³

**é”™è¯¯ä¿¡æ¯ï¼š**
```
FATAL ERROR: Ineffective mark-compacts near heap limit
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# å¢åŠ  Node.js å†…å­˜é™åˆ¶
export NODE_OPTIONS="--max-old-space-size=4096"

# æˆ–åœ¨ PM2 é…ç½®ä¸­è®¾ç½®
pm2 start dist/index.js --name qmzg-server --node-args="--max-old-space-size=4096"
```

---

### æ—¥å¿—æŸ¥çœ‹

#### åç«¯æ—¥å¿—
```bash
# PM2 æ—¥å¿—
pm2 logs qmzg-server

# æ–‡ä»¶æ—¥å¿—
tail -f logs/server.log

# æŸ¥çœ‹æœ€è¿‘ 100 è¡Œ
tail -n 100 logs/server.log
```

#### Nginx æ—¥å¿—
```bash
# è®¿é—®æ—¥å¿—
tail -f /var/log/nginx/access.log

# é”™è¯¯æ—¥å¿—
tail -f /var/log/nginx/error.log
```

#### PostgreSQL æ—¥å¿—
```bash
# Ubuntu/Debian
tail -f /var/log/postgresql/postgresql-14-main.log

# CentOS/RHEL
tail -f /var/lib/pgsql/14/data/log/postgresql-*.log
```

---

### æ€§èƒ½è°ƒä¼˜

#### æ•°æ®åº“ä¼˜åŒ–
```sql
-- åˆ›å»ºç´¢å¼•
CREATE INDEX idx_usage_logs_user_id ON usage_logs(user_id);
CREATE INDEX idx_usage_logs_created_at ON usage_logs(created_at);
CREATE INDEX idx_children_parent_id ON children(parent_id);

-- åˆ†æè¡¨
ANALYZE usage_logs;
ANALYZE children;
ANALYZE parents;
```

#### Node.js ä¼˜åŒ–
```bash
# å¯ç”¨é›†ç¾¤æ¨¡å¼
pm2 start dist/index.js -i max --name qmzg-server
```

---
