# 🔧 AI智能助手配置指南

> 问题: AI智能助手显示"网络连接失败"

---

## ❗ 问题原因

AI智能助手需要连接到AI服务提供商(DeepSeek、智谱AI或Dify)才能工作。

当前配置中,AI服务的API密钥还是默认占位符,需要替换为真实的API密钥。

---

## 🎯 解决方案

### 方案1: 使用DeepSeek AI (推荐,性价比最高)

**特点:**
- ✅ 国内可访问
- ✅ 价格便宜 (约¥1/百万tokens)
- ✅ 响应速度快
- ✅ 中文支持好

**配置步骤:**

1. **注册DeepSeek账号**
   - 访问: https://platform.deepseek.com/
   - 点击"注册/登录"
   - 使用手机号或邮箱注册

2. **获取API密钥**
   - 登录后进入控制台
   - 点击"API Keys"
   - 点击"创建新的API Key"
   - 复制生成的密钥 (sk-xxxxxxxxxxxxxxxx)

3. **配置到项目**
   - 打开文件: `server\.env`
   - 找到这一行:
     ```
     DEEPSEEK_API_KEY=your-deepseek-api-key-here
     ```
   - 替换为:
     ```
     DEEPSEEK_API_KEY=sk-你的真实密钥
     ```
   - 保存文件

4. **重启服务器**
   - 停止当前后端服务器 (Ctrl+C)
   - 重新运行: `cd server && npm run dev`

5. **测试**
   - 在APP中打开AI智能助手
   - 发送一条消息测试

---

### 方案2: 使用智谱AI GLM

**特点:**
- ✅ 国内服务,访问稳定
- ✅ 官方支持好
- ✅ 中文能力强
- ⚠️ 价格略高

**配置步骤:**

1. **注册智谱AI账号**
   - 访问: https://open.bigmodel.cn/
   - 注册账号并登录

2. **获取API密钥**
   - 进入控制台
   - 找到"API Keys"
   - 创建新密钥并复制

3. **配置到项目**
   - 打开 `server\.env`
   - 修改以下配置:
     ```
     AI_PROVIDER=zhipu
     ZHIPU_API_KEY=你的智谱AI密钥
     ```

4. **重启服务器**

---

### 方案3: 使用Dify (当前已配置)

**特点:**
- ✅ 已经配置好密钥
- ✅ 可以直接使用
- ⚠️ 可能有使用限制

**配置步骤:**

1. **切换到Dify**
   - 打开 `server\.env`
   - 修改这一行:
     ```
     AI_PROVIDER=dify
     ```
   - 保存文件

2. **重启服务器**
   - 停止后端服务器
   - 重新启动: `cd server && npm run dev`

3. **测试**
   - 在APP中测试AI对话

**注意:** Dify配置已经存在,但可能有API调用限制或配额。

---

## 🚀 快速开始 (推荐使用Dify)

如果您想立即测试AI功能,最快的方法是:

1. **打开配置文件**
   ```
   D:\2025年AI\AI造物计划\项目库\qmzg - V1.0\server\.env
   ```

2. **修改第26行**
   ```
   AI_PROVIDER=dify
   ```
   (将 `deepseek` 改为 `dify`)

3. **重启后端服务器**
   - 在终端按 `Ctrl+C` 停止
   - 运行: `cd server && npm run dev`

4. **测试AI对话**
   - 刷新APP页面
   - 打开AI智能助手
   - 发送消息测试

---

## 📊 各服务对比

| 服务商 | 价格 | 速度 | 中文能力 | 配置难度 | 推荐度 |
|--------|------|------|----------|----------|--------|
| DeepSeek | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 智谱AI | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ |
| Dify | ⭐⭐⭐ | ⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐ |

---

## 🔍 验证配置

### 检查配置是否生效:

1. **查看服务器日志**
   - 重启后端后查看终端输出
   - 应该看到"AI服务初始化成功"

2. **测试API调用**
   ```bash
   curl -X POST http://localhost:3000/api/ai/chat \
     -H "Content-Type: application/json" \
     -d '{"message":"你好"}'
   ```

3. **前端测试**
   - 打开APP
   - 进入AI智能助手
   - 发送"你好",看是否有回复

---

## ❌ 常见错误

### 错误1: "网络连接失败"
**原因:** API密钥未配置或无效
**解决:** 检查 `.env` 文件中的密钥配置

### 错误2: "API调用超时"
**原因:** 网络问题或API服务不可用
**解决:**
- 检查网络连接
- 尝试切换到Dify
- 检查API服务状态

### 错误3: "余额不足"
**原因:** API账户余额用完
**解决:**
- 充值API账户
- 切换到其他服务商

---

## 💡 推荐配置

### 开发测试阶段:
```env
AI_PROVIDER=dify
```
使用已配置的Dify,立即可用

### 生产环境:
```env
AI_PROVIDER=deepseek
DEEPSEEK_API_KEY=sk-你的密钥
```
使用DeepSeek,成本更低,性能更好

---

## 📞 获取帮助

如果配置后仍然无法使用,请提供:

1. `.env` 文件中的 `AI_PROVIDER` 配置
2. 服务器启动日志
3. 浏览器控制台错误信息
4. API调用的网络请求详情

---

## 🎯 下一步

配置完成后,您可以体验:

1. **AI智能对话** - 和启启聊天
2. **作业助手** - 拍照搜题
3. **AI小百科** - 知识问答
4. **创作工具** - AI辅助创作

祝您配置顺利! 🚀
