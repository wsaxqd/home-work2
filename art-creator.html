<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIå°ç”»å®¶ - å¯è’™ä¹‹å…‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial Rounded MT Bold', 'Arial', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #e8f4fd 0%, #fde8f7 100%);
            color: #333;
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        .container {
            max-width: 480px;
            margin: 0 auto;
            padding: 0;
            position: relative;
            min-height: 100vh;
            background: white;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background: linear-gradient(135deg, #2196f3 0%, #e91e63 100%);
            color: white;
            border-radius: 0 0 20px 20px;
        }
        
        .back-button {
            font-size: 24px;
            cursor: pointer;
        }
        
        .page-title {
            font-size: 20px;
            text-align: center;
            flex: 1;
        }
        
        .main-content {
            padding: 20px;
            overflow-y: auto;
            max-height: calc(100vh - 140px);
        }
        
        .section-title {
            font-size: 18px;
            margin: 20px 0 15px;
            color: #2196f3;
            display: flex;
            align-items: center;
        }
        
        .section-title::before {
            content: "";
            display: inline-block;
            width: 5px;
            height: 20px;
            background: #2196f3;
            margin-right: 10px;
            border-radius: 3px;
        }
        
        /* ç»˜ç”»æ¨¡å¼é€‰æ‹©æ ·å¼ */
        .mode-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            border: 2px solid #e8f4fd;
        }
        
        .mode-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .mode-card {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }
        
        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .mode-card.selected {
            border-color: #2196f3;
            background: #e8f4fd;
        }
        
        .mode-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: #2196f3;
        }
        
        .mode-name {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .mode-desc {
            font-size: 12px;
            color: #666;
        }
        
        /* ç»˜ç”»å·¥å…·æ ·å¼ */
        .tools-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: none;
        }
        
        .toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .tool-btn {
            width: 50px;
            height: 50px;
            background: #f5f5f5;
            border: none;
            border-radius: 10px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background 0.3s, transform 0.2s;
        }
        
        .tool-btn:hover {
            background: #e0e0e0;
            transform: scale(1.1);
        }
        
        .tool-btn.active {
            background: #2196f3;
            color: white;
        }
        
        .color-palette {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .color-btn {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: transform 0.2s;
        }
        
        .color-btn:hover {
            transform: scale(1.2);
        }
        
        .color-btn.active {
            border: 3px solid #333;
            transform: scale(1.2);
        }
        
        .brush-size {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .size-label {
            font-size: 14px;
            color: #333;
        }
        
        .size-slider {
            flex: 1;
            -webkit-appearance: none;
            height: 6px;
            background: #e0e0e0;
            border-radius: 3px;
            outline: none;
        }
        
        .size-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #2196f3;
            border-radius: 50%;
            cursor: pointer;
        }
        
        /* ç”»å¸ƒåŒºåŸŸæ ·å¼ */
        .canvas-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: none;
        }
        
        .canvas-container {
            background: #f5f5f5;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .drawing-canvas {
            width: 100%;
            height: 300px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
            margin-bottom: 15px;
            cursor: crosshair;
            touch-action: none;
        }
        
        .canvas-instructions {
            font-size: 14px;
            color: #666;
            margin-bottom: 10px;
        }
        
        .canvas-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
        }
        
        .canvas-btn {
            padding: 8px 15px;
            background: #f5f5f5;
            border: none;
            border-radius: 20px;
            font-size: 14px;
            cursor: pointer;
            transition: background 0.3s;
        }
        
        .canvas-btn:hover {
            background: #e0e0e0;
        }
        
        .canvas-btn.primary {
            background: #2196f3;
            color: white;
        }
        
        /* AIå¢å¼ºæ ·å¼ */
        .ai-enhance-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: none;
        }
        
        .enhance-options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .enhance-card {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s, box-shadow 0.3s;
            border: 2px solid transparent;
        }
        
        .enhance-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .enhance-card.selected {
            border-color: #2196f3;
            background: #e8f4fd;
        }
        
        .enhance-icon {
            font-size: 30px;
            margin-bottom: 10px;
            color: #2196f3;
        }
        
        .enhance-name {
            font-size: 14px;
            margin-bottom: 5px;
        }
        
        .enhance-desc {
            font-size: 12px;
            color: #666;
        }
        
        .enhance-preview {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .preview-title {
            font-size: 16px;
            margin-bottom: 10px;
            color: #2196f3;
        }
        
        .preview-images {
            display: flex;
            gap: 15px;
            justify-content: center;
        }
        
        .preview-image {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            color: #666;
        }
        
        .preview-label {
            font-size: 12px;
            margin-top: 5px;
            color: #666;
        }
        
        .loading-animation {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 200px;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid #e8f4fd;
            border-top: 4px solid #2196f3;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        .loading-text {
            font-size: 14px;
            color: #666;
        }
        
        /* ä½œå“å±•ç¤ºæ ·å¼ */
        .artwork-section {
            background: white;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.05);
            display: none;
        }
        
        .artwork-preview {
            background: #f9f9f9;
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .artwork-title {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2196f3;
            text-align: center;
        }
        
        .artwork-image {
            width: 100%;
            max-width: 300px;
            height: 250px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
            margin: 0 auto 15px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 60px;
            color: #666;
        }
        
        .artwork-details {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .detail-item {
            flex: 1;
            min-width: 100px;
            background: white;
            border-radius: 10px;
            padding: 10px;
            text-align: center;
        }
        
        .detail-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .detail-value {
            font-size: 16px;
            font-weight: bold;
            color: #2196f3;
        }
        
        /* æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .control-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s, background 0.3s;
        }
        
        .btn:disabled {
            background: #e0e0e0;
            color: #999;
            cursor: not-allowed;
        }
        
        .btn-primary {
            background: #2196f3;
            color: white;
        }
        
        .btn-primary:hover:not(:disabled) {
            background: #1976d2;
            transform: scale(1.03);
        }
        
        .btn-secondary {
            background: #f5f5f5;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
            transform: scale(1.03);
        }
        
        /* åº•éƒ¨å¯¼èˆªæ ·å¼ */
        .bottom-nav {
            display: flex;
            justify-content: space-around;
            background: white;
            padding: 15px 0;
            border-radius: 20px 20px 0 0;
            box-shadow: 0 -4px 12px rgba(0,0,0,0.05);
            position: fixed;
            bottom: 0;
            width: 100%;
            max-width: 480px;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
        }
        
        .nav-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #999;
        }
        
        .nav-item.active .nav-icon {
            color: #2196f3;
        }
        
        .nav-text {
            font-size: 12px;
            color: #999;
        }
        
        .nav-item.active .nav-text {
            color: #2196f3;
            font-weight: bold;
        }
        
        /* åŠ¨ç”» */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 480px) {
            .container {
                padding-bottom: 70px;
            }
            
            .mode-grid {
                grid-template-columns: 1fr;
            }
            
            .enhance-options {
                grid-template-columns: 1fr;
            }
            
            .control-buttons {
                flex-direction: column;
                gap: 10px;
            }
            
            .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="back-button" onclick="goBack()">â†</div>
            <div class="page-title">AIå°ç”»å®¶</div>
            <div style="width: 24px;"></div> <!-- å ä½ä¿æŒå¯¹ç§° -->
        </div>
        
        <div class="main-content">
            <!-- ç»˜ç”»æ¨¡å¼é€‰æ‹© -->
            <div id="mode-section" class="mode-section">
                <div class="section-title">é€‰æ‹©ç»˜ç”»æ¨¡å¼</div>
                <div class="mode-grid">
                    <div class="mode-card" onclick="selectMode(this, 'free')">
                        <div class="mode-icon">ğŸ¨</div>
                        <div class="mode-name">è‡ªç”±ç»˜ç”»</div>
                        <div class="mode-desc">éšå¿ƒæ‰€æ¬²åœ°åˆ›ä½œ</div>
                    </div>
                    <div class="mode-card" onclick="selectMode(this, 'ai')">
                        <div class="mode-icon">ğŸ¤–</div>
                        <div class="mode-name">AIè¾…åŠ©ç»˜ç”»</div>
                        <div class="mode-desc">AIå¸®ä½ å®Œå–„ä½œå“</div>
                    </div>
                    <div class="mode-card" onclick="selectMode(this, 'shape')">
                        <div class="mode-icon">ğŸ”·</div>
                        <div class="mode-name">å½¢çŠ¶ç»˜ç”»</div>
                        <div class="mode-desc">ä½¿ç”¨å‡ ä½•å›¾å½¢åˆ›ä½œ</div>
                    </div>
                    <div class="mode-card" onclick="selectMode(this, 'coloring')">
                        <div class="mode-icon">ğŸ–ï¸</div>
                        <div class="mode-name">å¡«è‰²æ¸¸æˆ</div>
                        <div class="mode-desc">ä¸ºçº¿ç¨¿ä¸Šè‰²</div>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="goBack()">è¿”å›</button>
                    <button class="btn btn-primary" id="mode-next" onclick="startDrawing()" disabled>å¼€å§‹ç»˜ç”»</button>
                </div>
            </div>
            
            <!-- ç»˜ç”»å·¥å…· -->
            <div id="tools-section" class="tools-section">
                <div class="section-title">ç»˜ç”»å·¥å…·</div>
                
                <div class="toolbar">
                    <button class="tool-btn active" id="brush-btn" onclick="selectTool('brush')">âœï¸</button>
                    <button class="tool-btn" id="eraser-btn" onclick="selectTool('eraser')">ğŸ§½</button>
                    <button class="tool-btn" id="shape-btn" onclick="selectTool('shape')">ğŸ”º</button>
                    <button class="tool-btn" id="fill-btn" onclick="selectTool('fill')">ğŸª£</button>
                </div>
                
                <div class="color-palette">
                    <button class="color-btn active" style="background: #ff0000;" onclick="selectColor(this, '#ff0000')"></button>
                    <button class="color-btn" style="background: #ff9900;" onclick="selectColor(this, '#ff9900')"></button>
                    <button class="color-btn" style="background: #ffff00;" onclick="selectColor(this, '#ffff00')"></button>
                    <button class="color-btn" style="background: #00ff00;" onclick="selectColor(this, '#00ff00')"></button>
                    <button class="color-btn" style="background: #0000ff;" onclick="selectColor(this, '#0000ff')"></button>
                    <button class="color-btn" style="background: #9900ff;" onclick="selectColor(this, '#9900ff')"></button>
                    <button class="color-btn" style="background: #000000;" onclick="selectColor(this, '#000000')"></button>
                    <button class="color-btn" style="background: #ffffff; border: 1px solid #ccc;" onclick="selectColor(this, '#ffffff')"></button>
                </div>
                
                <div class="brush-size">
                    <span class="size-label">ç”»ç¬”å¤§å°:</span>
                    <input type="range" min="1" max="20" value="5" class="size-slider" id="brush-size" oninput="updateBrushSize()">
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="backToMode()">è¿”å›</button>
                    <button class="btn btn-primary" onclick="goToCanvas()">å¼€å§‹ç»˜ç”»</button>
                </div>
            </div>
            
            <!-- ç”»å¸ƒåŒºåŸŸ -->
            <div id="canvas-section" class="canvas-section">
                <div class="section-title">åˆ›ä½œä½ çš„ç”»ä½œ</div>
                <div class="canvas-container">
                    <div class="canvas-instructions" id="canvas-instructions">åœ¨ç”»å¸ƒä¸Šè‡ªç”±ç»˜ç”»ï¼Œå‘æŒ¥ä½ çš„åˆ›æ„ï¼</div>
                    <canvas class="drawing-canvas" id="drawing-canvas" width="400" height="300"></canvas>
                    <div class="canvas-controls">
                        <button class="canvas-btn" onclick="clearCanvas()">æ¸…é™¤ç”»å¸ƒ</button>
                        <button class="canvas-btn" onclick="undoAction()">æ’¤é”€</button>
                        <button class="canvas-btn primary" onclick="finishDrawing()">å®Œæˆç»˜ç”»</button>
                    </div>
                </div>
            </div>
            
            <!-- AIå¢å¼ºåŒºåŸŸ -->
            <div id="ai-enhance-section" class="ai-enhance-section">
                <div class="section-title">AIå¢å¼ºä½ çš„ä½œå“</div>
                
                <div class="enhance-options">
                    <div class="enhance-card" onclick="selectEnhance(this, 'complete')">
                        <div class="enhance-icon">âœ¨</div>
                        <div class="enhance-name">å®Œå–„ç»†èŠ‚</div>
                        <div class="enhance-desc">AIå¸®ä½ å®Œå–„ç»˜ç”»ç»†èŠ‚</div>
                    </div>
                    <div class="enhance-card" onclick="selectEnhance(this, 'style')">
                        <div class="enhance-icon">ğŸ­</div>
                        <div class="enhance-name">è‰ºæœ¯é£æ ¼</div>
                        <div class="enhance-desc">åº”ç”¨ä¸åŒè‰ºæœ¯é£æ ¼</div>
                    </div>
                    <div class="enhance-card" onclick="selectEnhance(this, 'color')">
                        <div class="enhance-icon">ğŸŒˆ</div>
                        <div class="enhance-name">æ™ºèƒ½ä¸Šè‰²</div>
                        <div class="enhance-desc">AIè‡ªåŠ¨ä¸ºç”»ä½œä¸Šè‰²</div>
                    </div>
                    <div class="enhance-card" onclick="selectEnhance(this, 'animate')">
                        <div class="enhance-icon">ğŸ¬</div>
                        <div class="enhance-name">åŠ¨æ€æ•ˆæœ</div>
                        <div class="enhance-desc">è®©ç”»ä½œåŠ¨èµ·æ¥</div>
                    </div>
                </div>
                
                <div class="enhance-preview">
                    <div class="preview-title">æ•ˆæœé¢„è§ˆ</div>
                    <div class="preview-images">
                        <div class="preview-image" id="original-preview">åŸä½œ</div>
                        <div class="preview-image" id="enhanced-preview">AIå¢å¼º</div>
                    </div>
                    <div class="preview-images">
                        <div class="preview-label">ä½ çš„åŸä½œ</div>
                        <div class="preview-label">AIå¢å¼ºå</div>
                    </div>
                </div>
                
                <div class="loading-animation" id="enhance-loading" style="display: none;">
                    <div class="spinner"></div>
                    <div class="loading-text">AIæ­£åœ¨å¢å¼ºä½ çš„ä½œå“ï¼Œè¯·ç¨å€™...</div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="backToCanvas()">é‡æ–°ç»˜ç”»</button>
                    <button class="btn btn-primary" id="enhance-btn" onclick="applyEnhancement()">åº”ç”¨å¢å¼º</button>
                </div>
            </div>
            
            <!-- ä½œå“å±•ç¤ºåŒºåŸŸ -->
            <div id="artwork-section" class="artwork-section">
                <div class="section-title">ä½ çš„AIç”»ä½œå®Œæˆå•¦ï¼</div>
                
                <div class="artwork-preview">
                    <div class="artwork-title" id="artwork-title">æˆ‘çš„AIç”»ä½œ</div>
                    <div class="artwork-image" id="artwork-image">ğŸ–¼ï¸</div>
                    
                    <div class="artwork-details">
                        <div class="detail-item">
                            <div class="detail-label">åˆ›ä½œæ¨¡å¼</div>
                            <div class="detail-value" id="artwork-mode">è‡ªç”±ç»˜ç”»</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">AIå¢å¼º</div>
                            <div class="detail-value" id="artwork-enhance">å®Œå–„ç»†èŠ‚</div>
                        </div>
                        <div class="detail-item">
                            <div class="detail-label">åˆ›ä½œæ—¶é—´</div>
                            <div class="detail-value" id="artwork-time">ä»Šå¤©</div>
                        </div>
                    </div>
                </div>
                
                <div class="control-buttons">
                    <button class="btn btn-secondary" onclick="createNewArt()">å†ç”»ä¸€å¹…</button>
                    <button class="btn btn-primary" onclick="saveArtwork()">ä¿å­˜ä½œå“</button>
                </div>
            </div>
        </div>
        
        <div class="bottom-nav">
            <div class="nav-item" onclick="navigateTo('index.html')">
                <div class="nav-icon">ğŸ </div>
                <div class="nav-text">é¦–é¡µ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('explore.html')">
                <div class="nav-icon">ğŸ”</div>
                <div class="nav-text">æ¢ç´¢</div>
            </div>
            <div class="nav-item" onclick="navigateTo('create.html')">
                <div class="nav-icon">ğŸ¨</div>
                <div class="nav-text">åˆ›ä½œ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('garden.html')">
                <div class="nav-icon">ğŸ’</div>
                <div class="nav-text">å¿ƒçµ</div>
            </div>
            <div class="nav-item" onclick="navigateTo('profile.html')">
                <div class="nav-icon">ğŸ‘¤</div>
                <div class="nav-text">æˆ‘çš„</div>
            </div>
        </div>
    </div>

    <script>
        // å½“å‰çŠ¶æ€å’Œæ•°æ®
        let currentMode = '';
        let currentTool = 'brush';
        let currentColor = '#ff0000';
        let brushSize = 5;
        let currentEnhance = '';
        
        // ç”»å¸ƒçŠ¶æ€
        let canvas, ctx;
        let isDrawing = false;
        let lastX = 0;
        let lastY = 0;
        let drawingHistory = [];
        
        // å¯¼èˆªåŠŸèƒ½
        function goBack() {
            window.location.href = 'create.html';
        }
        
        function navigateTo(page) {
            window.location.href = page;
        }
        
        // é€‰æ‹©ç»˜ç”»æ¨¡å¼
        function selectMode(caller, mode) {
            // æ”¯æŒ selectMode(mode) æˆ– selectMode(caller, mode)
            if (typeof mode === 'undefined') {
                mode = caller;
                caller = null;
            }

            // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.mode-card').forEach(card => {
                card.classList.remove('selected');
            });

            // è®¾ç½®æ–°çš„é€‰æ‹©
            var targetEl = null;
            if (caller && caller.nodeType) {
                targetEl = caller;
            } else if (typeof event !== 'undefined' && event.target) {
                targetEl = event.target.closest ? event.target.closest('.mode-card') : event.target;
            }

            if (targetEl) targetEl.classList.add('selected');
            currentMode = mode;

            // å¯ç”¨å¼€å§‹æŒ‰é’®
            document.getElementById('mode-next').disabled = false;
        }
        
        // å¼€å§‹ç»˜ç”»
        function startDrawing() {
            // éšè—æ¨¡å¼é€‰æ‹©ï¼Œæ˜¾ç¤ºå·¥å…·é€‰æ‹©
            document.getElementById('mode-section').style.display = 'none';
            document.getElementById('tools-section').style.display = 'block';
            
            // æ ¹æ®æ¨¡å¼æ›´æ–°ç•Œé¢
            updateToolsForMode();
        }
        
        // æ ¹æ®æ¨¡å¼æ›´æ–°å·¥å…·
        function updateToolsForMode() {
            const instructions = document.getElementById('canvas-instructions');
            
            switch(currentMode) {
                case 'free':
                    instructions.textContent = 'åœ¨ç”»å¸ƒä¸Šè‡ªç”±ç»˜ç”»ï¼Œå‘æŒ¥ä½ çš„åˆ›æ„ï¼';
                    break;
                case 'ai':
                    instructions.textContent = 'ç®€å•ç»˜åˆ¶è½®å»“ï¼ŒAIä¼šå¸®ä½ å®Œå–„ç»†èŠ‚ï¼';
                    break;
                case 'shape':
                    instructions.textContent = 'ä½¿ç”¨å‡ ä½•å½¢çŠ¶åˆ›ä½œä½ çš„ç”»ä½œï¼';
                    break;
                case 'coloring':
                    instructions.textContent = 'ä¸ºçº¿ç¨¿ä¸Šè‰²ï¼Œåˆ›é€ ç¾ä¸½çš„ç”»é¢ï¼';
                    break;
            }
        }
        
        // è¿”å›æ¨¡å¼é€‰æ‹©
        function backToMode() {
            document.getElementById('tools-section').style.display = 'none';
            document.getElementById('mode-section').style.display = 'block';
        }
        
        // é€‰æ‹©å·¥å…·
        function selectTool(tool) {
            currentTool = tool;
            
            // æ›´æ–°å·¥å…·æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.tool-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(`${tool}-btn`).classList.add('active');
        }
        
        // é€‰æ‹©é¢œè‰²
        function selectColor(caller, color) {
            // æ”¯æŒ selectColor(color) æˆ– selectColor(caller, color)
            if (typeof color === 'undefined') {
                color = caller;
                caller = null;
            }

            currentColor = color;

            // æ›´æ–°é¢œè‰²æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.remove('active');
            });

            if (caller && caller.nodeType) {
                caller.classList.add('active');
            } else if (typeof event !== 'undefined' && event.target) {
                event.target.classList.add('active');
            }
        }
        
        // æ›´æ–°ç”»ç¬”å¤§å°
        function updateBrushSize() {
            brushSize = document.getElementById('brush-size').value;
        }
        
        // å‰å¾€ç”»å¸ƒ
        function goToCanvas() {
            document.getElementById('tools-section').style.display = 'none';
            document.getElementById('canvas-section').style.display = 'block';
            
            // åˆå§‹åŒ–ç”»å¸ƒ
            initCanvas();
        }
        
        // åˆå§‹åŒ–ç”»å¸ƒ
        function initCanvas() {
            canvas = document.getElementById('drawing-canvas');
            ctx = canvas.getContext('2d');
            
            // è®¾ç½®ç”»å¸ƒå°ºå¯¸
            const rect = canvas.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
            
            // è®¾ç½®ç”»å¸ƒèƒŒæ™¯
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
            canvas.addEventListener('mousedown', startDrawingEvent);
            canvas.addEventListener('mousemove', drawEvent);
            canvas.addEventListener('mouseup', stopDrawingEvent);
            canvas.addEventListener('mouseout', stopDrawingEvent);
            
            // è§¦æ‘¸è®¾å¤‡æ”¯æŒ
            canvas.addEventListener('touchstart', handleTouchStart);
            canvas.addEventListener('touchmove', handleTouchMove);
            canvas.addEventListener('touchend', handleTouchEnd);
            
            // é‡ç½®å†å²è®°å½•
            drawingHistory = [];
            saveCanvasState();
        }
        
        // å¼€å§‹ç»˜åˆ¶äº‹ä»¶
        function startDrawingEvent(e) {
            isDrawing = true;
            [lastX, lastY] = getEventCoordinates(e);
            
            if (currentTool === 'brush' || currentTool === 'eraser') {
                ctx.beginPath();
                ctx.moveTo(lastX, lastY);
            }
        }
        
        // ç»˜åˆ¶äº‹ä»¶
        function drawEvent(e) {
            if (!isDrawing) return;
            
            const [x, y] = getEventCoordinates(e);
            
            switch(currentTool) {
                case 'brush':
                    ctx.strokeStyle = currentColor;
                    ctx.lineWidth = brushSize;
                    ctx.lineCap = 'round';
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    break;
                    
                case 'eraser':
                    ctx.strokeStyle = '#ffffff';
                    ctx.lineWidth = brushSize * 2;
                    ctx.lineCap = 'round';
                    ctx.lineTo(x, y);
                    ctx.stroke();
                    break;
                    
                case 'shape':
                    // ç»˜åˆ¶å½¢çŠ¶çš„é€»è¾‘
                    break;
                    
                case 'fill':
                    // å¡«å……é€»è¾‘
                    break;
            }
            
            [lastX, lastY] = [x, y];
        }
        
        // åœæ­¢ç»˜åˆ¶äº‹ä»¶
        function stopDrawingEvent() {
            if (isDrawing) {
                isDrawing = false;
                saveCanvasState();
            }
        }
        
        // è·å–äº‹ä»¶åæ ‡
        function getEventCoordinates(e) {
            const rect = canvas.getBoundingClientRect();
            let x, y;
            
            if (e.type.includes('touch')) {
                x = e.touches[0].clientX - rect.left;
                y = e.touches[0].clientY - rect.top;
            } else {
                x = e.clientX - rect.left;
                y = e.clientY - rect.top;
            }
            
            return [x, y];
        }
        
        // è§¦æ‘¸äº‹ä»¶å¤„ç†
        function handleTouchStart(e) {
            e.preventDefault();
            startDrawingEvent(e.touches[0]);
        }
        
        function handleTouchMove(e) {
            e.preventDefault();
            drawEvent(e.touches[0]);
        }
        
        function handleTouchEnd(e) {
            e.preventDefault();
            stopDrawingEvent();
        }
        
        // ä¿å­˜ç”»å¸ƒçŠ¶æ€
        function saveCanvasState() {
            drawingHistory.push(ctx.getImageData(0, 0, canvas.width, canvas.height));
            
            // é™åˆ¶å†å²è®°å½•æ•°é‡
            if (drawingHistory.length > 20) {
                drawingHistory.shift();
            }
        }
        
        // æ¸…é™¤ç”»å¸ƒ
        function clearCanvas() {
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            saveCanvasState();
        }
        
        // æ’¤é”€æ“ä½œ
        function undoAction() {
            if (drawingHistory.length > 1) {
                drawingHistory.pop(); // ç§»é™¤å½“å‰çŠ¶æ€
                const previousState = drawingHistory[drawingHistory.length - 1];
                ctx.putImageData(previousState, 0, 0);
            } else if (drawingHistory.length === 1) {
                clearCanvas();
            }
        }
        
        // å®Œæˆç»˜ç”»
        function finishDrawing() {
            document.getElementById('canvas-section').style.display = 'none';
            
            if (currentMode === 'ai' || currentMode === 'coloring') {
                // æ˜¾ç¤ºAIå¢å¼ºé€‰é¡¹
                document.getElementById('ai-enhance-section').style.display = 'block';
                
                // æ›´æ–°é¢„è§ˆ
                updatePreview();
            } else {
                // ç›´æ¥æ˜¾ç¤ºä½œå“
                showArtwork();
            }
        }
        
        // è¿”å›ç”»å¸ƒ
        function backToCanvas() {
            document.getElementById('ai-enhance-section').style.display = 'none';
            document.getElementById('canvas-section').style.display = 'block';
        }
        
        // æ›´æ–°é¢„è§ˆ
        function updatePreview() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šç”Ÿæˆé¢„è§ˆå›¾åƒ
            // è¿™é‡Œæˆ‘ä»¬åªæ˜¯æ¨¡æ‹Ÿ
            document.getElementById('original-preview').innerHTML = 'åŸä½œ';
            document.getElementById('enhanced-preview').innerHTML = 'AIå¢å¼º';
        }
        
        // é€‰æ‹©å¢å¼ºé€‰é¡¹
        function selectEnhance(caller, enhance) {
            // æ”¯æŒ selectEnhance(enhance) æˆ– selectEnhance(caller, enhance)
            if (typeof enhance === 'undefined') {
                enhance = caller;
                caller = null;
            }

            currentEnhance = enhance;

            // ç§»é™¤ä¹‹å‰çš„é€‰æ‹©
            document.querySelectorAll('.enhance-card').forEach(card => {
                card.classList.remove('selected');
            });

            var targetEl = null;
            if (caller && caller.nodeType) {
                targetEl = caller;
            } else if (typeof event !== 'undefined' && event.target) {
                targetEl = event.target.closest ? event.target.closest('.enhance-card') : event.target;
            }

            if (targetEl) targetEl.classList.add('selected');

            // æ›´æ–°é¢„è§ˆ
            updateEnhancePreview();
        }
        
        // æ›´æ–°å¢å¼ºé¢„è§ˆ
        function updateEnhancePreview() {
            const enhanceLabels = {
                'complete': 'å®Œå–„ç»†èŠ‚',
                'style': 'è‰ºæœ¯é£æ ¼',
                'color': 'æ™ºèƒ½ä¸Šè‰²',
                'animate': 'åŠ¨æ€æ•ˆæœ'
            };
            
            document.getElementById('enhanced-preview').innerHTML = enhanceLabels[currentEnhance] || 'AIå¢å¼º';
        }
        
        // åº”ç”¨å¢å¼º
        function applyEnhancement() {
            const loadingElement = document.getElementById('enhance-loading');
            const enhanceBtn = document.getElementById('enhance-btn');
            
            // æ˜¾ç¤ºåŠ è½½åŠ¨ç”»
            loadingElement.style.display = 'flex';
            enhanceBtn.disabled = true;
            
            // æ¨¡æ‹ŸAIå¤„ç†ï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šè°ƒç”¨AI APIï¼‰
            setTimeout(() => {
                // éšè—åŠ è½½åŠ¨ç”»
                loadingElement.style.display = 'none';
                enhanceBtn.disabled = false;
                
                // æ˜¾ç¤ºæœ€ç»ˆä½œå“
                document.getElementById('ai-enhance-section').style.display = 'none';
                showArtwork();
            }, 3000);
        }
        
        // æ˜¾ç¤ºä½œå“
        function showArtwork() {
            document.getElementById('artwork-section').style.display = 'block';
            
            // æ›´æ–°ä½œå“ä¿¡æ¯
            updateArtworkInfo();
        }
        
        // æ›´æ–°ä½œå“ä¿¡æ¯
        function updateArtworkInfo() {
            const modeLabels = {
                'free': 'è‡ªç”±ç»˜ç”»',
                'ai': 'AIè¾…åŠ©ç»˜ç”»',
                'shape': 'å½¢çŠ¶ç»˜ç”»',
                'coloring': 'å¡«è‰²æ¸¸æˆ'
            };
            
            const enhanceLabels = {
                'complete': 'å®Œå–„ç»†èŠ‚',
                'style': 'è‰ºæœ¯é£æ ¼',
                'color': 'æ™ºèƒ½ä¸Šè‰²',
                'animate': 'åŠ¨æ€æ•ˆæœ'
            };
            
            document.getElementById('artwork-mode').textContent = modeLabels[currentMode] || 'è‡ªç”±ç»˜ç”»';
            document.getElementById('artwork-enhance').textContent = currentEnhance ? enhanceLabels[currentEnhance] : 'æ— ';
            document.getElementById('artwork-time').textContent = 'ä»Šå¤©';
            
            // è®¾ç½®ä½œå“æ ‡é¢˜
            document.getElementById('artwork-title').textContent = `æˆ‘çš„${modeLabels[currentMode]}ä½œå“`;
            
            // è®¾ç½®ä½œå“å›¾åƒï¼ˆåœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šæ˜¾ç¤ºå®é™…ç”Ÿæˆçš„ä½œå“ï¼‰
            document.getElementById('artwork-image').innerHTML = 'ğŸ–¼ï¸';
        }
        
        // åˆ›å»ºæ–°ä½œå“
        function createNewArt() {
            document.getElementById('artwork-section').style.display = 'none';
            document.getElementById('mode-section').style.display = 'block';
            
            // é‡ç½®çŠ¶æ€
            currentMode = '';
            currentEnhance = '';
            document.getElementById('mode-next').disabled = true;
        }
        
        // ä¿å­˜ä½œå“
        function saveArtwork() {
            // åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œä¼šä¿å­˜ä½œå“åˆ°æœåŠ¡å™¨æˆ–æœ¬åœ°å­˜å‚¨
            alert("ç”»ä½œå·²ä¿å­˜ï¼ä½ å¯ä»¥åœ¨'æˆ‘çš„ä½œå“'ä¸­æŸ¥çœ‹å’Œåˆ†äº«å®ƒã€‚");
            
            // è¿”å›åˆ›ä½œæ¹¾
            setTimeout(() => {
                window.location.href = 'create.html';
            }, 1500);
        }
        
        // ä¸ºåº•éƒ¨å¯¼èˆªæ·»åŠ ç‚¹å‡»äº‹ä»¶
        document.querySelectorAll('.nav-item').forEach((item) => {
            item.addEventListener('click', function() {
                document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
            });
        });
    </script>
</body>
</html>